import{a as wt}from"./chunk-QJDYPUOK.js";import{a as ni,b as si,n as _t}from"./chunk-H7COM2MZ.js";var Gt=ni((ct,ht)=>{(function(i,e){typeof ct=="object"&&typeof ht<"u"?ht.exports=e():typeof define=="function"&&define.amd?define(e):(i=i||self).RBush=e()})(ct,function(){"use strict";function i(c,d,m,x,g){(function y(v,_,k,M,D){for(;M>k;){if(M-k>600){var T=M-k+1,X=_-k+1,Q=Math.log(T),W=.5*Math.exp(2*Q/3),A=.5*Math.sqrt(Q*W*(T-W)/T)*(X-T/2<0?-1:1),q=Math.max(k,Math.floor(_-X*W/T+A)),ke=Math.min(M,Math.floor(_+(T-X)*W/T+A));y(v,_,q,ke,D)}var Y=v[_],ee=k,I=M;for(e(v,k,_),D(v[M],Y)>0&&e(v,k,M);ee<I;){for(e(v,ee,I),ee++,I--;D(v[ee],Y)<0;)ee++;for(;D(v[I],Y)>0;)I--}D(v[k],Y)===0?e(v,k,I):e(v,++I,M),I<=_&&(k=I+1),_<=I&&(M=I-1)}})(c,d,m||0,x||c.length-1,g||t)}function e(c,d,m){var x=c[d];c[d]=c[m],c[m]=x}function t(c,d){return c<d?-1:c>d?1:0}var r=function(c){c===void 0&&(c=9),this._maxEntries=Math.max(4,c),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(c,d,m){if(!m)return d.indexOf(c);for(var x=0;x<d.length;x++)if(m(c,d[x]))return x;return-1}function s(c,d){a(c,0,c.children.length,d,c)}function a(c,d,m,x,g){g||(g=b(null)),g.minX=1/0,g.minY=1/0,g.maxX=-1/0,g.maxY=-1/0;for(var y=d;y<m;y++){var v=c.children[y];o(g,c.leaf?x(v):v)}return g}function o(c,d){return c.minX=Math.min(c.minX,d.minX),c.minY=Math.min(c.minY,d.minY),c.maxX=Math.max(c.maxX,d.maxX),c.maxY=Math.max(c.maxY,d.maxY),c}function l(c,d){return c.minX-d.minX}function h(c,d){return c.minY-d.minY}function f(c){return(c.maxX-c.minX)*(c.maxY-c.minY)}function u(c){return c.maxX-c.minX+(c.maxY-c.minY)}function p(c,d){return c.minX<=d.minX&&c.minY<=d.minY&&d.maxX<=c.maxX&&d.maxY<=c.maxY}function w(c,d){return d.minX<=c.maxX&&d.minY<=c.maxY&&d.maxX>=c.minX&&d.maxY>=c.minY}function b(c){return{children:c,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function z(c,d,m,x,g){for(var y=[d,m];y.length;)if(!((m=y.pop())-(d=y.pop())<=x)){var v=d+Math.ceil((m-d)/x/2)*x;i(c,v,d,m,g),y.push(d,v,v,m)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(c){var d=this.data,m=[];if(!w(c,d))return m;for(var x=this.toBBox,g=[];d;){for(var y=0;y<d.children.length;y++){var v=d.children[y],_=d.leaf?x(v):v;w(c,_)&&(d.leaf?m.push(v):p(c,_)?this._all(v,m):g.push(v))}d=g.pop()}return m},r.prototype.collides=function(c){var d=this.data;if(!w(c,d))return!1;for(var m=[];d;){for(var x=0;x<d.children.length;x++){var g=d.children[x],y=d.leaf?this.toBBox(g):g;if(w(c,y)){if(d.leaf||p(c,y))return!0;m.push(g)}}d=m.pop()}return!1},r.prototype.load=function(c){if(!c||!c.length)return this;if(c.length<this._minEntries){for(var d=0;d<c.length;d++)this.insert(c[d]);return this}var m=this._build(c.slice(),0,c.length-1,0);if(this.data.children.length)if(this.data.height===m.height)this._splitRoot(this.data,m);else{if(this.data.height<m.height){var x=this.data;this.data=m,m=x}this._insert(m,this.data.height-m.height-1,!0)}else this.data=m;return this},r.prototype.insert=function(c){return c&&this._insert(c,this.data.height-1),this},r.prototype.clear=function(){return this.data=b([]),this},r.prototype.remove=function(c,d){if(!c)return this;for(var m,x,g,y=this.data,v=this.toBBox(c),_=[],k=[];y||_.length;){if(y||(y=_.pop(),x=_[_.length-1],m=k.pop(),g=!0),y.leaf){var M=n(c,y.children,d);if(M!==-1)return y.children.splice(M,1),_.push(y),this._condense(_),this}g||y.leaf||!p(y,v)?x?(m++,y=x.children[m],g=!1):y=null:(_.push(y),k.push(m),m=0,x=y,y=y.children[0])}return this},r.prototype.toBBox=function(c){return c},r.prototype.compareMinX=function(c,d){return c.minX-d.minX},r.prototype.compareMinY=function(c,d){return c.minY-d.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(c){return this.data=c,this},r.prototype._all=function(c,d){for(var m=[];c;)c.leaf?d.push.apply(d,c.children):m.push.apply(m,c.children),c=m.pop();return d},r.prototype._build=function(c,d,m,x){var g,y=m-d+1,v=this._maxEntries;if(y<=v)return s(g=b(c.slice(d,m+1)),this.toBBox),g;x||(x=Math.ceil(Math.log(y)/Math.log(v)),v=Math.ceil(y/Math.pow(v,x-1))),(g=b([])).leaf=!1,g.height=x;var _=Math.ceil(y/v),k=_*Math.ceil(Math.sqrt(v));z(c,d,m,k,this.compareMinX);for(var M=d;M<=m;M+=k){var D=Math.min(M+k-1,m);z(c,M,D,_,this.compareMinY);for(var T=M;T<=D;T+=_){var X=Math.min(T+_-1,D);g.children.push(this._build(c,T,X,x-1))}}return s(g,this.toBBox),g},r.prototype._chooseSubtree=function(c,d,m,x){for(;x.push(d),!d.leaf&&x.length-1!==m;){for(var g=1/0,y=1/0,v=void 0,_=0;_<d.children.length;_++){var k=d.children[_],M=f(k),D=(T=c,X=k,(Math.max(X.maxX,T.maxX)-Math.min(X.minX,T.minX))*(Math.max(X.maxY,T.maxY)-Math.min(X.minY,T.minY))-M);D<y?(y=D,g=M<g?M:g,v=k):D===y&&M<g&&(g=M,v=k)}d=v||d.children[0]}var T,X;return d},r.prototype._insert=function(c,d,m){var x=m?c:this.toBBox(c),g=[],y=this._chooseSubtree(x,this.data,d,g);for(y.children.push(c),o(y,x);d>=0&&g[d].children.length>this._maxEntries;)this._split(g,d),d--;this._adjustParentBBoxes(x,g,d)},r.prototype._split=function(c,d){var m=c[d],x=m.children.length,g=this._minEntries;this._chooseSplitAxis(m,g,x);var y=this._chooseSplitIndex(m,g,x),v=b(m.children.splice(y,m.children.length-y));v.height=m.height,v.leaf=m.leaf,s(m,this.toBBox),s(v,this.toBBox),d?c[d-1].children.push(v):this._splitRoot(m,v)},r.prototype._splitRoot=function(c,d){this.data=b([c,d]),this.data.height=c.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(c,d,m){for(var x,g,y,v,_,k,M,D=1/0,T=1/0,X=d;X<=m-d;X++){var Q=a(c,0,X,this.toBBox),W=a(c,X,m,this.toBBox),A=(g=Q,y=W,v=void 0,_=void 0,k=void 0,M=void 0,v=Math.max(g.minX,y.minX),_=Math.max(g.minY,y.minY),k=Math.min(g.maxX,y.maxX),M=Math.min(g.maxY,y.maxY),Math.max(0,k-v)*Math.max(0,M-_)),q=f(Q)+f(W);A<D?(D=A,x=X,T=q<T?q:T):A===D&&q<T&&(T=q,x=X)}return x||m-d},r.prototype._chooseSplitAxis=function(c,d,m){var x=c.leaf?this.compareMinX:l,g=c.leaf?this.compareMinY:h;this._allDistMargin(c,d,m,x)<this._allDistMargin(c,d,m,g)&&c.children.sort(x)},r.prototype._allDistMargin=function(c,d,m,x){c.children.sort(x);for(var g=this.toBBox,y=a(c,0,d,g),v=a(c,m-d,m,g),_=u(y)+u(v),k=d;k<m-d;k++){var M=c.children[k];o(y,c.leaf?g(M):M),_+=u(y)}for(var D=m-d-1;D>=d;D--){var T=c.children[D];o(v,c.leaf?g(T):T),_+=u(v)}return _},r.prototype._adjustParentBBoxes=function(c,d,m){for(var x=m;x>=0;x--)o(d[x],c)},r.prototype._condense=function(c){for(var d=c.length-1,m=void 0;d>=0;d--)c[d].children.length===0?d>0?(m=c[d-1].children).splice(m.indexOf(c[d]),1):this.clear():s(c[d],this.toBBox)},r})});function F(i,e){this.x=i,this.y=e}F.prototype={clone(){return new F(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,e){return this.clone()._rotateAround(i,e)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){let e=i.x-this.x,t=i.y-this.y;return e*e+t*t},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult(i){let e=i[0]*this.x+i[1]*this.y,t=i[2]*this.x+i[3]*this.y;return this.x=e,this.y=t,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){let i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){let e=Math.cos(i),t=Math.sin(i),r=e*this.x-t*this.y,n=t*this.x+e*this.y;return this.x=r,this.y=n,this},_rotateAround(i,e){let t=Math.cos(i),r=Math.sin(i),n=e.x+t*(this.x-e.x)-r*(this.y-e.y),s=e.y+r*(this.x-e.x)+t*(this.y-e.y);return this.x=n,this.y=s,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:F};F.convert=function(i){if(i instanceof F)return i;if(Array.isArray(i))return new F(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new F(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};function ie(i,e,t){return Math.min(Math.max(i,t),e)}var We=class extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}},he=We;function bt(i){if(typeof i!="string")throw new he(i);if(i.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=i.trim();e=ui.test(i)?li(i):i;let t=ci.exec(e);if(t){let a=Array.from(t).slice(1);return[...a.slice(0,3).map(o=>parseInt(fe(o,2),16)),parseInt(fe(a[3]||"f",2),16)/255]}let r=hi.exec(e);if(r){let a=Array.from(r).slice(1);return[...a.slice(0,3).map(o=>parseInt(o,16)),parseInt(a[3]||"ff",16)/255]}let n=fi.exec(e);if(n){let a=Array.from(n).slice(1);return[...a.slice(0,3).map(o=>parseInt(o,10)),parseFloat(a[3]||"1")]}let s=di.exec(e);if(s){let[a,o,l,h]=Array.from(s).slice(1).map(parseFloat);if(ie(0,100,o)!==o)throw new he(i);if(ie(0,100,l)!==l)throw new he(i);return[...mi(a,o,l),Number.isNaN(h)?1:h]}throw new he(i)}function ai(i){let e=5381,t=i.length;for(;t;)e=e*33^i.charCodeAt(--t);return(e>>>0)%2341}var vt=i=>parseInt(i.replace(/_/g,""),36),oi="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((i,e)=>{let t=vt(e.substring(0,3)),r=vt(e.substring(3)).toString(16),n="";for(let s=0;s<6-r.length;s++)n+="0";return i[t]=`${n}${r}`,i},{});function li(i){let e=i.toLowerCase().trim(),t=oi[ai(e)];if(!t)throw new he(i);return`#${t}`}var fe=(i,e)=>Array.from(Array(e)).map(()=>i).join(""),ci=new RegExp(`^#${fe("([a-f0-9])",3)}([a-f0-9])?$`,"i"),hi=new RegExp(`^#${fe("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),fi=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${fe(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),di=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,ui=/^[a-z]+$/i,kt=i=>Math.round(i*255),mi=(i,e,t)=>{let r=t/100;if(e===0)return[r,r,r].map(kt);let n=(i%360+360)%360/60,s=(1-Math.abs(2*r-1))*(e/100),a=s*(1-Math.abs(n%2-1)),o=0,l=0,h=0;n>=0&&n<1?(o=s,l=a):n>=1&&n<2?(o=a,l=s):n>=2&&n<3?(l=s,h=a):n>=3&&n<4?(l=a,h=s):n>=4&&n<5?(o=a,h=s):n>=5&&n<6&&(o=s,h=a);let f=r-s/2,u=o+f,p=l+f,w=h+f;return[u,p,w].map(kt)};function pi(i,e,t,r){return`rgba(${ie(0,255,i).toFixed()}, ${ie(0,255,e).toFixed()}, ${ie(0,255,t).toFixed()}, ${parseFloat(ie(0,1,r).toFixed(3))})`}function ze(i,e,t){let r=(y,v)=>v===3?y:y/255,[n,s,a,o]=bt(i).map(r),[l,h,f,u]=bt(e).map(r),p=u-o,w=t*2-1,z=((w*p===-1?w:w+p/(1+w*p))+1)/2,c=1-z,d=(n*c+l*z)*255,m=(s*c+h*z)*255,x=(a*c+f*z)*255,g=u*t+o*(1-t);return pi(d,m,x,g)}var E=class{constructor(e,t){this.str=e??t,this.perFeature=typeof this.str=="function"&&this.str.length===2}get(e,t){return typeof this.str=="function"?this.str(e,t):this.str}},B=class{constructor(e,t=1){this.value=e??t,this.perFeature=typeof this.value=="function"&&this.value.length===2}get(e,t){return typeof this.value=="function"?this.value(e,t):this.value}},de=class{constructor(e){var t;this.labelProps=(t=e?.labelProps)!==null&&t!==void 0?t:["name"],this.textTransform=e?.textTransform}get(e,t){let r,n;typeof this.labelProps=="function"?n=this.labelProps(e,t):n=this.labelProps;for(let a of n)if(Object.prototype.hasOwnProperty.call(t.props,a)&&typeof t.props[a]=="string"){r=t.props[a];break}let s;return typeof this.textTransform=="function"?s=this.textTransform(e,t):s=this.textTransform,r&&s==="uppercase"?r=r.toUpperCase():r&&s==="lowercase"?r=r.toLowerCase():r&&s==="capitalize"&&(r=r.toLowerCase().split(" ").map(l=>l[0].toUpperCase()+l.slice(1)).join(" ")),r}},ue=class{constructor(e){var t,r;e?.font?this.font=e.font:(this.family=(t=e?.fontFamily)!==null&&t!==void 0?t:"sans-serif",this.size=(r=e?.fontSize)!==null&&r!==void 0?r:12,this.weight=e?.fontWeight,this.style=e?.fontStyle)}get(e,t){if(this.font)return typeof this.font=="function"?this.font(e,t):this.font;let r="";this.style&&(typeof this.style=="function"?r=`${this.style(e,t)} `:r=`${this.style} `);let n="";this.weight&&(typeof this.weight=="function"?n=`${this.weight(e,t)} `:n=`${this.weight} `);let s;typeof this.size=="function"?s=this.size(e,t):s=this.size;let a;return typeof this.family=="function"?a=this.family(e,t):a=this.family,`${r}${n}${s}px ${a}`}},Me=class{constructor(e,t=[]){this.value=e??t,this.perFeature=typeof this.value=="function"&&this.value.length===2}get(e,t){return typeof this.value=="function"?this.value(e,t):this.value}};var gi=(i,e,t)=>{let r=[],n,s,a,o=0,l=0,h=0,f=0,u=0,p=0,w=0,b=0,z=0,c=0,d=0,m=0;if(i.length<2)return[];if(i.length===2)return h=Math.sqrt(Math.pow(i[1].x-i[0].x,2)+Math.pow(i[1].y-i[0].y,2)),[{length:h,beginIndex:0,beginDistance:0,endIndex:2,endDistance:h}];for(f=Math.sqrt(Math.pow(i[1].x-i[0].x,2)+Math.pow(i[1].y-i[0].y,2)),o=1,l=i.length-1;o<l;o++)n=i[o-1],s=i[o],a=i[o+1],p=s.x-n.x,w=s.y-n.y,b=a.x-s.x,z=a.y-s.y,u=Math.sqrt(b*b+z*z),h+=f,c=Math.acos((p*b+w*z)/(f*u)),(c>e||h-m>t)&&(r.push({length:h-m,beginDistance:m,beginIndex:d,endIndex:o+1,endDistance:h}),d=o,m=h),f=u;return o-d>0&&r.push({length:h-m+u,beginIndex:d,beginDistance:m,endIndex:o+1,endDistance:h+u}),r};function zt(i,e,t,r){let n=[];for(let s of i){let a=gi(s,Math.PI/45,e);for(let o of a)if(o.length>=e+r){let l=new F(s[o.beginIndex].x,s[o.beginIndex].y),h=s[o.endIndex-1],f=new F((h.x-l.x)/o.length,(h.y-l.y)/o.length);for(let u=r;u<o.length-e;u+=t)n.push({start:l.add(f.mult(u)),end:l.add(f.mult(u+e))})}}return n}function Mt(i,e,t,r){let n=e.x-i.x,s=e.y-i.y,a=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)),o=[];for(let l=0;l<t+r;l+=2*r){let h=l*1/a;o.push({x:i.x+h*n,y:i.y+h*s})}return o}function Ke(i,e){if(i.length<=e)return[i];let t=e-1,r=i.lastIndexOf(" ",t),n=i.indexOf(" ",t);if(r===-1&&n===-1)return[i];let s,a;return n===-1||r>=0&&t-r<n-t?(s=i.substring(0,r),a=i.substring(r+1,i.length)):(s=i.substring(0,n),a=i.substring(n+1,i.length)),[s,...Ke(a,e)]}var yi="\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DB5\u4E00-\u9FEA\uF900-\uFA6D\uFA70-\uFAD9\u2000",Jr=new RegExp(`^[${yi}]+$`);var Fe=class{constructor(e,t,r,n,s){this.properties={},this.extent=r,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=s,e.readFields(xi,this,t)}loadGeometry(){let e=this._pbf;e.pos=this._geometry;let t=e.readVarint()+e.pos,r=[],n,s=1,a=0,o=0,l=0;for(;e.pos<t;){if(a<=0){let h=e.readVarint();s=h&7,a=h>>3}if(a--,s===1||s===2)o+=e.readSVarint(),l+=e.readSVarint(),s===1&&(n&&r.push(n),n=[]),n&&n.push(new F(o,l));else if(s===7)n&&n.push(n[0].clone());else throw new Error(`unknown command ${s}`)}return n&&r.push(n),r}bbox(){let e=this._pbf;e.pos=this._geometry;let t=e.readVarint()+e.pos,r=1,n=0,s=0,a=0,o=1/0,l=-1/0,h=1/0,f=-1/0;for(;e.pos<t;){if(n<=0){let u=e.readVarint();r=u&7,n=u>>3}if(n--,r===1||r===2)s+=e.readSVarint(),a+=e.readSVarint(),s<o&&(o=s),s>l&&(l=s),a<h&&(h=a),a>f&&(f=a);else if(r!==7)throw new Error(`unknown command ${r}`)}return[o,h,l,f]}toGeoJSON(e,t,r){let n=this.extent*Math.pow(2,r),s=this.extent*e,a=this.extent*t,o=this.loadGeometry();function l(p){return[(p.x+s)*360/n-180,360/Math.PI*Math.atan(Math.exp((1-(p.y+a)*2/n)*Math.PI))-90]}function h(p){return p.map(l)}let f;if(this.type===1){let p=[];for(let b of o)p.push(b[0]);let w=h(p);f=p.length===1?{type:"Point",coordinates:w[0]}:{type:"MultiPoint",coordinates:w}}else if(this.type===2){let p=o.map(h);f=p.length===1?{type:"LineString",coordinates:p[0]}:{type:"MultiLineString",coordinates:p}}else if(this.type===3){let p=wi(o),w=[];for(let b of p)w.push(b.map(h));f=w.length===1?{type:"Polygon",coordinates:w[0]}:{type:"MultiPolygon",coordinates:w}}else throw new Error("unknown feature type");let u={type:"Feature",geometry:f,properties:this.properties};return this.id!=null&&(u.id=this.id),u}};Fe.types=["Unknown","Point","LineString","Polygon"];function xi(i,e,t){i===1?e.id=t.readVarint():i===2?_i(t,e):i===3?e.type=t.readVarint():i===4&&(e._geometry=t.pos)}function _i(i,e){let t=i.readVarint()+i.pos;for(;i.pos<t;){let r=e._keys[i.readVarint()],n=e._values[i.readVarint()];e.properties[r]=n}}function wi(i){let e=i.length;if(e<=1)return[i];let t=[],r,n;for(let s=0;s<e;s++){let a=bi(i[s]);a!==0&&(n===void 0&&(n=a<0),n===a<0?(r&&t.push(r),r=[i[s]]):r&&r.push(i[s]))}return r&&t.push(r),t}function bi(i){let e=0;for(let t=0,r=i.length,n=r-1,s,a;t<r;n=t++)s=i[t],a=i[n],e+=(a.x-s.x)*(s.y+a.y);return e}var Ze=class{constructor(e,t){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(vi,this,t),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];let t=this._pbf.readVarint()+this._pbf.pos;return new Fe(this._pbf,t,this.extent,this._keys,this._values)}};function vi(i,e,t){i===15?e.version=t.readVarint():i===1?e.name=t.readString():i===5?e.extent=t.readVarint():i===2?e._features.push(t.pos):i===3?e._keys.push(t.readString()):i===4&&e._values.push(ki(t))}function ki(i){let e=null,t=i.readVarint()+i.pos;for(;i.pos<t;){let r=i.readVarint()>>3;e=r===1?i.readString():r===2?i.readFloat():r===3?i.readDouble():r===4?i.readVarint64():r===5?i.readVarint():r===6?i.readSVarint():r===7?i.readBoolean():null}return e}var Le=class{constructor(e,t){this.layers=e.readFields(zi,{},t)}};function zi(i,e,t){if(i===3){let r=new Ze(t,t.readVarint()+t.pos);r.length&&(e[r.name]=r)}}var Ft=23283064365386963e-26,Mi=12,Lt=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),Ge=0,De=1,me=2,Se=5,pe=class{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,t,r=this.length){for(;this.pos<r;){let n=this.readVarint(),s=n>>3,a=this.pos;this.type=n&7,e(s,t,this),this.pos===a&&this.skip(n)}return t}readMessage(e,t){return this.readFields(e,t,this.readVarint()+this.pos)}readFixed32(){let e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){let e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){let e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*4294967296;return this.pos+=8,e}readSFixed64(){let e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*4294967296;return this.pos+=8,e}readFloat(){let e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){let e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){let t=this.buf,r,n;return n=t[this.pos++],r=n&127,n<128||(n=t[this.pos++],r|=(n&127)<<7,n<128)||(n=t[this.pos++],r|=(n&127)<<14,n<128)||(n=t[this.pos++],r|=(n&127)<<21,n<128)?r:(n=t[this.pos],r|=(n&15)<<28,Fi(r,e,this))}readVarint64(){return this.readVarint(!0)}readSVarint(){let e=this.readVarint();return e%2===1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){let e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=Mi&&Lt?Lt.decode(this.buf.subarray(t,e)):Ai(this.buf,t,e)}readBytes(){let e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t}readPackedVarint(e=[],t){let r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readVarint(t));return e}readPackedSVarint(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFloat());return e}readPackedDouble(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===me?this.readVarint()+this.pos:this.pos+1}skip(e){let t=e&7;if(t===Ge)for(;this.buf[this.pos++]>127;);else if(t===me)this.pos=this.readVarint()+this.pos;else if(t===Se)this.pos+=4;else if(t===De)this.pos+=8;else throw new Error(`Unimplemented type: ${t}`)}writeTag(e,t){this.writeVarint(e<<3|t)}realloc(e){let t=this.length||16;for(;t<this.pos+e;)t*=2;if(t!==this.length){let r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.dataView=new DataView(r.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Ft),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Ft),!0),this.pos+=8}writeVarint(e){if(e=+e||0,e>268435455||e<0){Li(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))}writeSVarint(e){this.writeVarint(e<0?-e*2-1:e*2)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(e.length*4),this.pos++;let t=this.pos;this.pos=Ii(this.buf,e,this.pos);let r=this.pos-t;r>=128&&Dt(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){let t=e.length;this.writeVarint(t),this.realloc(t);for(let r=0;r<t;r++)this.buf[this.pos++]=e[r]}writeRawMessage(e,t){this.pos++;let r=this.pos;e(t,this);let n=this.pos-r;n>=128&&Dt(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n}writeMessage(e,t,r){this.writeTag(e,me),this.writeRawMessage(t,r)}writePackedVarint(e,t){t.length&&this.writeMessage(e,Ti,t)}writePackedSVarint(e,t){t.length&&this.writeMessage(e,Ci,t)}writePackedBoolean(e,t){t.length&&this.writeMessage(e,Xi,t)}writePackedFloat(e,t){t.length&&this.writeMessage(e,Bi,t)}writePackedDouble(e,t){t.length&&this.writeMessage(e,ji,t)}writePackedFixed32(e,t){t.length&&this.writeMessage(e,Yi,t)}writePackedSFixed32(e,t){t.length&&this.writeMessage(e,Pi,t)}writePackedFixed64(e,t){t.length&&this.writeMessage(e,Vi,t)}writePackedSFixed64(e,t){t.length&&this.writeMessage(e,Ei,t)}writeBytesField(e,t){this.writeTag(e,me),this.writeBytes(t)}writeFixed32Field(e,t){this.writeTag(e,Se),this.writeFixed32(t)}writeSFixed32Field(e,t){this.writeTag(e,Se),this.writeSFixed32(t)}writeFixed64Field(e,t){this.writeTag(e,De),this.writeFixed64(t)}writeSFixed64Field(e,t){this.writeTag(e,De),this.writeSFixed64(t)}writeVarintField(e,t){this.writeTag(e,Ge),this.writeVarint(t)}writeSVarintField(e,t){this.writeTag(e,Ge),this.writeSVarint(t)}writeStringField(e,t){this.writeTag(e,me),this.writeString(t)}writeFloatField(e,t){this.writeTag(e,Se),this.writeFloat(t)}writeDoubleField(e,t){this.writeTag(e,De),this.writeDouble(t)}writeBooleanField(e,t){this.writeVarintField(e,+t)}};function Fi(i,e,t){let r=t.buf,n,s;if(s=r[t.pos++],n=(s&112)>>4,s<128||(s=r[t.pos++],n|=(s&127)<<3,s<128)||(s=r[t.pos++],n|=(s&127)<<10,s<128)||(s=r[t.pos++],n|=(s&127)<<17,s<128)||(s=r[t.pos++],n|=(s&127)<<24,s<128)||(s=r[t.pos++],n|=(s&1)<<31,s<128))return re(i,n,e);throw new Error("Expected varint not more than 10 bytes")}function re(i,e,t){return t?e*4294967296+(i>>>0):(e>>>0)*4294967296+(i>>>0)}function Li(i,e){let t,r;if(i>=0?(t=i%4294967296|0,r=i/4294967296|0):(t=~(-i%4294967296),r=~(-i/4294967296),t^4294967295?t=t+1|0:(t=0,r=r+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),Di(t,r,e),Si(r,e)}function Di(i,e,t){t.buf[t.pos++]=i&127|128,i>>>=7,t.buf[t.pos++]=i&127|128,i>>>=7,t.buf[t.pos++]=i&127|128,i>>>=7,t.buf[t.pos++]=i&127|128,i>>>=7,t.buf[t.pos]=i&127}function Si(i,e){let t=(i&7)<<4;e.buf[e.pos++]|=t|((i>>>=3)?128:0),i&&(e.buf[e.pos++]=i&127|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=i&127|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=i&127|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=i&127|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=i&127)))))}function Dt(i,e,t){let r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));t.realloc(r);for(let n=t.pos-1;n>=i;n--)t.buf[n+r]=t.buf[n]}function Ti(i,e){for(let t=0;t<i.length;t++)e.writeVarint(i[t])}function Ci(i,e){for(let t=0;t<i.length;t++)e.writeSVarint(i[t])}function Bi(i,e){for(let t=0;t<i.length;t++)e.writeFloat(i[t])}function ji(i,e){for(let t=0;t<i.length;t++)e.writeDouble(i[t])}function Xi(i,e){for(let t=0;t<i.length;t++)e.writeBoolean(i[t])}function Yi(i,e){for(let t=0;t<i.length;t++)e.writeFixed32(i[t])}function Pi(i,e){for(let t=0;t<i.length;t++)e.writeSFixed32(i[t])}function Vi(i,e){for(let t=0;t<i.length;t++)e.writeFixed64(i[t])}function Ei(i,e){for(let t=0;t<i.length;t++)e.writeSFixed64(i[t])}function Ai(i,e,t){let r="",n=e;for(;n<t;){let s=i[n],a=null,o=s>239?4:s>223?3:s>191?2:1;if(n+o>t)break;let l,h,f;o===1?s<128&&(a=s):o===2?(l=i[n+1],(l&192)===128&&(a=(s&31)<<6|l&63,a<=127&&(a=null))):o===3?(l=i[n+1],h=i[n+2],(l&192)===128&&(h&192)===128&&(a=(s&15)<<12|(l&63)<<6|h&63,(a<=2047||a>=55296&&a<=57343)&&(a=null))):o===4&&(l=i[n+1],h=i[n+2],f=i[n+3],(l&192)===128&&(h&192)===128&&(f&192)===128&&(a=(s&15)<<18|(l&63)<<12|(h&63)<<6|f&63,(a<=65535||a>=1114112)&&(a=null))),a===null?(a=65533,o=1):a>65535&&(a-=65536,r+=String.fromCharCode(a>>>10&1023|55296),a=56320|a&1023),r+=String.fromCharCode(a),n+=o}return r}function Ii(i,e,t){for(let r=0,n,s;r<e.length;r++){if(n=e.charCodeAt(r),n>55295&&n<57344)if(s)if(n<56320){i[t++]=239,i[t++]=191,i[t++]=189,s=n;continue}else n=s-55296<<10|n-56320|65536,s=null;else{n>56319||r+1===e.length?(i[t++]=239,i[t++]=191,i[t++]=189):s=n;continue}else s&&(i[t++]=239,i[t++]=191,i[t++]=189,s=null);n<128?i[t++]=n:(n<2048?i[t++]=n>>6|192:(n<65536?i[t++]=n>>12|224:(i[t++]=n>>18|240,i[t++]=n>>12&63|128),i[t++]=n>>6&63|128),i[t++]=n&63|128)}return t}var ae=Math.pow,P=(i,e,t)=>new Promise((r,n)=>{var s=l=>{try{o(t.next(l))}catch(h){n(h)}},a=l=>{try{o(t.throw(l))}catch(h){n(h)}},o=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,a);o((t=t.apply(i,e)).next())}),U=Uint8Array,se=Uint16Array,Ri=Int32Array,Ct=new U([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Bt=new U([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ui=new U([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),jt=function(i,e){for(var t=new se(31),r=0;r<31;++r)t[r]=e+=1<<i[r-1];for(var n=new Ri(t[30]),r=1;r<30;++r)for(var s=t[r];s<t[r+1];++s)n[s]=s-t[r]<<5|r;return{b:t,r:n}},Xt=jt(Ct,2),Yt=Xt.b,$i=Xt.r;Yt[28]=258,$i[258]=28;var Pt=jt(Bt,0),Hi=Pt.b,nn=Pt.r,et=new se(32768);for(S=0;S<32768;++S)Z=(S&43690)>>1|(S&21845)<<1,Z=(Z&52428)>>2|(Z&13107)<<2,Z=(Z&61680)>>4|(Z&3855)<<4,et[S]=((Z&65280)>>8|(Z&255)<<8)>>1;var Z,S,xe=function(i,e,t){for(var r=i.length,n=0,s=new se(e);n<r;++n)i[n]&&++s[i[n]-1];var a=new se(e);for(n=1;n<e;++n)a[n]=a[n-1]+s[n-1]<<1;var o;if(t){o=new se(1<<e);var l=15-e;for(n=0;n<r;++n)if(i[n])for(var h=n<<4|i[n],f=e-i[n],u=a[i[n]-1]++<<f,p=u|(1<<f)-1;u<=p;++u)o[et[u]>>l]=h}else for(o=new se(r),n=0;n<r;++n)i[n]&&(o[n]=et[a[i[n]-1]++]>>15-i[n]);return o},_e=new U(288);for(S=0;S<144;++S)_e[S]=8;var S;for(S=144;S<256;++S)_e[S]=9;var S;for(S=256;S<280;++S)_e[S]=7;var S;for(S=280;S<288;++S)_e[S]=8;var S,Vt=new U(32);for(S=0;S<32;++S)Vt[S]=5;var S,qi=xe(_e,9,1),Oi=xe(Vt,5,1),Je=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},O=function(i,e,t){var r=e/8|0;return(i[r]|i[r+1]<<8)>>(e&7)&t},Qe=function(i,e){var t=e/8|0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>(e&7)},Ni=function(i){return(i+7)/8|0},Wi=function(i,e,t){(e==null||e<0)&&(e=0),(t==null||t>i.length)&&(t=i.length);var r=new U(t-e);return r.set(i.subarray(e,t)),r},Ki=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],R=function(i,e,t){var r=new Error(e||Ki[i]);if(r.code=i,Error.captureStackTrace&&Error.captureStackTrace(r,R),!t)throw r;return r},rt=function(i,e,t,r){var n=i.length,s=r?r.length:0;if(!n||e.f&&!e.l)return t||new U(0);var a=!t||e.i!=2,o=e.i;t||(t=new U(n*3));var l=function(gt){var yt=t.length;if(gt>yt){var xt=new U(Math.max(yt*2,gt));xt.set(t),t=xt}},h=e.f||0,f=e.p||0,u=e.b||0,p=e.l,w=e.d,b=e.m,z=e.n,c=n*8;do{if(!p){h=O(i,f,1);var d=O(i,f+1,3);if(f+=3,d)if(d==1)p=qi,w=Oi,b=9,z=5;else if(d==2){var y=O(i,f,31)+257,v=O(i,f+10,15)+4,_=y+O(i,f+5,31)+1;f+=14;for(var k=new U(_),M=new U(19),D=0;D<v;++D)M[Ui[D]]=O(i,f+D*3,7);f+=v*3;for(var T=Je(M),X=(1<<T)-1,Q=xe(M,T,1),D=0;D<_;){var W=Q[O(i,f,X)];f+=W&15;var m=W>>4;if(m<16)k[D++]=m;else{var A=0,q=0;for(m==16?(q=3+O(i,f,3),f+=2,A=k[D-1]):m==17?(q=3+O(i,f,7),f+=3):m==18&&(q=11+O(i,f,127),f+=7);q--;)k[D++]=A}}var ke=k.subarray(0,y),Y=k.subarray(y);b=Je(ke),z=Je(Y),p=xe(ke,b,1),w=xe(Y,z,1)}else R(1);else{var m=Ni(f)+4,x=i[m-4]|i[m-3]<<8,g=m+x;if(g>n){o&&R(0);break}a&&l(u+x),t.set(i.subarray(m,g),u),e.b=u+=x,e.p=f=g*8,e.f=h;continue}if(f>c){o&&R(0);break}}a&&l(u+131072);for(var ee=(1<<b)-1,I=(1<<z)-1,He=f;;He=f){var A=p[Qe(i,f)&ee],te=A>>4;if(f+=A&15,f>c){o&&R(0);break}if(A||R(2),te<256)t[u++]=te;else if(te==256){He=f,p=null;break}else{var mt=te-254;if(te>264){var D=te-257,ce=Ct[D];mt=O(i,f,(1<<ce)-1)+Yt[D],f+=ce}var qe=w[Qe(i,f)&I],Oe=qe>>4;qe||R(3),f+=qe&15;var Y=Hi[Oe];if(Oe>3){var ce=Bt[Oe];Y+=Qe(i,f)&(1<<ce)-1,f+=ce}if(f>c){o&&R(0);break}a&&l(u+131072);var Ne=u+mt;if(u<Y){var pt=s-Y,ri=Math.min(Y,Ne);for(pt+u<0&&R(3);u<ri;++u)t[u]=r[pt+u]}for(;u<Ne;u+=4)t[u]=t[u-Y],t[u+1]=t[u+1-Y],t[u+2]=t[u+2-Y],t[u+3]=t[u+3-Y];u=Ne}}e.l=p,e.p=He,e.b=u,e.f=h,p&&(h=1,e.m=b,e.d=w,e.n=z)}while(!h);return u==t.length?t:Wi(t,0,u)},Zi=new U(0),Gi=function(i){(i[0]!=31||i[1]!=139||i[2]!=8)&&R(6,"invalid gzip data");var e=i[3],t=10;e&4&&(t+=(i[10]|i[11]<<8)+2);for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!i[t++]);return t+(e&2)},Ji=function(i){var e=i.length;return(i[e-4]|i[e-3]<<8|i[e-2]<<16|i[e-1]<<24)>>>0},Qi=function(i,e){return((i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31)&&R(6,"invalid zlib data"),(i[1]>>5&1)==+!e&&R(6,"invalid zlib data: "+(i[1]&32?"need":"unexpected")+" dictionary"),(i[1]>>3&4)+2};function er(i,e){return rt(i,{i:2},e&&e.out,e&&e.dictionary)}function tr(i,e){var t=Gi(i);return t+8>i.length&&R(6,"invalid gzip data"),rt(i.subarray(t,-8),{i:2},e&&e.out||new U(Ji(i)),e&&e.dictionary)}function ir(i,e){return rt(i.subarray(Qi(i,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function tt(i,e){return i[0]==31&&i[1]==139&&i[2]==8?tr(i,e):(i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31?er(i,e):ir(i,e)}var rr=typeof TextDecoder<"u"&&new TextDecoder,nr=0;try{rr.decode(Zi,{stream:!0}),nr=1}catch{}var Et=(i,e)=>i*ae(2,e),ge=(i,e)=>Math.floor(i/ae(2,e)),Te=(i,e)=>Et(i.getUint16(e+1,!0),8)+i.getUint8(e),At=(i,e)=>Et(i.getUint32(e+2,!0),16)+i.getUint16(e,!0),sr=(i,e,t,r,n)=>{if(i!==r.getUint8(n))return i-r.getUint8(n);let s=Te(r,n+1);if(e!==s)return e-s;let a=Te(r,n+4);return t!==a?t-a:0},ar=(i,e,t,r)=>{let n=It(i,e|128,t,r);return n?{z:e,x:t,y:r,offset:n[0],length:n[1],isDir:!0}:null},St=(i,e,t,r)=>{let n=It(i,e,t,r);return n?{z:e,x:t,y:r,offset:n[0],length:n[1],isDir:!1}:null},It=(i,e,t,r)=>{let n=0,s=i.byteLength/17-1;for(;n<=s;){let a=s+n>>1,o=sr(e,t,r,i,a*17);if(o>0)n=a+1;else if(o<0)s=a-1;else return[At(i,a*17+7),i.getUint32(a*17+13,!0)]}return null},or=(i,e)=>i.isDir&&!e.isDir?1:!i.isDir&&e.isDir?-1:i.z!==e.z?i.z-e.z:i.x!==e.x?i.x-e.x:i.y-e.y,Rt=(i,e)=>{let t=i.getUint8(e*17);return{z:t&127,x:Te(i,e*17+1),y:Te(i,e*17+4),offset:At(i,e*17+7),length:i.getUint32(e*17+13,!0),isDir:t>>7===1}},Tt=i=>{let e=[],t=new DataView(i);for(let r=0;r<t.byteLength/17;r++)e.push(Rt(t,r));return lr(e)},lr=i=>{i.sort(or);let e=new ArrayBuffer(17*i.length),t=new Uint8Array(e);for(let r=0;r<i.length;r++){let n=i[r],s=n.z;n.isDir&&(s=s|128),t[r*17]=s,t[r*17+1]=n.x&255,t[r*17+2]=n.x>>8&255,t[r*17+3]=n.x>>16&255,t[r*17+4]=n.y&255,t[r*17+5]=n.y>>8&255,t[r*17+6]=n.y>>16&255,t[r*17+7]=n.offset&255,t[r*17+8]=ge(n.offset,8)&255,t[r*17+9]=ge(n.offset,16)&255,t[r*17+10]=ge(n.offset,24)&255,t[r*17+11]=ge(n.offset,32)&255,t[r*17+12]=ge(n.offset,48)&255,t[r*17+13]=n.length&255,t[r*17+14]=n.length>>8&255,t[r*17+15]=n.length>>16&255,t[r*17+16]=n.length>>24&255}return e},cr=(i,e)=>{if(i.byteLength<17)return null;let t=i.byteLength/17,r=Rt(i,t-1);if(r.isDir){let n=r.z,s=e.z-n,a=Math.trunc(e.x/(1<<s)),o=Math.trunc(e.y/(1<<s));return{z:n,x:a,y:o}}return null};function hr(i){return P(this,null,function*(){let e=yield i.getBytes(0,512e3),t=new DataView(e.data),r=t.getUint32(4,!0),n=t.getUint16(8,!0),s=new TextDecoder("utf-8"),a=JSON.parse(s.decode(new DataView(e.data,10,r))),o=0;a.compression==="gzip"&&(o=2);let l=0;"minzoom"in a&&(l=+a.minzoom);let h=0;"maxzoom"in a&&(h=+a.maxzoom);let f=0,u=0,p=0,w=-180,b=-85,z=180,c=85;if(a.bounds){let m=a.bounds.split(",");w=+m[0],b=+m[1],z=+m[2],c=+m[3]}if(a.center){let m=a.center.split(",");f=+m[0],u=+m[1],p=+m[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+r,rootDirectoryLength:n*17,jsonMetadataOffset:10,jsonMetadataLength:r,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:o,tileType:1,minZoom:l,maxZoom:h,minLon:w,minLat:b,maxLon:z,maxLat:c,centerZoom:p,centerLon:f,centerLat:u,etag:e.etag}})}function fr(i,e,t,r,n,s,a){return P(this,null,function*(){let o=yield t.getArrayBuffer(e,i.rootDirectoryOffset,i.rootDirectoryLength,i);i.specVersion===1&&(o=Tt(o));let l=St(new DataView(o),r,n,s);if(l){let u=(yield e.getBytes(l.offset,l.length,a)).data,p=new DataView(u);return p.getUint8(0)===31&&p.getUint8(1)===139&&(u=tt(new Uint8Array(u))),{data:u}}let h=cr(new DataView(o),{z:r,x:n,y:s});if(h){let f=ar(new DataView(o),h.z,h.x,h.y);if(f){let u=yield t.getArrayBuffer(e,f.offset,f.length,i);i.specVersion===1&&(u=Tt(u));let p=St(new DataView(u),r,n,s);if(p){let b=(yield e.getBytes(p.offset,p.length,a)).data,z=new DataView(b);return z.getUint8(0)===31&&z.getUint8(1)===139&&(b=tt(new Uint8Array(b))),{data:b}}}}})}var Ut={getHeader:hr,getZxy:fr};function ne(i,e){return(e>>>0)*4294967296+(i>>>0)}function dr(i,e){let t=e.buf,r=t[e.pos++],n=(r&112)>>4;if(r<128||(r=t[e.pos++],n|=(r&127)<<3,r<128)||(r=t[e.pos++],n|=(r&127)<<10,r<128)||(r=t[e.pos++],n|=(r&127)<<17,r<128)||(r=t[e.pos++],n|=(r&127)<<24,r<128)||(r=t[e.pos++],n|=(r&1)<<31,r<128))return ne(i,n);throw new Error("Expected varint not more than 10 bytes")}function ye(i){let e=i.buf,t=e[i.pos++],r=t&127;return t<128||(t=e[i.pos++],r|=(t&127)<<7,t<128)||(t=e[i.pos++],r|=(t&127)<<14,t<128)||(t=e[i.pos++],r|=(t&127)<<21,t<128)?r:(t=e[i.pos],r|=(t&15)<<28,dr(r,i))}function ur(i,e,t,r){if(r===0){t===1&&(e[0]=i-1-e[0],e[1]=i-1-e[1]);let n=e[0];e[0]=e[1],e[1]=n}}var mr=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function pr(i,e,t){if(i>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>ae(2,i)-1||t>ae(2,i)-1)throw Error("tile x/y outside zoom level bounds");let r=mr[i],n=ae(2,i),s=0,a=0,o=0,l=[e,t],h=n/2;for(;h>0;)s=(l[0]&h)>0?1:0,a=(l[1]&h)>0?1:0,o+=h*h*(3*s^a),ur(h,l,s,a),h=h/2;return r+o}function $t(i,e){return P(this,null,function*(){if(e===1||e===0)return i;if(e===2){if(typeof globalThis.DecompressionStream>"u")return tt(new Uint8Array(i));let t=new Response(i).body;if(!t)throw Error("Failed to read response stream");let r=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(r).arrayBuffer()}throw Error("Compression method not supported")})}function gr(i){return i===1?".mvt":i===2?".png":i===3?".jpg":i===4?".webp":i===5?".avif":""}var yr=127;function xr(i,e){let t=0,r=i.length-1;for(;t<=r;){let n=r+t>>1,s=e-i[n].tileId;if(s>0)t=n+1;else if(s<0)r=n-1;else return i[n]}return r>=0&&(i[r].runLength===0||e-i[r].tileId<i[r].runLength)?i[r]:null}var _r=class{constructor(i,e=new Headers){this.url=i,this.customHeaders=e,this.mustReload=!1;let t="";"navigator"in globalThis&&(t=globalThis.navigator.userAgent||"");let r=t.indexOf("Windows")>-1,n=/Chrome|Chromium|Edg|OPR|Brave/.test(t);this.chromeWindowsNoCache=!1,r&&n&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(i){this.customHeaders=i}getBytes(i,e,t,r){return P(this,null,function*(){let n,s;t?s=t:(n=new AbortController,s=n.signal);let a=new Headers(this.customHeaders);a.set("range",`bytes=${i}-${i+e-1}`);let o;this.mustReload?o="reload":this.chromeWindowsNoCache&&(o="no-store");let l=yield fetch(this.url,{signal:s,cache:o,headers:a});if(i===0&&l.status===416){let p=l.headers.get("Content-Range");if(!p||!p.startsWith("bytes */"))throw Error("Missing content-length on 416 response");let w=+p.substr(8);l=yield fetch(this.url,{signal:s,cache:"reload",headers:{range:`bytes=0-${w-1}`}})}let h=l.headers.get("Etag");if(h?.startsWith("W/")&&(h=null),l.status===416||r&&h&&h!==r)throw this.mustReload=!0,new it(`Server returned non-matching ETag ${r} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(l.status>=300)throw Error(`Bad response code: ${l.status}`);let f=l.headers.get("Content-Length");if(l.status===200&&(!f||+f>e))throw n&&n.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield l.arrayBuffer(),etag:h||void 0,cacheControl:l.headers.get("Cache-Control")||void 0,expires:l.headers.get("Expires")||void 0}})}};function N(i,e){let t=i.getUint32(e+4,!0),r=i.getUint32(e+0,!0);return t*ae(2,32)+r}function wr(i,e){let t=new DataView(i),r=t.getUint8(7);if(r>3)throw Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:N(t,8),rootDirectoryLength:N(t,16),jsonMetadataOffset:N(t,24),jsonMetadataLength:N(t,32),leafDirectoryOffset:N(t,40),leafDirectoryLength:N(t,48),tileDataOffset:N(t,56),tileDataLength:N(t,64),numAddressedTiles:N(t,72),numTileEntries:N(t,80),numTileContents:N(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function Ht(i){let e={buf:new Uint8Array(i),pos:0},t=ye(e),r=[],n=0;for(let s=0;s<t;s++){let a=ye(e);r.push({tileId:n+a,offset:0,length:0,runLength:1}),n+=a}for(let s=0;s<t;s++)r[s].runLength=ye(e);for(let s=0;s<t;s++)r[s].length=ye(e);for(let s=0;s<t;s++){let a=ye(e);a===0&&s>0?r[s].offset=r[s-1].offset+r[s-1].length:r[s].offset=a-1}return r}function br(i){let e=new DataView(i);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var it=class extends Error{};function vr(i,e){return P(this,null,function*(){let t=yield i.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(br(t.data)<3)return[yield Ut.getHeader(i)];let n=t.data.slice(0,yr),s=wr(n,t.etag),a=t.data.slice(s.rootDirectoryOffset,s.rootDirectoryOffset+s.rootDirectoryLength),o=`${i.getKey()}|${s.etag||""}|${s.rootDirectoryOffset}|${s.rootDirectoryLength}`,l=Ht(yield e(a,s.internalCompression));return[s,[o,l.length,l]]})}function kr(i,e,t,r,n){return P(this,null,function*(){let s=yield i.getBytes(t,r,void 0,n.etag),a=yield e(s.data,n.internalCompression),o=Ht(a);if(o.length===0)throw new Error("Empty directory is invalid");return o})}var zr=class{constructor(i=100,e=!0,t=$t){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=i,this.counter=1,this.decompress=t}getHeader(i){return P(this,null,function*(){let e=i.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;let r=new Promise((n,s)=>{vr(i,this.decompress).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),n(a[0]),this.prune()}).catch(a=>{s(a)})});return this.cache.set(e,{lastUsed:this.counter++,data:r}),r})}getDirectory(i,e,t,r){return P(this,null,function*(){let n=`${i.getKey()}|${r.etag||""}|${e}|${t}`,s=this.cache.get(n);if(s)return s.lastUsed=this.counter++,yield s.data;let a=new Promise((o,l)=>{kr(i,this.decompress,e,t,r).then(h=>{o(h),this.prune()}).catch(h=>{l(h)})});return this.cache.set(n,{lastUsed:this.counter++,data:a}),a})}getArrayBuffer(i,e,t,r){return P(this,null,function*(){let n=`${i.getKey()}|${r.etag||""}|${e}|${t}`,s=this.cache.get(n);if(s)return s.lastUsed=this.counter++,yield s.data;let a=new Promise((o,l)=>{i.getBytes(e,t,void 0,r.etag).then(h=>{o(h.data),this.cache.has(n),this.prune()}).catch(h=>{l(h)})});return this.cache.set(n,{lastUsed:this.counter++,data:a}),a})}prune(){if(this.cache.size>=this.maxCacheEntries){let i=1/0,e;this.cache.forEach((t,r)=>{t.lastUsed<i&&(i=t.lastUsed,e=r)}),e&&this.cache.delete(e)}}invalidate(i){return P(this,null,function*(){let e=i.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(i.getKey());let t=new Promise((r,n)=>{this.getHeader(i).then(s=>{r(),this.invalidations.delete(e)}).catch(s=>{n(s)})});this.invalidations.set(e,t)})}},qt=class{constructor(i,e,t){typeof i=="string"?this.source=new _r(i):this.source=i,t?this.decompress=t:this.decompress=$t,e?this.cache=e:this.cache=new zr}getHeader(){return P(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(i,e,t,r){return P(this,null,function*(){let n=pr(i,e,t),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return Ut.getZxy(s,this.source,this.cache,i,e,t,r);if(i<s.minZoom||i>s.maxZoom)return;let a=s.rootDirectoryOffset,o=s.rootDirectoryLength;for(let l=0;l<=3;l++){let h=yield this.cache.getDirectory(this.source,a,o,s),f=xr(h,n);if(f){if(f.runLength>0){let u=yield this.source.getBytes(s.tileDataOffset+f.offset,f.length,r,s.etag);return{data:yield this.decompress(u.data,s.tileCompression),cacheControl:u.cacheControl,expires:u.expires}}a=s.leafDirectoryOffset+f.offset,o=f.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(i,e,t,r){return P(this,null,function*(){try{return yield this.getZxyAttempt(i,e,t,r)}catch(n){if(n instanceof it)return this.cache.invalidate(this.source),yield this.getZxyAttempt(i,e,t,r);throw n}})}getMetadataAttempt(){return P(this,null,function*(){let i=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(i.jsonMetadataOffset,i.jsonMetadataLength,void 0,i.etag),t=yield this.decompress(e.data,i.internalCompression),r=new TextDecoder("utf-8");return JSON.parse(r.decode(t))})}getMetadata(){return P(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(i){if(i instanceof it)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw i}})}getTileJson(i){return P(this,null,function*(){let e=yield this.getHeader(),t=yield this.getMetadata(),r=gr(e.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${i}/{z}/{x}/{y}${r}`],vector_layers:t.vector_layers,attribution:t.attribution,description:t.description,name:t.name,version:t.version,bounds:[e.minLon,e.minLat,e.maxLon,e.maxLat],center:[e.centerLon,e.centerLat,e.centerZoom],minzoom:e.minZoom,maxzoom:e.maxZoom}})}};var st=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function o(f){try{h(r.next(f))}catch(u){a(u)}}function l(f){try{h(r.throw(f))}catch(u){a(u)}}function h(f){f.done?s(f.value):n(f.value).then(o,l)}h((r=r.apply(i,e||[])).next())})},oe;(function(i){i[i.Point=1]="Point",i[i.Line=2]="Line",i[i.Polygon=3]="Polygon"})(oe||(oe={}));function G(i){return`${i.x}:${i.y}:${i.z}`}var Mr=(i,e,t)=>{i.pos=e;let r=i.readVarint()+i.pos,n=1,s=0,a=0,o=0,l=1/0,h=-1/0,f=1/0,u=-1/0,p=[],w=[];for(;i.pos<r;){if(s<=0){let b=i.readVarint();n=b&7,s=b>>3}if(s--,n===1||n===2)a+=i.readSVarint()*t,o+=i.readSVarint()*t,a<l&&(l=a),a>h&&(h=a),o<f&&(f=o),o>u&&(u=o),n===1&&(w.length>0&&p.push(w),w=[]),w.push(new F(a,o));else if(n===7)w&&w.push(w[0].clone());else throw new Error(`unknown command ${n}`)}return w&&p.push(w),{geom:p,bbox:{minX:l,minY:f,maxX:h,maxY:u}}};function Kt(i,e){let t=new Le(new pe(i)),r=new Map;for(let[n,s]of Object.entries(t.layers)){let a=[],o=s;for(let l=0;l<o.length;l++){let h=Mr(o.feature(l)._pbf,o.feature(l)._geometry,e/o.extent),f=0;for(let u of h.geom)f+=u.length;a.push({id:o.feature(l).id,geomType:o.feature(l).type,geom:h.geom,numVertices:f,bbox:h.bbox,props:o.feature(l).properties})}r.set(n,a)}return r}var we=class{constructor(e,t){typeof e=="string"?this.p=new qt(e):this.p=e,this.zoomaborts=[],this.shouldCancelZooms=t}get(e,t){return st(this,void 0,void 0,function*(){this.shouldCancelZooms&&(this.zoomaborts=this.zoomaborts.filter(a=>a.z!==e.z?(a.controller.abort(),!1):!0));let r=new AbortController;this.zoomaborts.push({z:e.z,controller:r});let n=r.signal,s=yield this.p.getZxy(e.z,e.x,e.y,n);return s?Kt(s.data,t):new Map})}},je=class{constructor(e,t){this.url=e,this.zoomaborts=[],this.shouldCancelZooms=t}get(e,t){return st(this,void 0,void 0,function*(){this.shouldCancelZooms&&(this.zoomaborts=this.zoomaborts.filter(a=>a.z!==e.z?(a.controller.abort(),!1):!0));let r=this.url.replace("{z}",e.z.toString()).replace("{x}",e.x.toString()).replace("{y}",e.y.toString()),n=new AbortController;this.zoomaborts.push({z:e.z,controller:n});let s=n.signal;return new Promise((a,o)=>{fetch(r,{signal:s}).then(l=>l.arrayBuffer()).then(l=>{let h=Kt(l,t);a(h)}).catch(l=>{o(l)})})})}},nt=6378137,Ot=85.0511287798,Ce=nt*Math.PI,Fr=i=>{let e=Math.PI/180,t=Math.max(Math.min(Ot,i[0]),-Ot),r=Math.sin(t*e);return new F(nt*i[1]*e,nt*Math.log((1+r)/(1-r))/2)};function Nt(i){return i*i}function Be(i,e){return Nt(i.x-e.x)+Nt(i.y-e.y)}function Lr(i,e,t){let r=Be(e,t);if(r===0)return Be(i,e);let n=((i.x-e.x)*(t.x-e.x)+(i.y-e.y)*(t.y-e.y))/r;return n=Math.max(0,Math.min(1,n)),Be(i,new F(e.x+n*(t.x-e.x),e.y+n*(t.y-e.y)))}function Wt(i,e){let t=!1;for(let r=0,n=e.length-1;r<e.length;n=r++){let s=e[r].x,a=e[r].y,o=e[n].x,l=e[n].y;a>i.y!=l>i.y&&i.x<(o-s)*(i.y-a)/(l-a)+s&&(t=!t)}return t}function Dr(i){let e=0;for(let t=0;t<i.length;t++){let r=(t+1)%i.length;e+=i[t].x*i[r].y,e-=i[r].x*i[t].y}return e<0}function Sr(i,e){let t=!1;for(let r of e)if(Dr(r))Wt(i,r)&&(t=!1);else{if(t)return!0;Wt(i,r)&&(t=!0)}return t}function Tr(i,e){let t=1/0;for(let r of e){let n=Math.sqrt(Be(i,r[0]));n<t&&(t=n)}return t}function Cr(i,e){let t=1/0;for(let r of e)for(let n=0;n<r.length-1;n++){let s=Math.sqrt(Lr(i,r[n],r[n+1]));s<t&&(t=s)}return t}var Xe=class{constructor(e,t){this.source=e,this.cache=new Map,this.inflight=new Map,this.tileSize=t}get(e){return st(this,void 0,void 0,function*(){let t=G(e);return new Promise((r,n)=>{let s=this.cache.get(t);if(s)s.used=performance.now(),r(s.data);else{let a=this.inflight.get(t);a?a.push({resolve:r,reject:n}):(this.inflight.set(t,[]),this.source.get(e,this.tileSize).then(o=>{this.cache.set(t,{used:performance.now(),data:o});let l=this.inflight.get(t);if(l)for(let h of l)h.resolve(o);if(this.inflight.delete(t),r(o),this.cache.size>=64){let h=1/0,f;this.cache.forEach((u,p)=>{u.used<h&&(h=u.used,f=p)}),f&&this.cache.delete(f)}}).catch(o=>{let l=this.inflight.get(t);if(l)for(let h of l)h.reject(o);this.inflight.delete(t),n(o)}))}})})}queryFeatures(e,t,r,n){let s=Fr([t,e]),a=new F((s.x+Ce)/(Ce*2),1-(s.y+Ce)/(Ce*2));a.x>1&&(a.x=a.x-Math.floor(a.x));let o=a.mult(1<<r),l=Math.floor(o.x),h=Math.floor(o.y),f=G({z:r,x:l,y:h}),u=[],p=this.cache.get(f);if(p){let w=new F((o.x-l)*this.tileSize,(o.y-h)*this.tileSize);for(let[b,z]of p.data.entries())for(let c of z)c.geomType===oe.Point?Tr(w,c.geom)<n&&u.push({feature:c,layerName:b}):c.geomType===oe.Line?Cr(w,c.geom)<n&&u.push({feature:c,layerName:b}):Sr(w,c.geom)&&u.push({feature:c,layerName:b})}return u}};var K;(function(i){i[i.Left=1]="Left",i[i.Center=2]="Center",i[i.Right=3]="Right"})(K||(K={}));var C;(function(i){i[i.N=1]="N",i[i.Ne=2]="Ne",i[i.E=3]="E",i[i.Se=4]="Se",i[i.S=5]="S",i[i.Sw=6]="Sw",i[i.W=7]="W",i[i.Nw=8]="Nw"})(C||(C={}));var j=class{constructor(e){var t;this.pattern=e.pattern,this.fill=new E(e.fill,"black"),this.opacity=new B(e.opacity,1),this.stroke=new E(e.stroke,"black"),this.width=new B(e.width,0),this.perFeature=(t=this.fill.perFeature||this.opacity.perFeature||this.stroke.perFeature||this.width.perFeature||e.perFeature)!==null&&t!==void 0?t:!1,this.doStroke=!1}before(e,t){if(!this.perFeature){e.globalAlpha=this.opacity.get(t),e.fillStyle=this.fill.get(t),e.strokeStyle=this.stroke.get(t);let r=this.width.get(t);r>0&&(this.doStroke=!0),e.lineWidth=r}if(this.pattern){let r=e.createPattern(this.pattern,"repeat");r&&(e.fillStyle=r)}}draw(e,t,r,n){let s=!1;if(this.perFeature){e.globalAlpha=this.opacity.get(r,n),e.fillStyle=this.fill.get(r,n);let o=this.width.get(r,n);o&&(s=!0,e.strokeStyle=this.stroke.get(r,n),e.lineWidth=o)}let a=()=>{e.fill(),(s||this.doStroke)&&e.stroke()};e.beginPath();for(let o of t)for(let l=0;l<o.length;l++){let h=o[l];l===0?e.moveTo(h.x,h.y):e.lineTo(h.x,h.y)}a()}};function Br(i,e){let t=0;for(;e[t+1][0]<i;)t++;return t}function jr(i,e,t){return i*(t-e)+e}function Xr(i,e,t,r){let n=r[e+1][0]-r[e][0],s=i-r[e][0];return n===0?0:t===1?s/n:(Math.pow(t,s)-1)/(Math.pow(t,n)-1)}function H(i,e){return t=>{if(e.length<1)return 0;if(t<=e[0][0])return e[0][1];if(t>=e[e.length-1][0])return e[e.length-1][1];let r=Br(t,e),n=Xr(t,r,i,e);return jr(n,e[r][1],e[r+1][1])}}function lt(i){return H(1,i)}var V=class{constructor(e){var t;this.color=new E(e.color,"black"),this.width=new B(e.width),this.opacity=new B(e.opacity),this.dash=e.dash?new Me(e.dash):null,this.dashColor=new E(e.dashColor,"black"),this.dashWidth=new B(e.dashWidth,1),this.lineCap=new E(e.lineCap,"butt"),this.lineJoin=new E(e.lineJoin,"miter"),this.skip=!1,this.perFeature=!!(!((t=this.dash)===null||t===void 0)&&t.perFeature||this.color.perFeature||this.opacity.perFeature||this.width.perFeature||this.lineCap.perFeature||this.lineJoin.perFeature||e.perFeature)}before(e,t){this.perFeature||(e.strokeStyle=this.color.get(t),e.lineWidth=this.width.get(t),e.globalAlpha=this.opacity.get(t),e.lineCap=this.lineCap.get(t),e.lineJoin=this.lineJoin.get(t))}draw(e,t,r,n){if(this.skip)return;let s=()=>{this.perFeature&&(e.globalAlpha=this.opacity.get(r,n),e.lineCap=this.lineCap.get(r,n),e.lineJoin=this.lineJoin.get(r,n)),this.dash?(e.save(),this.perFeature?(e.lineWidth=this.dashWidth.get(r,n),e.strokeStyle=this.dashColor.get(r,n),e.setLineDash(this.dash.get(r,n))):e.setLineDash(this.dash.get(r)),e.stroke(),e.restore()):(e.save(),this.perFeature&&(e.lineWidth=this.width.get(r,n),e.strokeStyle=this.color.get(r,n)),e.stroke(),e.restore())};e.beginPath();for(let a of t)for(let o=0;o<a.length;o++){let l=a[o];o===0?e.moveTo(l.x,l.y):e.lineTo(l.x,l.y)}s()}};var Ye=class{constructor(e){this.radius=new B(e.radius,3),this.fill=new E(e.fill,"black"),this.stroke=new E(e.stroke,"white"),this.width=new B(e.width,0),this.opacity=new B(e.opacity)}draw(e,t,r,n){e.globalAlpha=this.opacity.get(r,n);let s=this.radius.get(r,n),a=this.width.get(r,n);a>0&&(e.strokeStyle=this.stroke.get(r,n),e.lineWidth=a,e.beginPath(),e.arc(t[0][0].x,t[0][0].y,s+a/2,0,2*Math.PI),e.stroke()),e.fillStyle=this.fill.get(r,n),e.beginPath(),e.arc(t[0][0].x,t[0][0].y,s,0,2*Math.PI),e.fill()}place(e,t,r){let n=t[0],s=new F(t[0][0].x,t[0][0].y),a=this.radius.get(e.zoom,r),o={minX:s.x-a,minY:s.y-a,maxX:s.x+a,maxY:s.y+a};return[{anchor:s,bboxes:[o],draw:h=>{this.draw(h,[[new F(0,0)]],e.zoom,r)}}]}};var Yr=(i,e)=>({minX:Math.min(i.minX,e.minX),minY:Math.min(i.minY,e.minY),maxX:Math.max(i.maxX,e.maxX),maxY:Math.max(i.maxY,e.maxY)}),Pe=class{constructor(e){this.list=e}place(e,t,r){let n=this.list[0];if(!n)return;let s=n.place(e,t,r);if(!s)return;let a=s[0],o=a.anchor,l=a.bboxes[0],h=[a.draw];for(let u=1;u<this.list.length;u++){if(s=this.list[u].place(e,t,r),!s)return;a=s[0],l=Yr(l,a.bboxes[0]),h.push(a.draw)}return[{anchor:o,bboxes:[l],draw:u=>{for(let p of h)p(u)}}]}},at=class{constructor(e){this.symbolizer=e}place(e,t,r){let n=t[0][0],s=this.symbolizer.place(e,[[new F(0,0)]],r);if(!s||s.length===0)return;let a=s[0],o=a.bboxes[0],l=o.maxX-o.minX,h=o.maxY-o.minY,f={minX:n.x-l/2,maxX:n.x+l/2,minY:n.y-h/2,maxY:n.y+h/2};return[{anchor:n,bboxes:[f],draw:p=>{p.translate(-l/2,h/2-o.maxY),a.draw(p,{justify:K.Center})}}]}};var Ve=class{constructor(e){this.font=new ue(e),this.text=new de(e),this.fill=new E(e.fill,"black"),this.stroke=new E(e.stroke,"black"),this.width=new B(e.width,0),this.lineHeight=new B(e.lineHeight,1),this.letterSpacing=new B(e.letterSpacing,0),this.maxLineCodeUnits=new B(e.maxLineChars,15),this.justify=e.justify}place(e,t,r){let n=this.text.get(e.zoom,r);if(!n)return;let s=this.font.get(e.zoom,r);e.scratch.font=s;let a=this.letterSpacing.get(e.zoom,r),o=Ke(n,this.maxLineCodeUnits.get(e.zoom,r)),l="",h=0;for(let m of o)m.length>h&&(h=m.length,l=m);let f=e.scratch.measureText(l),u=f.width+a*(h-1),p=f.actualBoundingBoxAscent,w=f.actualBoundingBoxDescent,b=(p+w)*this.lineHeight.get(e.zoom,r),z=new F(t[0][0].x,t[0][0].y),c={minX:z.x,minY:z.y-p,maxX:z.x+u,maxY:z.y+w+(o.length-1)*b};return[{anchor:z,bboxes:[c],draw:(m,x)=>{m.globalAlpha=1,m.font=s,m.fillStyle=this.fill.get(e.zoom,r);let g=this.width.get(e.zoom,r),y=0;for(let v of o){let _=0;if(this.justify===K.Center||x&&x.justify===K.Center?_=(u-m.measureText(v).width)/2:(this.justify===K.Right||x&&x.justify===K.Right)&&(_=u-m.measureText(v).width),g)if(m.lineWidth=g*2,m.strokeStyle=this.stroke.get(e.zoom,r),a>0){let k=_;for(let M of v)m.strokeText(M,k,y),k+=m.measureText(M).width+a}else m.strokeText(v,_,y);if(a>0){let k=_;for(let M of v)m.fillText(M,k,y),k+=m.measureText(M).width+a}else m.fillText(v,_,y);y+=b}}}]}},J=class{constructor(e){this.centered=new at(new Ve(e))}place(e,t,r){return this.centered.place(e,t,r)}},ot=class{constructor(e,t){var r,n,s;this.symbolizer=e,this.offsetX=new B(t.offsetX,0),this.offsetY=new B(t.offsetY,0),this.justify=(r=t.justify)!==null&&r!==void 0?r:void 0,this.placements=(n=t.placements)!==null&&n!==void 0?n:[C.Ne,C.Sw,C.Nw,C.Se,C.N,C.E,C.S,C.W],this.ddValues=(s=t.ddValues)!==null&&s!==void 0?s:()=>({})}place(e,t,r){if(r.geomType!==oe.Point)return;let n=t[0][0],s=this.symbolizer.place(e,[[new F(0,0)]],r);if(!s||s.length===0)return;let a=s[0],o=a.bboxes[0],l=this.offsetX,h=this.offsetY,f=this.justify,u=this.placements,{offsetX:p,offsetY:w,justify:b,placements:z}=this.ddValues(e.zoom,r)||{};p&&(l=new B(p,0)),w&&(h=new B(w,0)),b&&(f=b),z&&(u=z);let c=l.get(e.zoom,r),d=h.get(e.zoom,r),m=(_,k)=>({minX:_.x+k.x+o.minX,minY:_.y+k.y+o.minY,maxX:_.x+k.x+o.maxX,maxY:_.y+k.y+o.maxY}),x=new F(c,d),g,y=_=>{_.translate(x.x,x.y),a.draw(_,{justify:g})},v=(_,k)=>{let M=m(_,k);if(!e.index.bboxCollides(M,e.order))return[{anchor:n,bboxes:[M],draw:y}]};for(let _ of u){let k=this.computeXaxisOffset(c,o,_),M=this.computeYaxisOffset(d,o,_);return g=this.computeJustify(f,_),x=new F(k,M),v(n,x)}}computeXaxisOffset(e,t,r){let n=t.maxX,s=n/2;return[C.N,C.S].includes(r)?e-s:[C.Nw,C.W,C.Sw].includes(r)?e-n:e}computeYaxisOffset(e,t,r){let n=Math.abs(t.minY),s=t.maxY,a=(t.minY+t.maxY)/2;return[C.E,C.W].includes(r)?e-a:[C.Nw,C.Ne,C.N].includes(r)?e-s:[C.Sw,C.Se,C.S].includes(r)?e+n:e}computeJustify(e,t){return e||([C.N,C.S].includes(t)?K.Center:[C.Ne,C.E,C.Se].includes(t)?K.Left:K.Right)}},Ee=class{constructor(e){this.symbolizer=new ot(new Ve(e),e)}place(e,t,r){return this.symbolizer.place(e,t,r)}},be;(function(i){i[i.Above=1]="Above",i[i.Center=2]="Center",i[i.Below=3]="Below"})(be||(be={}));var le=class{constructor(e){var t;this.font=new ue(e),this.text=new de(e),this.fill=new E(e.fill,"black"),this.stroke=new E(e.stroke,"black"),this.width=new B(e.width,0),this.offset=new B(e.offset,0),this.position=(t=e.position)!==null&&t!==void 0?t:be.Above,this.maxLabelCodeUnits=new B(e.maxLabelChars,40),this.repeatDistance=new B(e.repeatDistance,250)}place(e,t,r){let n=this.text.get(e.zoom,r);if(!n||n.length>this.maxLabelCodeUnits.get(e.zoom,r))return;let s=20,a=r.bbox;if(a.maxY-a.minY<s&&a.maxX-a.minX<s)return;let o=this.font.get(e.zoom,r);e.scratch.font=o;let l=e.scratch.measureText(n),h=l.width,f=l.actualBoundingBoxAscent+l.actualBoundingBoxDescent,u=this.repeatDistance.get(e.zoom,r);e.overzoom>4&&(u*=1<<e.overzoom-4);let p=f*2,w=zt(t,h,u,p);if(w.length===0)return;let b=[];for(let z of w){let c=z.end.x-z.start.x,d=z.end.y-z.start.y,x=Mt(z.start,z.end,h,p/2).map(y=>({minX:y.x-p/2,minY:y.y-p/2,maxX:y.x+p/2,maxY:y.y+p/2})),g=y=>{y.globalAlpha=1,y.rotate(Math.atan2(d,c)),c<0&&(y.scale(-1,-1),y.translate(-h,0));let v=0;this.position===be.Below?v+=f:this.position===be.Center&&(v+=f/2),y.translate(0,v-this.offset.get(e.zoom,r)),y.font=o;let _=this.width.get(e.zoom,r);_&&(y.lineWidth=_,y.strokeStyle=this.stroke.get(e.zoom,r),y.strokeText(n,0,0)),y.fillStyle=this.fill.get(e.zoom,r),y.fillText(n,0,0)};b.push({anchor:z.start,bboxes:x,draw:g,deduplicationKey:n,deduplicationDistance:u})}return b}};var $=(i,e)=>{let t=i[e];return typeof t=="string"?t:""},Zt=(i,e)=>{let t=i[e];return typeof t=="number"?t:0},Ae=i=>[{dataLayer:"earth",symbolizer:new j({fill:i.earth})},{dataLayer:"landuse",symbolizer:new j({fill:(e,t)=>ze(i.park_a,i.park_b,Math.min(Math.max(e/12,12),0))}),filter:(e,t)=>{let r=$(t.props,"pmap:kind");return["allotments","village_green","playground"].includes(r)}},{dataLayer:"landuse",symbolizer:new j({fill:i.park_b,opacity:.7}),filter:(e,t)=>{let r=$(t.props,"pmap:kind");return["national_park","park","cemetery","protected_area","nature_reserve","forest","golf_course"].includes(r)}},{dataLayer:"landuse",symbolizer:new j({fill:i.hospital}),filter:(e,t)=>t.props["pmap:kind"]==="hospital"},{dataLayer:"landuse",symbolizer:new j({fill:i.industrial}),filter:(e,t)=>t.props["pmap:kind"]==="industrial"},{dataLayer:"landuse",symbolizer:new j({fill:i.school}),filter:(e,t)=>{let r=$(t.props,"pmap:kind");return["school","university","college"].includes(r)}},{dataLayer:"landuse",symbolizer:new j({fill:i.beach}),filter:(e,t)=>t.props["pmap:kind"]==="beach"},{dataLayer:"landuse",symbolizer:new j({fill:i.zoo}),filter:(e,t)=>t.props["pmap:kind"]==="zoo"},{dataLayer:"landuse",symbolizer:new j({fill:i.zoo}),filter:(e,t)=>{let r=$(t.props,"pmap:kind");return["military","naval_base","airfield"].includes(r)}},{dataLayer:"natural",symbolizer:new j({fill:(e,t)=>ze(i.wood_a,i.wood_b,Math.min(Math.max(e/12,12),0))}),filter:(e,t)=>{let r=$(t.props,"pmap:kind");return["wood","nature_reserve","forest"].includes(r)}},{dataLayer:"natural",symbolizer:new j({fill:(e,t)=>ze(i.scrub_a,i.scrub_b,Math.min(Math.max(e/12,12),0))}),filter:(e,t)=>{let r=$(t.props,"pmap:kind");return["scrub","grassland","grass"].includes(r)}},{dataLayer:"natural",symbolizer:new j({fill:i.scrub_b}),filter:(e,t)=>{let r=$(t.props,"pmap:kind");return["scrub","grassland","grass"].includes(r)}},{dataLayer:"natural",symbolizer:new j({fill:i.glacier}),filter:(e,t)=>t.props["pmap:kind"]==="glacier"},{dataLayer:"natural",symbolizer:new j({fill:i.sand}),filter:(e,t)=>t.props["pmap:kind"]==="sand"},{dataLayer:"landuse",symbolizer:new j({fill:i.aerodrome}),filter:(e,t)=>t.props["pmap:kind"]==="aerodrome"},{dataLayer:"water",symbolizer:new j({fill:i.water})},{dataLayer:"transit",symbolizer:new V({color:i.runway,width:(e,t)=>H(1.6,[[11,0],[13,4],[19,30]])(e)}),filter:(e,t)=>t.props["pmap:kind_detail"]==="runway"},{dataLayer:"transit",symbolizer:new V({color:i.runway,width:(e,t)=>H(1.6,[[14,0],[14.5,1],[16,6]])(e)}),filter:(e,t)=>t.props["pmap:kind_detail"]==="taxiway"},{dataLayer:"transit",symbolizer:new V({color:i.pier,width:(e,t)=>H(1.6,[[13,0],[13.5,0,5],[21,16]])(e)}),filter:(e,t)=>t.props["pmap:kind"]==="pier"},{dataLayer:"physical_line",minzoom:14,symbolizer:new V({color:i.water,width:(e,t)=>H(1.6,[[9,0],[9.5,1],[18,12]])(e)}),filter:(e,t)=>t.props["pmap:kind"]==="river"},{dataLayer:"physical_line",minzoom:14,symbolizer:new V({color:i.water,width:.5}),filter:(e,t)=>t.props["pmap:kind"]==="stream"},{dataLayer:"landuse",symbolizer:new j({fill:i.pedestrian}),filter:(e,t)=>t.props["pmap:kind"]==="pedestrian"},{dataLayer:"landuse",symbolizer:new j({fill:i.pier}),filter:(e,t)=>t.props["pmap:kind"]==="pier"},{dataLayer:"buildings",symbolizer:new j({fill:i.buildings,opacity:.5})},{dataLayer:"roads",symbolizer:new V({color:i.major,width:(e,t)=>H(1.6,[[14,0],[20,7]])(e)}),filter:(e,t)=>{let r=$(t.props,"pmap:kind");return["other","path"].includes(r)}},{dataLayer:"roads",symbolizer:new V({color:i.major,width:(e,t)=>H(1.6,[[13,0],[18,8]])(e)}),filter:(e,t)=>t.props["pmap:kind"]==="minor_road"},{dataLayer:"roads",symbolizer:new V({color:i.major,width:(e,t)=>H(1.6,[[7,0],[12,1.2],[15,3],[18,13]])(e)}),filter:(e,t)=>t.props["pmap:kind"]==="medium_road"},{dataLayer:"roads",symbolizer:new V({color:i.major,width:(e,t)=>H(1.6,[[6,0],[12,1.6],[15,3],[18,13]])(e)}),filter:(e,t)=>t.props["pmap:kind"]==="major_road"},{dataLayer:"roads",symbolizer:new V({color:i.major,width:(e,t)=>H(1.6,[[3,0],[6,1.1],[12,1.6],[15,5],[18,15]])(e)}),filter:(e,t)=>t.props["pmap:kind"]==="highway"},{dataLayer:"boundaries",symbolizer:new V({dash:[3,2],color:i.boundaries,width:1}),filter:(e,t)=>{let r=t.props["pmap:min_admin_level"];return typeof r=="number"&&r<=2}},{dataLayer:"transit",symbolizer:new V({dash:[.3,.75],color:i.railway,dashWidth:(e,t)=>H(1.6,[[4,0],[7,.15],[19,9]])(e),opacity:.5}),filter:(e,t)=>t.props["pmap:kind"]==="rail"},{dataLayer:"boundaries",symbolizer:new V({dash:[3,2],color:i.boundaries,width:.5}),filter:(e,t)=>{let r=t.props["pmap:min_admin_level"];return typeof r=="number"&&r>2}}],Ie=i=>{let e=["name"];return[{dataLayer:"roads",symbolizer:new le({labelProps:e,fill:i.roads_label_minor,font:"400 12px sans-serif",width:2,stroke:i.roads_label_minor_halo}),minzoom:16,filter:(t,r)=>{let n=$(r.props,"pmap:kind");return["minor_road","other","path"].includes(n)}},{dataLayer:"roads",symbolizer:new le({labelProps:e,fill:i.roads_label_major,font:"400 12px sans-serif",width:2,stroke:i.roads_label_major_halo}),minzoom:12,filter:(t,r)=>{let n=$(r.props,"pmap:kind");return["highway","major_road","medium_road"].includes(n)}},{dataLayer:"roads",symbolizer:new le({labelProps:e,fill:i.roads_label_major,font:"400 12px sans-serif",width:2,stroke:i.roads_label_major_halo}),minzoom:12,filter:(t,r)=>{let n=$(r.props,"pmap:kind");return["highway","major_road","medium_road"].includes(n)}},{dataLayer:"physical_point",symbolizer:new J({labelProps:e,fill:i.ocean_label,lineHeight:1.5,letterSpacing:1,font:(t,r)=>`400 ${lt([[3,10],[10,12]])(t)}px sans-serif`,textTransform:"uppercase"}),filter:(t,r)=>{let n=$(r.props,"pmap:kind");return["ocean","bay","strait","fjord"].includes(n)}},{dataLayer:"physical_point",symbolizer:new J({labelProps:e,fill:i.ocean_label,lineHeight:1.5,letterSpacing:1,font:(t,r)=>`400 ${lt([[3,0],[6,12],[10,12]])(t)}px sans-serif`}),filter:(t,r)=>{let n=$(r.props,"pmap:kind");return["sea","lake","water"].includes(n)}},{dataLayer:"places",symbolizer:new J({labelProps:(t,r)=>t<6?["name:short"]:e,fill:i.state_label,stroke:i.state_label_halo,width:1,lineHeight:1.5,font:(t,r)=>t<6?"400 16px sans-serif":"400 12px sans-serif",textTransform:"uppercase"}),filter:(t,r)=>r.props["pmap:kind"]==="region"},{dataLayer:"places",symbolizer:new J({labelProps:e,fill:i.country_label,lineHeight:1.5,font:(t,r)=>(t<6,"600 12px sans-serif"),textTransform:"uppercase"}),filter:(t,r)=>r.props["pmap:kind"]==="country"},{dataLayer:"places",minzoom:9,symbolizer:new J({labelProps:e,fill:i.city_label,lineHeight:1.5,font:(t,r)=>{if(!r)return"400 12px sans-serif";let n=r.props["pmap:min_zoom"],s=400;n&&n<=5&&(s=600);let a=12,o=r.props["pmap:population_rank"];return o&&o>9&&(a=16),`${s} ${a}px sans-serif`}}),sort:(t,r)=>{let n=Zt(t,"pmap:population_rank"),s=Zt(r,"pmap:population_rank");return n-s},filter:(t,r)=>r.props["pmap:kind"]==="locality"},{dataLayer:"places",maxzoom:8,symbolizer:new Pe([new Ye({radius:2,fill:i.city_circle,stroke:i.city_circle_stroke,width:1.5}),new Ee({labelProps:e,fill:i.city_label,stroke:i.city_label_halo,width:1,offsetX:6,offsetY:4.5,font:(t,r)=>"400 12px sans-serif"})]),filter:(t,r)=>r.props["pmap:kind"]==="locality"}]};var Pr={background:"#cccccc",earth:"#e0e0e0",park_a:"#cfddd5",park_b:"#9cd3b4",hospital:"#e4dad9",industrial:"#d1dde1",school:"#e4ded7",wood_a:"#d0ded0",wood_b:"#a0d9a0",pedestrian:"#e3e0d4",scrub_a:"#cedcd7",scrub_b:"#99d2bb",glacier:"#e7e7e7",sand:"#e2e0d7",beach:"#e8e4d0",aerodrome:"#dadbdf",runway:"#e9e9ed",water:"#80deea",pier:"#e0e0e0",zoo:"#c6dcdc",military:"#dcdcdc",tunnel_other_casing:"#e0e0e0",tunnel_minor_casing:"#e0e0e0",tunnel_link_casing:"#e0e0e0",tunnel_medium_casing:"#e0e0e0",tunnel_major_casing:"#e0e0e0",tunnel_highway_casing:"#e0e0e0",tunnel_other:"#d5d5d5",tunnel_minor:"#d5d5d5",tunnel_link:"#d5d5d5",tunnel_medium:"#d5d5d5",tunnel_major:"#d5d5d5",tunnel_highway:"#d5d5d5",transit_pier:"#e0e0e0",buildings:"#cccccc",minor_service_casing:"#e0e0e0",minor_casing:"#e0e0e0",link_casing:"#e0e0e0",medium_casing:"#e0e0e0",major_casing_late:"#e0e0e0",highway_casing_late:"#e0e0e0",other:"#ebebeb",minor_service:"#ebebeb",minor_a:"#ebebeb",minor_b:"#ffffff",link:"#ffffff",medium:"#f5f5f5",major_casing_early:"#e0e0e0",major:"#ffffff",highway_casing_early:"#e0e0e0",highway:"#ffffff",railway:"#a7b1b3",boundaries:"#adadad",waterway_label:"#ffffff",bridges_other_casing:"#e0e0e0",bridges_minor_casing:"#e0e0e0",bridges_link_casing:"#e0e0e0",bridges_medium_casing:"#e0e0e0",bridges_major_casing:"#e0e0e0",bridges_highway_casing:"#e0e0e0",bridges_other:"#ebebeb",bridges_minor:"#ffffff",bridges_link:"#ffffff",bridges_medium:"#f0eded",bridges_major:"#f5f5f5",bridges_highway:"#ffffff",roads_label_minor:"#91888b",roads_label_minor_halo:"#ffffff",roads_label_major:"#938a8d",roads_label_major_halo:"#ffffff",ocean_label:"#ffffff",peak_label:"#7e9aa0",subplace_label:"#8f8f8f",subplace_label_halo:"#e0e0e0",city_circle:"#ffffff",city_circle_stroke:"#a3a3a3",city_label:"#5c5c5c",city_label_halo:"#e0e0e0",state_label:"#b3b3b3",state_label_halo:"#e0e0e0",country_label:"#a3a3a3"},Vr={background:"#34373d",earth:"#1f1f1f",park_a:"#232325",park_b:"#232325",hospital:"#252424",industrial:"#222222",school:"#262323",wood_a:"#202121",wood_b:"#202121",pedestrian:"#1e1e1e",scrub_a:"#222323",scrub_b:"#222323",glacier:"#1c1c1c",sand:"#212123",beach:"#28282a",aerodrome:"#1e1e1e",runway:"#333333",water:"#34373d",pier:"#222222",zoo:"#222323",military:"#242323",tunnel_other_casing:"#141414",tunnel_minor_casing:"#141414",tunnel_link_casing:"#141414",tunnel_medium_casing:"#141414",tunnel_major_casing:"#141414",tunnel_highway_casing:"#141414",tunnel_other:"#292929",tunnel_minor:"#292929",tunnel_link:"#292929",tunnel_medium:"#292929",tunnel_major:"#292929",tunnel_highway:"#292929",transit_pier:"#333333",buildings:"#111111",minor_service_casing:"#1f1f1f",minor_casing:"#1f1f1f",link_casing:"#1f1f1f",medium_casing:"#1f1f1f",major_casing_late:"#1f1f1f",highway_casing_late:"#1f1f1f",other:"#333333",minor_service:"#333333",minor_a:"#3d3d3d",minor_b:"#333333",link:"#3d3d3d",medium:"#3d3d3d",major_casing_early:"#1f1f1f",major:"#3d3d3d",highway_casing_early:"#1f1f1f",highway:"#474747",railway:"#000000",boundaries:"#5b6374",waterway_label:"#717784",bridges_other_casing:"#2b2b2b",bridges_minor_casing:"#1f1f1f",bridges_link_casing:"#1f1f1f",bridges_medium_casing:"#1f1f1f",bridges_major_casing:"#1f1f1f",bridges_highway_casing:"#1f1f1f",bridges_other:"#333333",bridges_minor:"#333333",bridges_link:"#3d3d3d",bridges_medium:"#3d3d3d",bridges_major:"#3d3d3d",bridges_highway:"#474747",roads_label_minor:"#525252",roads_label_minor_halo:"#1f1f1f",roads_label_major:"#666666",roads_label_major_halo:"#1f1f1f",ocean_label:"#717784",peak_label:"#898080",subplace_label:"#525252",subplace_label_halo:"#1f1f1f",city_circle:"#000000",city_circle_stroke:"#7a7a7a",city_label:"#7a7a7a",city_label_halo:"#212121",state_label:"#3d3d3d",state_label_halo:"#1f1f1f",country_label:"#5c5c5c"},Er={background:"#ffffff",earth:"#ffffff",park_a:"#fcfcfc",park_b:"#fcfcfc",hospital:"#f8f8f8",industrial:"#fcfcfc",school:"#f8f8f8",wood_a:"#fafafa",wood_b:"#fafafa",pedestrian:"#fdfdfd",scrub_a:"#fafafa",scrub_b:"#fafafa",glacier:"#fcfcfc",sand:"#fafafa",beach:"#f6f6f6",aerodrome:"#fdfdfd",runway:"#efefef",water:"#dcdcdc",pier:"#f5f5f5",zoo:"#f7f7f7",military:"#fcfcfc",tunnel_other_casing:"#d6d6d6",tunnel_minor_casing:"#fcfcfc",tunnel_link_casing:"#fcfcfc",tunnel_medium_casing:"#fcfcfc",tunnel_major_casing:"#fcfcfc",tunnel_highway_casing:"#fcfcfc",tunnel_other:"#d6d6d6",tunnel_minor:"#d6d6d6",tunnel_link:"#d6d6d6",tunnel_medium:"#d6d6d6",tunnel_major:"#d6d6d6",tunnel_highway:"#d6d6d6",transit_pier:"#efefef",buildings:"#efefef",minor_service_casing:"#ffffff",minor_casing:"#ffffff",link_casing:"#ffffff",medium_casing:"#ffffff",major_casing_late:"#ffffff",highway_casing_late:"#ffffff",other:"#f5f5f5",minor_service:"#f5f5f5",minor_a:"#ebebeb",minor_b:"#f5f5f5",link:"#ebebeb",medium:"#ebebeb",major_casing_early:"#ffffff",major:"#ebebeb",highway_casing_early:"#ffffff",highway:"#ebebeb",railway:"#d6d6d6",boundaries:"#adadad",waterway_label:"#adadad",bridges_other_casing:"#ffffff",bridges_minor_casing:"#ffffff",bridges_link_casing:"#ffffff",bridges_medium_casing:"#ffffff",bridges_major_casing:"#ffffff",bridges_highway_casing:"#ffffff",bridges_other:"#f5f5f5",bridges_minor:"#f5f5f5",bridges_link:"#ebebeb",bridges_medium:"#ebebeb",bridges_major:"#ebebeb",bridges_highway:"#ebebeb",roads_label_minor:"#adadad",roads_label_minor_halo:"#ffffff",roads_label_major:"#999999",roads_label_major_halo:"#ffffff",ocean_label:"#adadad",peak_label:"#adadad",subplace_label:"#8f8f8f",subplace_label_halo:"#ffffff",city_circle:"#ffffff",city_circle_stroke:"#adadad",city_label:"#5c5c5c",city_label_halo:"#ffffff",state_label:"#b3b3b3",state_label_halo:"#ffffff",country_label:"#b8b8b8"},Ar={background:"#a3a3a3",earth:"#cccccc",park_a:"#c2c2c2",park_b:"#c2c2c2",hospital:"#d0d0d0",industrial:"#c6c6c6",school:"#d0d0d0",wood_a:"#c2c2c2",wood_b:"#c2c2c2",pedestrian:"#c4c4c4",scrub_a:"#c2c2c2",scrub_b:"#c2c2c2",glacier:"#d2d2d2",sand:"#d2d2d2",beach:"#d2d2d2",aerodrome:"#c9c9c9",runway:"#f5f5f5",water:"#a3a3a3",pier:"#b8b8b8",zoo:"#c7c7c7",military:"#bfbfbf",tunnel_other_casing:"#b8b8b8",tunnel_minor_casing:"#b8b8b8",tunnel_link_casing:"#b8b8b8",tunnel_medium_casing:"#b8b8b8",tunnel_major_casing:"#b8b8b8",tunnel_highway_casing:"#b8b8b8",tunnel_other:"#d6d6d6",tunnel_minor:"#d6d6d6",tunnel_link:"#d6d6d6",tunnel_medium:"#d6d6d6",tunnel_major:"#d6d6d6",tunnel_highway:"#d6d6d6",transit_pier:"#b8b8b8",buildings:"#e0e0e0",minor_service_casing:"#cccccc",minor_casing:"#cccccc",link_casing:"#cccccc",medium_casing:"#cccccc",major_casing_late:"#cccccc",highway_casing_late:"#cccccc",other:"#e0e0e0",minor_service:"#e0e0e0",minor_a:"#ebebeb",minor_b:"#e0e0e0",link:"#ebebeb",medium:"#ebebeb",major_casing_early:"#cccccc",major:"#ebebeb",highway_casing_early:"#cccccc",highway:"#ebebeb",railway:"#f5f5f5",boundaries:"#5c5c5c",waterway_label:"#7a7a7a",bridges_other_casing:"#cccccc",bridges_minor_casing:"#cccccc",bridges_link_casing:"#cccccc",bridges_medium_casing:"#cccccc",bridges_major_casing:"#cccccc",bridges_highway_casing:"#cccccc",bridges_other:"#e0e0e0",bridges_minor:"#e0e0e0",bridges_link:"#ebebeb",bridges_medium:"#ebebeb",bridges_major:"#ebebeb",bridges_highway:"#ebebeb",roads_label_minor:"#999999",roads_label_minor_halo:"#e0e0e0",roads_label_major:"#8f8f8f",roads_label_major_halo:"#ebebeb",ocean_label:"#7a7a7a",peak_label:"#5c5c5c",subplace_label:"#7a7a7a",subplace_label_halo:"#cccccc",city_circle:"#c2c2c2",city_circle_stroke:"#7a7a7a",city_label:"#474747",city_label_halo:"#cccccc",state_label:"#999999",state_label_halo:"#cccccc",country_label:"#858585"},Ir={background:"#2b2b2b",earth:"#141414",park_a:"#181818",park_b:"#181818",hospital:"#1d1d1d",industrial:"#101010",school:"#111111",wood_a:"#1a1a1a",wood_b:"#1a1a1a",pedestrian:"#191919",scrub_a:"#1c1c1c",scrub_b:"#1c1c1c",glacier:"#191919",sand:"#161616",beach:"#1f1f1f",aerodrome:"#191919",runway:"#323232",water:"#333333",pier:"#0a0a0a",zoo:"#191919",military:"#121212",tunnel_other_casing:"#101010",tunnel_minor_casing:"#101010",tunnel_link_casing:"#101010",tunnel_medium_casing:"#101010",tunnel_major_casing:"#101010",tunnel_highway_casing:"#101010",tunnel_other:"#292929",tunnel_minor:"#292929",tunnel_link:"#292929",tunnel_medium:"#292929",tunnel_major:"#292929",tunnel_highway:"#292929",transit_pier:"#0a0a0a",buildings:"#0a0a0a",minor_service_casing:"#141414",minor_casing:"#141414",link_casing:"#141414",medium_casing:"#141414",major_casing_late:"#141414",highway_casing_late:"#141414",other:"#1f1f1f",minor_service:"#1f1f1f",minor_a:"#292929",minor_b:"#1f1f1f",link:"#1f1f1f",medium:"#292929",major_casing_early:"#141414",major:"#292929",highway_casing_early:"#141414",highway:"#292929",railway:"#292929",boundaries:"#707070",waterway_label:"#707070",bridges_other_casing:"#141414",bridges_minor_casing:"#141414",bridges_link_casing:"#141414",bridges_medium_casing:"#141414",bridges_major_casing:"#141414",bridges_highway_casing:"#141414",bridges_other:"#1f1f1f",bridges_minor:"#1f1f1f",bridges_link:"#292929",bridges_medium:"#292929",bridges_major:"#292929",bridges_highway:"#292929",roads_label_minor:"#525252",roads_label_minor_halo:"#141414",roads_label_major:"#5c5c5c",roads_label_major_halo:"#141414",ocean_label:"#707070",peak_label:"#707070",subplace_label:"#5c5c5c",subplace_label_halo:"#141414",city_circle:"#000000",city_circle_stroke:"#666666",city_label:"#999999",city_label_halo:"#141414",state_label:"#3d3d3d",state_label_halo:"#141414",country_label:"#707070"},Re={light:Pr,dark:Vr,white:Er,grayscale:Ar,black:Ir};var ei=si(Gt(),1);var Jt=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function o(f){try{h(r.next(f))}catch(u){a(u)}}function l(f){try{h(r.throw(f))}catch(u){a(u)}}function h(f){f.done?s(f.value):n(f.value).then(o,l)}h((r=r.apply(i,e||[])).next())})},$e=(i,e,t)=>{let r=[];for(let n of i){let s=[];for(let a of n)s.push(a.clone().mult(e).add(t));r.push(s)}return r},Ue=(i,e)=>{let t=1<<e;return i<0?t+i:i>=t?i%t:i},ft=class{constructor(e,t,r){this.tileCache=e,this.maxDataLevel=t,this.levelDiff=r}dataTilesForBounds(e,t){let r=Math.pow(2,e)/Math.pow(2,Math.ceil(e)),n=[],s=1,a=this.tileCache.tileSize;if(e<this.levelDiff)s=1/(1<<this.levelDiff-e)*r,n.push({dataTile:{z:0,x:0,y:0},origin:new F(0,0),scale:s,dim:a*s});else if(e<=this.levelDiff+this.maxDataLevel){let o=1<<this.levelDiff,l=256*r,h=Math.ceil(e)-this.levelDiff,f=Math.floor(t.minX/o/l),u=Math.floor(t.minY/o/l),p=Math.floor(t.maxX/o/l),w=Math.floor(t.maxY/o/l);for(let b=f;b<=p;b++)for(let z=u;z<=w;z++){let c=new F(b*o*l,z*o*l);n.push({dataTile:{z:h,x:Ue(b,h),y:Ue(z,h)},origin:c,scale:r,dim:a*r})}}else{let o=1<<this.levelDiff;s=(1<<Math.ceil(e)-this.maxDataLevel-this.levelDiff)*r;let l=Math.floor(t.minX/o/256/s),h=Math.floor(t.minY/o/256/s),f=Math.floor(t.maxX/o/256/s),u=Math.floor(t.maxY/o/256/s);for(let p=l;p<=f;p++)for(let w=h;w<=u;w++){let b=new F(p*o*256*s,w*o*256*s);n.push({dataTile:{z:this.maxDataLevel,x:Ue(p,this.maxDataLevel),y:Ue(w,this.maxDataLevel)},origin:b,scale:s,dim:a*s})}}return n}dataTileForDisplayTile(e){let t,r=1,n=this.tileCache.tileSize,s;if(e.z<this.levelDiff)t={z:0,x:0,y:0},r=1/(1<<this.levelDiff-e.z),s=new F(0,0),n=n*r;else if(e.z<=this.levelDiff+this.maxDataLevel){let a=1<<this.levelDiff;t={z:e.z-this.levelDiff,x:Math.floor(e.x/a),y:Math.floor(e.y/a)},s=new F(t.x*a*256,t.y*a*256)}else{r=1<<e.z-this.maxDataLevel-this.levelDiff;let a=1<<this.levelDiff;t={z:this.maxDataLevel,x:Math.floor(e.x/a/r),y:Math.floor(e.y/a/r)},s=new F(t.x*a*r*256,t.y*a*r*256),n=n*r}return{dataTile:t,scale:r,origin:s,dim:n}}getBbox(e,t){return Jt(this,void 0,void 0,function*(){let r=this.dataTilesForBounds(e,t);return(yield Promise.all(r.map(s=>this.tileCache.get(s.dataTile)))).map((s,a)=>{let o=r[a];return{data:s,z:e,dataTile:o.dataTile,scale:o.scale,dim:o.dim,origin:o.origin}})})}getDisplayTile(e){return Jt(this,void 0,void 0,function*(){let t=this.dataTileForDisplayTile(e);return{data:yield this.tileCache.get(t.dataTile),z:e.z,dataTile:t.dataTile,scale:t.scale,origin:t.origin,dim:t.dim}})}queryFeatures(e,t,r,n){let s=Math.round(r),a=Math.min(s-this.levelDiff,this.maxDataLevel),o=n/(1<<s-a);return this.tileCache.queryFeatures(e,t,a,o)}},Qt=i=>{let e=r=>{let n=r.levelDiff===void 0?1:r.levelDiff,s=r.maxDataZoom||15,a;if(typeof r.url=="string")new URL(r.url,"http://example.com").pathname.endsWith(".pmtiles")?a=new we(r.url,!0):a=new je(r.url,!0);else if(r.url)a=new we(r.url,!0);else throw new Error(`Invalid source ${r.url}`);let o=new Xe(a,256*1<<n);return new ft(o,s,n)},t=new Map;if(i.sources)for(let r in i.sources)t.set(r,e(i.sources[r]));else t.set("",e(i));return t};var Rr=(i,e,t)=>{let n=e/256,s=Math.floor(t.minX/256),a=Math.floor(t.minY/256),o=Math.floor(t.maxX/256),l=Math.floor(t.maxY/256),h=Math.log2(n),f=[];for(let u=s;u<=o;u++){let p=u%(1<<i);for(let w=a;w<=l;w++)f.push({display:G({z:i,x:p,y:w}),key:G({z:i-h,x:Math.floor(p/n),y:Math.floor(w/n)})})}return f},dt=class{constructor(e,t){this.tree=new ei.default,this.current=new Map,this.dim=e,this.maxLabeledTiles=t}hasPrefix(e){for(let t of this.current.keys())if(t.startsWith(e))return!0;return!1}has(e){return this.current.has(e)}size(){return this.current.size}keys(){return this.current.keys()}searchBbox(e,t){let r=new Set;for(let n of this.tree.search(e))n.indexedLabel.order<=t&&r.add(n.indexedLabel);return r}searchLabel(e,t){let r=new Set;for(let n of e.bboxes)for(let s of this.tree.search(n))s.indexedLabel.order<=t&&r.add(s.indexedLabel);return r}bboxCollides(e,t){for(let r of this.tree.search(e))if(r.indexedLabel.order<=t)return!0;return!1}labelCollides(e,t){for(let r of e.bboxes)for(let n of this.tree.search(r))if(n.indexedLabel.order<=t)return!0;return!1}deduplicationCollides(e){if(!e.deduplicationKey||!e.deduplicationDistance)return!1;let t=e.deduplicationDistance,r={minX:e.anchor.x-t,minY:e.anchor.y-t,maxX:e.anchor.x+t,maxY:e.anchor.y+t};for(let n of this.tree.search(r))if(n.indexedLabel.deduplicationKey===e.deduplicationKey&&n.indexedLabel.anchor.dist(e.anchor)<t)return!0;return!1}makeEntry(e){this.current.get(e)&&console.log("consistency error 1");let t=new Set;this.current.set(e,t)}insert(e,t,r){let n={anchor:e.anchor,bboxes:e.bboxes,draw:e.draw,order:t,tileKey:r,deduplicationKey:e.deduplicationKey,deduplicationDistance:e.deduplicationDistance},s=this.current.get(r);if(!s){let l=new Set;this.current.set(r,l),s=l}s.add(n);let a=!1,o=!1;for(let l of e.bboxes)this.tree.insert({minX:l.minX,minY:l.minY,maxX:l.maxX,maxY:l.maxY,indexedLabel:n}),l.minX<0&&(a=!0),l.maxX>this.dim&&(o=!0);if(a||o){let l=a?this.dim:-this.dim,h=[];for(let p of e.bboxes)h.push({minX:p.minX+l,minY:p.minY,maxX:p.maxX+l,maxY:p.maxY});let f={anchor:new F(e.anchor.x+l,e.anchor.y),bboxes:h,draw:e.draw,order:t,tileKey:r},u=this.current.get(r);u&&u.add(f);for(let p of h)this.tree.insert({minX:p.minX,minY:p.minY,maxX:p.maxX,maxY:p.maxY,indexedLabel:f})}}pruneOrNoop(e){let t=e.split(":"),r,n=0,s=0;for(let a of this.current.keys()){let o=a.split(":");if(o[3]===t[3]){s++;let l=Math.sqrt(Math.pow(+o[0]-+t[0],2)+Math.pow(+o[1]-+t[1],2));l>n&&(n=l,r=a)}r&&s>this.maxLabeledTiles&&this.pruneKey(r)}}pruneKey(e){let t=this.current.get(e);if(!t)return;let r=[];for(let n of this.tree.all())t.has(n.indexedLabel)&&r.push(n);for(let n of r)this.tree.remove(n);this.current.delete(e)}removeLabel(e){let t=[];for(let n of this.tree.all())e===n.indexedLabel&&t.push(n);for(let n of t)this.tree.remove(n);let r=this.current.get(e.tileKey);r&&r.delete(e)}},ut=class{constructor(e,t,r,n,s){this.index=new dt(256*1<<e,n),this.z=e,this.scratch=t,this.labelRules=r,this.callback=s}layout(e){let t=performance.now(),r=new Set;for(let[s,a]of e)for(let o of a){let l=`${G(o.dataTile)}:${s}`;this.index.has(l)||(this.index.makeEntry(l),r.add(l))}let n=new Set;for(let[s,a]of this.labelRules.entries()){if(a.visible===!1||a.minzoom&&this.z<a.minzoom||a.maxzoom&&this.z>a.maxzoom)continue;let o=a.dataSource||"",l=e.get(o);if(l)for(let h of l){let f=`${G(h.dataTile)}:${o}`;if(!r.has(f))continue;let u=h.data.get(a.dataLayer);if(u===void 0)continue;let p=u;a.sort&&p.sort((b,z)=>a.sort?a.sort(b.props,z.props):0);let w={index:this.index,zoom:this.z,scratch:this.scratch,order:s,overzoom:this.z-h.dataTile.z};for(let b of p){if(a.filter&&!a.filter(this.z,b))continue;let z=$e(b.geom,h.scale,h.origin),c=a.symbolizer.place(w,z,b);if(c)for(let d of c){let m=!1;if(!(d.deduplicationKey&&this.index.deduplicationCollides(d))){if(this.index.labelCollides(d,1/0)){if(!this.index.labelCollides(d,s)){let x=this.index.searchLabel(d,1/0);for(let g of x){this.index.removeLabel(g);for(let y of g.bboxes)this.findInvalidatedTiles(n,h.dim,y,f)}this.index.insert(d,s,f),m=!0}}else this.index.insert(d,s,f),m=!0;if(m)for(let x of d.bboxes)(x.maxX>h.origin.x+h.dim||x.minX<h.origin.x||x.minY<h.origin.y||x.maxY>h.origin.y+h.dim)&&this.findInvalidatedTiles(n,h.dim,x,f)}}}}}for(let s of r)this.index.pruneOrNoop(s);return n.size>0&&this.callback&&this.callback(n),performance.now()-t}findInvalidatedTiles(e,t,r,n){let s=Rr(this.z,t,r);for(let a of s)a.key!==n&&this.index.hasPrefix(a.key)&&e.add(a.display)}add(e){let t=!0;for(let[n,s]of e)for(let a of s)this.index.has(`${G(a.dataTile)}:${n}`)||(t=!1);return t?0:this.layout(e)}},ve=class{constructor(e,t,r,n){this.labelers=new Map,this.scratch=e,this.labelRules=t,this.maxLabeledTiles=r,this.callback=n}add(e,t){let r=this.labelers.get(e);return r||(r=new ut(e,this.scratch,this.labelRules,this.maxLabeledTiles,this.callback),this.labelers.set(e,r)),r.add(t)}getIndex(e){let t=this.labelers.get(e);if(t)return t.index}};function ti(i,e,t,r,n,s,a,o,l){let h=performance.now();i.save(),i.miterLimit=2;for(let f of n){if(f.minzoom&&e<f.minzoom||f.maxzoom&&e>f.maxzoom)continue;let u=t.get(f.dataSource||"");if(u)for(let p of u){let w=p.data.get(f.dataLayer);if(w===void 0)continue;f.symbolizer.before&&f.symbolizer.before(i,p.z);let b=p.origin,z=p.dim,c=p.scale;if(i.save(),o){i.beginPath();let d=Math.max(b.x-a.x,s.minX-a.x),m=Math.max(b.y-a.y,s.minY-a.y),x=Math.min(b.x-a.x+z,s.maxX-a.x),g=Math.min(b.y-a.y+z,s.maxY-a.y);i.rect(d,m,x-d,g-m),i.clip()}i.translate(b.x-a.x,b.y-a.y);for(let d of w){let m=d.geom,x=d.bbox;x.maxX*c+b.x<s.minX||x.minX*c+b.x>s.maxX||x.minY*c+b.y>s.maxY||x.maxY*c+b.y<s.minY||f.filter&&!f.filter(p.z,d)||(c!==1&&(m=$e(m,c,new F(0,0))),f.symbolizer.draw(i,m,p.z,d))}i.restore()}}if(o&&(i.beginPath(),i.rect(s.minX-a.x,s.minY-a.y,s.maxX-s.minX,s.maxY-s.minY),i.clip()),r){let f=r.searchBbox(s,1/0);for(let u of f)if(i.save(),i.translate(u.anchor.x-a.x,u.anchor.y-a.y),u.draw(i),i.restore(),l){i.lineWidth=.5,i.strokeStyle=l,i.fillStyle=l,i.globalAlpha=1,i.fillRect(u.anchor.x-a.x-2,u.anchor.y-a.y-2,4,4);for(let p of u.bboxes)i.strokeRect(p.minX-a.x,p.minY-a.y,p.maxX-p.minX,p.maxY-p.minY)}}return i.restore(),performance.now()-h}var Ur=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function o(f){try{h(r.next(f))}catch(u){a(u)}}function l(f){try{h(r.throw(f))}catch(u){a(u)}}function h(f){f.done?s(f.value):n(f.value).then(o,l)}h((r=r.apply(i,e||[])).next())})},$r=i=>new Promise(e=>{setTimeout(()=>{e()},i)}),Hr=i=>i.then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e})),ii=(i={})=>{class e extends L.GridLayer{constructor(r={}){if(r.noWrap&&!r.bounds&&(r.bounds=[[-90,-180],[90,180]]),r.attribution==null&&(r.attribution='<a href="https://protomaps.com">Protomaps</a> \xA9 <a href="https://openstreetmap.org/copyright">OpenStreetMap</a>'),super(r),r.theme){let s=Re[r.theme];this.paintRules=Ae(s),this.labelRules=Ie(s),this.backgroundColor=s.background}else this.paintRules=r.paintRules||[],this.labelRules=r.labelRules||[],this.backgroundColor=r.backgroundColor;this.lastRequestedZ=void 0,this.tasks=r.tasks||[],this.views=Qt(r),this.debug=r.debug;let n=document.createElement("canvas").getContext("2d");this.scratch=n,this.onTilesInvalidated=s=>{for(let a of s)this.rerenderTile(a)},this.labelers=new ve(this.scratch,this.labelRules,16,this.onTilesInvalidated),this.tileSize=256*window.devicePixelRatio,this.tileDelay=r.tileDelay||3,this.lang=r.lang}renderTile(r,n,s,a=()=>{}){return Ur(this,void 0,void 0,function*(){this.lastRequestedZ=r.z;let o=[];for(let[_,k]of this.views){let M=k.getDisplayTile(r);o.push({key:_,promise:M})}let l=yield Promise.all(o.map(_=>_.promise.then(k=>({status:"fulfilled",value:k,key:_.key}),k=>({status:"rejected",reason:k,key:_.key})))),h=new Map;for(let _ of l)_.status==="fulfilled"?h.set(_.key,[_.value]):_.reason.name==="AbortError"||console.error(_.reason);if(n.key!==s||this.lastRequestedZ!==r.z||(yield Promise.all(this.tasks.map(Hr)),n.key!==s)||this.lastRequestedZ!==r.z)return;let f=this.labelers.add(r.z,h);if(n.key!==s||this.lastRequestedZ!==r.z)return;let u=this.labelers.getIndex(r.z);if(!this._map)return;let p=this._map.getCenter().wrap(),w=this._getTiledPixelBounds(p),z=this._pxBoundsToTileRange(w).getCenter(),c=r.distanceTo(z)*this.tileDelay;if(yield $r(c),n.key!==s||this.lastRequestedZ!==r.z)return;let d=16,m={minX:256*r.x-d,minY:256*r.y-d,maxX:256*(r.x+1)+d,maxY:256*(r.y+1)+d},x=new F(256*r.x,256*r.y);n.width=this.tileSize,n.height=this.tileSize;let g=n.getContext("2d");if(!g){console.error("Failed to get Canvas context");return}g.setTransform(this.tileSize/256,0,0,this.tileSize/256,0,0),g.clearRect(0,0,256,256),this.backgroundColor&&(g.save(),g.fillStyle=this.backgroundColor,g.fillRect(0,0,256,256),g.restore());let y=0,v=this.paintRules;if(y=ti(g,r.z,h,this.xray?null:u,v,m,x,!1,this.debug),this.debug){g.save(),g.fillStyle=this.debug,g.font="600 12px sans-serif",g.fillText(`${r.z} ${r.x} ${r.y}`,4,14),g.font="12px sans-serif";let _=28;for(let[k,M]of h){let D=M[0].dataTile;g.fillText(`${k+(k?" ":"")+D.z} ${D.x} ${D.y}`,4,_),_+=14}g.font="600 10px sans-serif",y>8&&(g.fillText(`${y.toFixed()} ms paint`,4,_),_+=14),f>8&&g.fillText(`${f.toFixed()} ms layout`,4,_),g.strokeStyle=this.debug,g.lineWidth=.5,g.beginPath(),g.moveTo(0,0),g.lineTo(0,256),g.stroke(),g.lineWidth=.5,g.beginPath(),g.moveTo(0,0),g.lineTo(256,0),g.stroke(),g.restore()}a()})}rerenderTile(r){for(let n in this._tiles){let s=this._wrapCoords(this._keyToTileCoords(n));r===this._tileCoordsToKey(s)&&this.renderTile(s,this._tiles[n].el,r)}}queryTileFeaturesDebug(r,n,s=16){let a=new Map;for(let[o,l]of this.views)a.set(o,l.queryFeatures(r,n,this._map.getZoom(),s));return a}clearLayout(){this.labelers=new ve(this.scratch,this.labelRules,16,this.onTilesInvalidated)}rerenderTiles(){for(let r in this._tiles){let n=this._wrapCoords(this._keyToTileCoords(r)),s=this._tileCoordsToKey(n);this.renderTile(n,this._tiles[r].el,s)}}createTile(r,n){let s=L.DomUtil.create("canvas","leaflet-tile");s.lang=this.lang;let a=this._tileCoordsToKey(r);return s.key=a,this.renderTile(r,s,a,()=>{n(void 0,s)}),s}_removeTile(r){let n=this._tiles[r];n&&(n.el.removed=!0,n.el.key=void 0,L.DomUtil.removeClass(n.el,"leaflet-tile-loaded"),n.el.width=n.el.height=0,L.DomUtil.remove(n.el),delete this._tiles[r],this.fire("tileunload",{tile:n.el,coords:this._keyToTileCoords(r)}))}}return new e(i)};function qr(i,e){let t=Re[e];t&&(i.options.theme=e,i.paintRules=Ae(t),i.labelRules=Ie(t),i.backgroundColor=t.background,i.clearLayout(),i.rerenderTiles())}async function Or(){let i=await _t(),e={url:i.service.options.url,attribution:i.service.options.attribution};wt({layerFunction:ii,layerOptions:e,options:i,setLayerStyle:qr})}Or();
/*! For license information please see Protomaps-Leaflet.js.LEGAL.txt */
//# sourceMappingURL=Protomaps-Leaflet.js.map
