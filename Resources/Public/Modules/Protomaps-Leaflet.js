import{a as bt}from"./chunk-NSNFQC6K.js";import{a as Qt,b as er,c as g,o as pt}from"./chunk-KHGYU7TF.js";var Zt=Qt((st,at)=>{(function(r,e){typeof st=="object"&&typeof at<"u"?at.exports=e():typeof define=="function"&&define.amd?define(e):(r=r||self).RBush=e()})(st,function(){"use strict";function r(c,u,d,y,x){(function p(w,z,k,F,S){for(;F>k;){if(F-k>600){var C=F-k+1,B=z-k+1,G=Math.log(C),q=.5*Math.exp(2*G/3),X=.5*Math.sqrt(G*q*(C-q)/C)*(B-C/2<0?-1:1),N=Math.max(k,Math.floor(z-B*q/C+X)),_e=Math.min(F,Math.floor(z+(C-B)*q/C+X));p(w,z,N,_e,S)}var j=w[z],Q=k,Y=F;for(e(w,k,z),S(w[F],j)>0&&e(w,k,F);Q<Y;){for(e(w,Q,Y),Q++,Y--;S(w[Q],j)<0;)Q++;for(;S(w[Y],j)>0;)Y--}S(w[k],j)===0?e(w,k,Y):e(w,++Y,F),Y<=z&&(k=Y+1),z<=Y&&(F=Y-1)}})(c,u,d||0,y||c.length-1,x||t)}function e(c,u,d){var y=c[u];c[u]=c[d],c[d]=y}function t(c,u){return c<u?-1:c>u?1:0}var i=function(c){c===void 0&&(c=9),this._maxEntries=Math.max(4,c),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(c,u,d){if(!d)return u.indexOf(c);for(var y=0;y<u.length;y++)if(d(c,u[y]))return y;return-1}function s(c,u){a(c,0,c.children.length,u,c)}function a(c,u,d,y,x){x||(x=v(null)),x.minX=1/0,x.minY=1/0,x.maxX=-1/0,x.maxY=-1/0;for(var p=u;p<d;p++){var w=c.children[p];o(x,c.leaf?y(w):w)}return x}function o(c,u){return c.minX=Math.min(c.minX,u.minX),c.minY=Math.min(c.minY,u.minY),c.maxX=Math.max(c.maxX,u.maxX),c.maxY=Math.max(c.maxY,u.maxY),c}function l(c,u){return c.minX-u.minX}function f(c,u){return c.minY-u.minY}function h(c){return(c.maxX-c.minX)*(c.maxY-c.minY)}function m(c){return c.maxX-c.minX+(c.maxY-c.minY)}function b(c,u){return c.minX<=u.minX&&c.minY<=u.minY&&u.maxX<=c.maxX&&u.maxY<=c.maxY}function _(c,u){return u.minX<=c.maxX&&u.minY<=c.maxY&&u.maxX>=c.minX&&u.maxY>=c.minY}function v(c){return{children:c,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function T(c,u,d,y,x){for(var p=[u,d];p.length;)if(!((d=p.pop())-(u=p.pop())<=y)){var w=u+Math.ceil((d-u)/y/2)*y;r(c,w,u,d,x),p.push(u,w,w,d)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(c){var u=this.data,d=[];if(!_(c,u))return d;for(var y=this.toBBox,x=[];u;){for(var p=0;p<u.children.length;p++){var w=u.children[p],z=u.leaf?y(w):w;_(c,z)&&(u.leaf?d.push(w):b(c,z)?this._all(w,d):x.push(w))}u=x.pop()}return d},i.prototype.collides=function(c){var u=this.data;if(!_(c,u))return!1;for(var d=[];u;){for(var y=0;y<u.children.length;y++){var x=u.children[y],p=u.leaf?this.toBBox(x):x;if(_(c,p)){if(u.leaf||b(c,p))return!0;d.push(x)}}u=d.pop()}return!1},i.prototype.load=function(c){if(!c||!c.length)return this;if(c.length<this._minEntries){for(var u=0;u<c.length;u++)this.insert(c[u]);return this}var d=this._build(c.slice(),0,c.length-1,0);if(this.data.children.length)if(this.data.height===d.height)this._splitRoot(this.data,d);else{if(this.data.height<d.height){var y=this.data;this.data=d,d=y}this._insert(d,this.data.height-d.height-1,!0)}else this.data=d;return this},i.prototype.insert=function(c){return c&&this._insert(c,this.data.height-1),this},i.prototype.clear=function(){return this.data=v([]),this},i.prototype.remove=function(c,u){if(!c)return this;for(var d,y,x,p=this.data,w=this.toBBox(c),z=[],k=[];p||z.length;){if(p||(p=z.pop(),y=z[z.length-1],d=k.pop(),x=!0),p.leaf){var F=n(c,p.children,u);if(F!==-1)return p.children.splice(F,1),z.push(p),this._condense(z),this}x||p.leaf||!b(p,w)?y?(d++,p=y.children[d],x=!1):p=null:(z.push(p),k.push(d),d=0,y=p,p=p.children[0])}return this},i.prototype.toBBox=function(c){return c},i.prototype.compareMinX=function(c,u){return c.minX-u.minX},i.prototype.compareMinY=function(c,u){return c.minY-u.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(c){return this.data=c,this},i.prototype._all=function(c,u){for(var d=[];c;)c.leaf?u.push.apply(u,c.children):d.push.apply(d,c.children),c=d.pop();return u},i.prototype._build=function(c,u,d,y){var x,p=d-u+1,w=this._maxEntries;if(p<=w)return s(x=v(c.slice(u,d+1)),this.toBBox),x;y||(y=Math.ceil(Math.log(p)/Math.log(w)),w=Math.ceil(p/Math.pow(w,y-1))),(x=v([])).leaf=!1,x.height=y;var z=Math.ceil(p/w),k=z*Math.ceil(Math.sqrt(w));T(c,u,d,k,this.compareMinX);for(var F=u;F<=d;F+=k){var S=Math.min(F+k-1,d);T(c,F,S,z,this.compareMinY);for(var C=F;C<=S;C+=z){var B=Math.min(C+z-1,S);x.children.push(this._build(c,C,B,y-1))}}return s(x,this.toBBox),x},i.prototype._chooseSubtree=function(c,u,d,y){for(;y.push(u),!u.leaf&&y.length-1!==d;){for(var x=1/0,p=1/0,w=void 0,z=0;z<u.children.length;z++){var k=u.children[z],F=h(k),S=(C=c,B=k,(Math.max(B.maxX,C.maxX)-Math.min(B.minX,C.minX))*(Math.max(B.maxY,C.maxY)-Math.min(B.minY,C.minY))-F);S<p?(p=S,x=F<x?F:x,w=k):S===p&&F<x&&(x=F,w=k)}u=w||u.children[0]}var C,B;return u},i.prototype._insert=function(c,u,d){var y=d?c:this.toBBox(c),x=[],p=this._chooseSubtree(y,this.data,u,x);for(p.children.push(c),o(p,y);u>=0&&x[u].children.length>this._maxEntries;)this._split(x,u),u--;this._adjustParentBBoxes(y,x,u)},i.prototype._split=function(c,u){var d=c[u],y=d.children.length,x=this._minEntries;this._chooseSplitAxis(d,x,y);var p=this._chooseSplitIndex(d,x,y),w=v(d.children.splice(p,d.children.length-p));w.height=d.height,w.leaf=d.leaf,s(d,this.toBBox),s(w,this.toBBox),u?c[u-1].children.push(w):this._splitRoot(d,w)},i.prototype._splitRoot=function(c,u){this.data=v([c,u]),this.data.height=c.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(c,u,d){for(var y,x,p,w,z,k,F,S=1/0,C=1/0,B=u;B<=d-u;B++){var G=a(c,0,B,this.toBBox),q=a(c,B,d,this.toBBox),X=(x=G,p=q,w=void 0,z=void 0,k=void 0,F=void 0,w=Math.max(x.minX,p.minX),z=Math.max(x.minY,p.minY),k=Math.min(x.maxX,p.maxX),F=Math.min(x.maxY,p.maxY),Math.max(0,k-w)*Math.max(0,F-z)),N=h(G)+h(q);X<S?(S=X,y=B,C=N<C?N:C):X===S&&N<C&&(C=N,y=B)}return y||d-u},i.prototype._chooseSplitAxis=function(c,u,d){var y=c.leaf?this.compareMinX:l,x=c.leaf?this.compareMinY:f;this._allDistMargin(c,u,d,y)<this._allDistMargin(c,u,d,x)&&c.children.sort(y)},i.prototype._allDistMargin=function(c,u,d,y){c.children.sort(y);for(var x=this.toBBox,p=a(c,0,u,x),w=a(c,d-u,d,x),z=m(p)+m(w),k=u;k<d-u;k++){var F=c.children[k];o(p,c.leaf?x(F):F),z+=m(p)}for(var S=d-u-1;S>=u;S--){var C=c.children[S];o(w,c.leaf?x(C):C),z+=m(w)}return z},i.prototype._adjustParentBBoxes=function(c,u,d){for(var y=d;y>=0;y--)o(u[y],c)},i.prototype._condense=function(c){for(var u=c.length-1,d=void 0;u>=0;u--)c[u].children.length===0?u>0?(d=c[u-1].children).splice(d.indexOf(c[u]),1):this.clear():s(c[u],this.toBBox)},i})});function P(r,e){this.x=r,this.y=e}P.prototype={clone(){return new P(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,e){return this.clone()._rotateAround(r,e)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){let e=r.x-this.x,t=r.y-this.y;return e*e+t*t},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult(r){let e=r[0]*this.x+r[1]*this.y,t=r[2]*this.x+r[3]*this.y;return this.x=e,this.y=t,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){let r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){let e=Math.cos(r),t=Math.sin(r),i=e*this.x-t*this.y,n=t*this.x+e*this.y;return this.x=i,this.y=n,this},_rotateAround(r,e){let t=Math.cos(r),i=Math.sin(r),n=e.x+t*(this.x-e.x)-i*(this.y-e.y),s=e.y+i*(this.x-e.x)+t*(this.y-e.y);return this.x=n,this.y=s,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:P};P.convert=function(r){if(r instanceof P)return r;if(Array.isArray(r))return new P(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new P(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};function te(r,e,t){return Math.min(Math.max(r,t),e)}var Ne=class extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}},le=Ne;function gt(r){if(typeof r!="string")throw new le(r);if(r.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=r.trim();e=lr.test(r)?ir(r):r;let t=nr.exec(e);if(t){let a=Array.from(t).slice(1);return[...a.slice(0,3).map(o=>parseInt(ce(o,2),16)),parseInt(ce(a[3]||"f",2),16)/255]}let i=sr.exec(e);if(i){let a=Array.from(i).slice(1);return[...a.slice(0,3).map(o=>parseInt(o,16)),parseInt(a[3]||"ff",16)/255]}let n=ar.exec(e);if(n){let a=Array.from(n).slice(1);return[...a.slice(0,3).map(o=>parseInt(o,10)),parseFloat(a[3]||"1")]}let s=or.exec(e);if(s){let[a,o,l,f]=Array.from(s).slice(1).map(parseFloat);if(te(0,100,o)!==o)throw new le(r);if(te(0,100,l)!==l)throw new le(r);return[...cr(a,o,l),Number.isNaN(f)?1:f]}throw new le(r)}function tr(r){let e=5381,t=r.length;for(;t;)e=e*33^r.charCodeAt(--t);return(e>>>0)%2341}var yt=r=>parseInt(r.replace(/_/g,""),36),rr="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((r,e)=>{let t=yt(e.substring(0,3)),i=yt(e.substring(3)).toString(16),n="";for(let s=0;s<6-i.length;s++)n+="0";return r[t]=`${n}${i}`,r},{});function ir(r){let e=r.toLowerCase().trim(),t=rr[tr(e)];if(!t)throw new le(r);return`#${t}`}var ce=(r,e)=>Array.from(Array(e)).map(()=>r).join(""),nr=new RegExp(`^#${ce("([a-f0-9])",3)}([a-f0-9])?$`,"i"),sr=new RegExp(`^#${ce("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),ar=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${ce(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),or=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,lr=/^[a-z]+$/i,xt=r=>Math.round(r*255),cr=(r,e,t)=>{let i=t/100;if(e===0)return[i,i,i].map(xt);let n=(r%360+360)%360/60,s=(1-Math.abs(2*i-1))*(e/100),a=s*(1-Math.abs(n%2-1)),o=0,l=0,f=0;n>=0&&n<1?(o=s,l=a):n>=1&&n<2?(o=a,l=s):n>=2&&n<3?(l=s,f=a):n>=3&&n<4?(l=a,f=s):n>=4&&n<5?(o=a,f=s):n>=5&&n<6&&(o=s,f=a);let h=i-s/2,m=o+h,b=l+h,_=f+h;return[m,b,_].map(xt)};function fr(r,e,t,i){return`rgba(${te(0,255,r).toFixed()}, ${te(0,255,e).toFixed()}, ${te(0,255,t).toFixed()}, ${parseFloat(te(0,1,i).toFixed(3))})`}function we(r,e,t){let i=(p,w)=>w===3?p:p/255,[n,s,a,o]=gt(r).map(i),[l,f,h,m]=gt(e).map(i),b=m-o,_=t*2-1,T=((_*b===-1?_:_+b/(1+_*b))+1)/2,c=1-T,u=(n*c+l*T)*255,d=(s*c+f*T)*255,y=(a*c+h*T)*255,x=m*t+o*(1-t);return fr(u,d,y,x)}var E=class{constructor(e,t){g(this,"str");g(this,"perFeature");this.str=e??t,this.perFeature=typeof this.str=="function"&&this.str.length===2}get(e,t){return typeof this.str=="function"?this.str(e,t):this.str}},D=class{constructor(e,t=1){g(this,"value");g(this,"perFeature");this.value=e??t,this.perFeature=typeof this.value=="function"&&this.value.length===2}get(e,t){return typeof this.value=="function"?this.value(e,t):this.value}},fe=class{constructor(e){g(this,"labelProps");g(this,"textTransform");this.labelProps=e?.labelProps??["name"],this.textTransform=e?.textTransform}get(e,t){let i,n;typeof this.labelProps=="function"?n=this.labelProps(e,t):n=this.labelProps;for(let a of n)if(Object.prototype.hasOwnProperty.call(t.props,a)&&typeof t.props[a]=="string"){i=t.props[a];break}let s;return typeof this.textTransform=="function"?s=this.textTransform(e,t):s=this.textTransform,i&&s==="uppercase"?i=i.toUpperCase():i&&s==="lowercase"?i=i.toLowerCase():i&&s==="capitalize"&&(i=i.toLowerCase().split(" ").map(l=>l[0].toUpperCase()+l.slice(1)).join(" ")),i}},ue=class{constructor(e){g(this,"family");g(this,"size");g(this,"weight");g(this,"style");g(this,"font");e?.font?this.font=e.font:(this.family=e?.fontFamily??"sans-serif",this.size=e?.fontSize??12,this.weight=e?.fontWeight,this.style=e?.fontStyle)}get(e,t){if(this.font)return typeof this.font=="function"?this.font(e,t):this.font;let i="";this.style&&(typeof this.style=="function"?i=`${this.style(e,t)} `:i=`${this.style} `);let n="";this.weight&&(typeof this.weight=="function"?n=`${this.weight(e,t)} `:n=`${this.weight} `);let s;typeof this.size=="function"?s=this.size(e,t):s=this.size;let a;return typeof this.family=="function"?a=this.family(e,t):a=this.family,`${i}${n}${s}px ${a}`}},ve=class{constructor(e,t=[]){g(this,"value");g(this,"perFeature");this.value=e??t,this.perFeature=typeof this.value=="function"&&this.value.length===2}get(e,t){return typeof this.value=="function"?this.value(e,t):this.value}};var ur=(r,e,t)=>{let i=[],n,s,a,o=0,l=0,f=0,h=0,m=0,b=0,_=0,v=0,T=0,c=0,u=0,d=0;if(r.length<2)return[];if(r.length===2)return f=Math.sqrt((r[1].x-r[0].x)**2+(r[1].y-r[0].y)**2),[{length:f,beginIndex:0,beginDistance:0,endIndex:2,endDistance:f}];for(h=Math.sqrt((r[1].x-r[0].x)**2+(r[1].y-r[0].y)**2),o=1,l=r.length-1;o<l;o++)n=r[o-1],s=r[o],a=r[o+1],b=s.x-n.x,_=s.y-n.y,v=a.x-s.x,T=a.y-s.y,m=Math.sqrt(v*v+T*T),f+=h,c=Math.acos((b*v+_*T)/(h*m)),(c>e||f-d>t)&&(i.push({length:f-d,beginDistance:d,beginIndex:u,endIndex:o+1,endDistance:f}),u=o,d=f),h=m;return o-u>0&&i.push({length:f-d+m,beginIndex:u,beginDistance:d,endIndex:o+1,endDistance:f+m}),i};function _t(r,e,t,i){let n=[];for(let s of r){let a=ur(s,Math.PI/45,e);for(let o of a)if(o.length>=e+i){let l=new P(s[o.beginIndex].x,s[o.beginIndex].y),f=s[o.endIndex-1],h=new P((f.x-l.x)/o.length,(f.y-l.y)/o.length);for(let m=i;m<o.length-e;m+=t)n.push({start:l.add(h.mult(m)),end:l.add(h.mult(m+e))})}}return n}function wt(r,e,t,i){let n=e.x-r.x,s=e.y-r.y,a=Math.sqrt((e.x-r.x)**2+(e.y-r.y)**2),o=[];for(let l=0;l<t+i;l+=2*i){let f=l*1/a;o.push({x:r.x+f*n,y:r.y+f*s})}return o}function He(r,e){if(r.length<=e)return[r];let t=e-1,i=r.lastIndexOf(" ",t),n=r.indexOf(" ",t);if(i===-1&&n===-1)return[r];let s,a;return n===-1||i>=0&&t-i<n-t?(s=r.substring(0,i),a=r.substring(i+1,r.length)):(s=r.substring(0,n),a=r.substring(n+1,r.length)),[s,...He(a,e)]}var hr="\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DB5\u4E00-\u9FEA\uF900-\uFA6D\uFA70-\uFAD9\u2000",Zi=new RegExp(`^[${hr}]+$`);var ke=class{constructor(e,t,i,n,s){this.properties={},this.extent=i,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=s,e.readFields(dr,this,t)}loadGeometry(){let e=this._pbf;e.pos=this._geometry;let t=e.readVarint()+e.pos,i=[],n,s=1,a=0,o=0,l=0;for(;e.pos<t;){if(a<=0){let f=e.readVarint();s=f&7,a=f>>3}if(a--,s===1||s===2)o+=e.readSVarint(),l+=e.readSVarint(),s===1&&(n&&i.push(n),n=[]),n&&n.push(new P(o,l));else if(s===7)n&&n.push(n[0].clone());else throw new Error(`unknown command ${s}`)}return n&&i.push(n),i}bbox(){let e=this._pbf;e.pos=this._geometry;let t=e.readVarint()+e.pos,i=1,n=0,s=0,a=0,o=1/0,l=-1/0,f=1/0,h=-1/0;for(;e.pos<t;){if(n<=0){let m=e.readVarint();i=m&7,n=m>>3}if(n--,i===1||i===2)s+=e.readSVarint(),a+=e.readSVarint(),s<o&&(o=s),s>l&&(l=s),a<f&&(f=a),a>h&&(h=a);else if(i!==7)throw new Error(`unknown command ${i}`)}return[o,f,l,h]}toGeoJSON(e,t,i){let n=this.extent*Math.pow(2,i),s=this.extent*e,a=this.extent*t,o=this.loadGeometry();function l(b){return[(b.x+s)*360/n-180,360/Math.PI*Math.atan(Math.exp((1-(b.y+a)*2/n)*Math.PI))-90]}function f(b){return b.map(l)}let h;if(this.type===1){let b=[];for(let v of o)b.push(v[0]);let _=f(b);h=b.length===1?{type:"Point",coordinates:_[0]}:{type:"MultiPoint",coordinates:_}}else if(this.type===2){let b=o.map(f);h=b.length===1?{type:"LineString",coordinates:b[0]}:{type:"MultiLineString",coordinates:b}}else if(this.type===3){let b=pr(o),_=[];for(let v of b)_.push(v.map(f));h=_.length===1?{type:"Polygon",coordinates:_[0]}:{type:"MultiPolygon",coordinates:_}}else throw new Error("unknown feature type");let m={type:"Feature",geometry:h,properties:this.properties};return this.id!=null&&(m.id=this.id),m}};ke.types=["Unknown","Point","LineString","Polygon"];function dr(r,e,t){r===1?e.id=t.readVarint():r===2?mr(t,e):r===3?e.type=t.readVarint():r===4&&(e._geometry=t.pos)}function mr(r,e){let t=r.readVarint()+r.pos;for(;r.pos<t;){let i=e._keys[r.readVarint()],n=e._values[r.readVarint()];e.properties[i]=n}}function pr(r){let e=r.length;if(e<=1)return[r];let t=[],i,n;for(let s=0;s<e;s++){let a=br(r[s]);a!==0&&(n===void 0&&(n=a<0),n===a<0?(i&&t.push(i),i=[r[s]]):i&&i.push(r[s]))}return i&&t.push(i),t}function br(r){let e=0;for(let t=0,i=r.length,n=i-1,s,a;t<i;n=t++)s=r[t],a=r[n],e+=(a.x-s.x)*(s.y+a.y);return e}var Ze=class{constructor(e,t){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(gr,this,t),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];let t=this._pbf.readVarint()+this._pbf.pos;return new ke(this._pbf,t,this.extent,this._keys,this._values)}};function gr(r,e,t){r===15?e.version=t.readVarint():r===1?e.name=t.readString():r===5?e.extent=t.readVarint():r===2?e._features.push(t.pos):r===3?e._keys.push(t.readString()):r===4&&e._values.push(yr(t))}function yr(r){let e=null,t=r.readVarint()+r.pos;for(;r.pos<t;){let i=r.readVarint()>>3;e=i===1?r.readString():i===2?r.readFloat():i===3?r.readDouble():i===4?r.readVarint64():i===5?r.readVarint():i===6?r.readSVarint():i===7?r.readBoolean():null}if(e==null)throw new Error("unknown feature value");return e}var ze=class{constructor(e,t){this.layers=e.readFields(xr,{},t)}};function xr(r,e,t){if(r===3){let i=new Ze(t,t.readVarint()+t.pos);i.length&&(e[i.name]=i)}}var vt=23283064365386963e-26,_r=12,kt=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),qe=0,Le=1,he=2,Te=5,de=class{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,t,i=this.length){for(;this.pos<i;){let n=this.readVarint(),s=n>>3,a=this.pos;this.type=n&7,e(s,t,this),this.pos===a&&this.skip(n)}return t}readMessage(e,t){return this.readFields(e,t,this.readVarint()+this.pos)}readFixed32(){let e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){let e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){let e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*4294967296;return this.pos+=8,e}readSFixed64(){let e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*4294967296;return this.pos+=8,e}readFloat(){let e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){let e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){let t=this.buf,i,n;return n=t[this.pos++],i=n&127,n<128||(n=t[this.pos++],i|=(n&127)<<7,n<128)||(n=t[this.pos++],i|=(n&127)<<14,n<128)||(n=t[this.pos++],i|=(n&127)<<21,n<128)?i:(n=t[this.pos],i|=(n&15)<<28,wr(i,e,this))}readVarint64(){return this.readVarint(!0)}readSVarint(){let e=this.readVarint();return e%2===1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){let e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=_r&&kt?kt.decode(this.buf.subarray(t,e)):Br(this.buf,t,e)}readBytes(){let e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t}readPackedVarint(e=[],t){let i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readVarint(t));return e}readPackedSVarint(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFloat());return e}readPackedDouble(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===he?this.readVarint()+this.pos:this.pos+1}skip(e){let t=e&7;if(t===qe)for(;this.buf[this.pos++]>127;);else if(t===he)this.pos=this.readVarint()+this.pos;else if(t===Te)this.pos+=4;else if(t===Le)this.pos+=8;else throw new Error(`Unimplemented type: ${t}`)}writeTag(e,t){this.writeVarint(e<<3|t)}realloc(e){let t=this.length||16;for(;t<this.pos+e;)t*=2;if(t!==this.length){let i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*vt),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*vt),!0),this.pos+=8}writeVarint(e){if(e=+e||0,e>268435455||e<0){vr(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))}writeSVarint(e){this.writeVarint(e<0?-e*2-1:e*2)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(e.length*4),this.pos++;let t=this.pos;this.pos=jr(this.buf,e,this.pos);let i=this.pos-t;i>=128&&zt(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){let t=e.length;this.writeVarint(t),this.realloc(t);for(let i=0;i<t;i++)this.buf[this.pos++]=e[i]}writeRawMessage(e,t){this.pos++;let i=this.pos;e(t,this);let n=this.pos-i;n>=128&&zt(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n}writeMessage(e,t,i){this.writeTag(e,he),this.writeRawMessage(t,i)}writePackedVarint(e,t){t.length&&this.writeMessage(e,Lr,t)}writePackedSVarint(e,t){t.length&&this.writeMessage(e,Tr,t)}writePackedBoolean(e,t){t.length&&this.writeMessage(e,Sr,t)}writePackedFloat(e,t){t.length&&this.writeMessage(e,Fr,t)}writePackedDouble(e,t){t.length&&this.writeMessage(e,Pr,t)}writePackedFixed32(e,t){t.length&&this.writeMessage(e,Cr,t)}writePackedSFixed32(e,t){t.length&&this.writeMessage(e,Mr,t)}writePackedFixed64(e,t){t.length&&this.writeMessage(e,Dr,t)}writePackedSFixed64(e,t){t.length&&this.writeMessage(e,Ar,t)}writeBytesField(e,t){this.writeTag(e,he),this.writeBytes(t)}writeFixed32Field(e,t){this.writeTag(e,Te),this.writeFixed32(t)}writeSFixed32Field(e,t){this.writeTag(e,Te),this.writeSFixed32(t)}writeFixed64Field(e,t){this.writeTag(e,Le),this.writeFixed64(t)}writeSFixed64Field(e,t){this.writeTag(e,Le),this.writeSFixed64(t)}writeVarintField(e,t){this.writeTag(e,qe),this.writeVarint(t)}writeSVarintField(e,t){this.writeTag(e,qe),this.writeSVarint(t)}writeStringField(e,t){this.writeTag(e,he),this.writeString(t)}writeFloatField(e,t){this.writeTag(e,Te),this.writeFloat(t)}writeDoubleField(e,t){this.writeTag(e,Le),this.writeDouble(t)}writeBooleanField(e,t){this.writeVarintField(e,+t)}};function wr(r,e,t){let i=t.buf,n,s;if(s=i[t.pos++],n=(s&112)>>4,s<128||(s=i[t.pos++],n|=(s&127)<<3,s<128)||(s=i[t.pos++],n|=(s&127)<<10,s<128)||(s=i[t.pos++],n|=(s&127)<<17,s<128)||(s=i[t.pos++],n|=(s&127)<<24,s<128)||(s=i[t.pos++],n|=(s&1)<<31,s<128))return re(r,n,e);throw new Error("Expected varint not more than 10 bytes")}function re(r,e,t){return t?e*4294967296+(r>>>0):(e>>>0)*4294967296+(r>>>0)}function vr(r,e){let t,i;if(r>=0?(t=r%4294967296|0,i=r/4294967296|0):(t=~(-r%4294967296),i=~(-r/4294967296),t^4294967295?t=t+1|0:(t=0,i=i+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),kr(t,i,e),zr(i,e)}function kr(r,e,t){t.buf[t.pos++]=r&127|128,r>>>=7,t.buf[t.pos++]=r&127|128,r>>>=7,t.buf[t.pos++]=r&127|128,r>>>=7,t.buf[t.pos++]=r&127|128,r>>>=7,t.buf[t.pos]=r&127}function zr(r,e){let t=(r&7)<<4;e.buf[e.pos++]|=t|((r>>>=3)?128:0),r&&(e.buf[e.pos++]=r&127|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=r&127|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=r&127|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=r&127|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=r&127)))))}function zt(r,e,t){let i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));t.realloc(i);for(let n=t.pos-1;n>=r;n--)t.buf[n+i]=t.buf[n]}function Lr(r,e){for(let t=0;t<r.length;t++)e.writeVarint(r[t])}function Tr(r,e){for(let t=0;t<r.length;t++)e.writeSVarint(r[t])}function Fr(r,e){for(let t=0;t<r.length;t++)e.writeFloat(r[t])}function Pr(r,e){for(let t=0;t<r.length;t++)e.writeDouble(r[t])}function Sr(r,e){for(let t=0;t<r.length;t++)e.writeBoolean(r[t])}function Cr(r,e){for(let t=0;t<r.length;t++)e.writeFixed32(r[t])}function Mr(r,e){for(let t=0;t<r.length;t++)e.writeSFixed32(r[t])}function Dr(r,e){for(let t=0;t<r.length;t++)e.writeFixed64(r[t])}function Ar(r,e){for(let t=0;t<r.length;t++)e.writeSFixed64(r[t])}function Br(r,e,t){let i="",n=e;for(;n<t;){let s=r[n],a=null,o=s>239?4:s>223?3:s>191?2:1;if(n+o>t)break;let l,f,h;o===1?s<128&&(a=s):o===2?(l=r[n+1],(l&192)===128&&(a=(s&31)<<6|l&63,a<=127&&(a=null))):o===3?(l=r[n+1],f=r[n+2],(l&192)===128&&(f&192)===128&&(a=(s&15)<<12|(l&63)<<6|f&63,(a<=2047||a>=55296&&a<=57343)&&(a=null))):o===4&&(l=r[n+1],f=r[n+2],h=r[n+3],(l&192)===128&&(f&192)===128&&(h&192)===128&&(a=(s&15)<<18|(l&63)<<12|(f&63)<<6|h&63,(a<=65535||a>=1114112)&&(a=null))),a===null?(a=65533,o=1):a>65535&&(a-=65536,i+=String.fromCharCode(a>>>10&1023|55296),a=56320|a&1023),i+=String.fromCharCode(a),n+=o}return i}function jr(r,e,t){for(let i=0,n,s;i<e.length;i++){if(n=e.charCodeAt(i),n>55295&&n<57344)if(s)if(n<56320){r[t++]=239,r[t++]=191,r[t++]=189,s=n;continue}else n=s-55296<<10|n-56320|65536,s=null;else{n>56319||i+1===e.length?(r[t++]=239,r[t++]=191,r[t++]=189):s=n;continue}else s&&(r[t++]=239,r[t++]=191,r[t++]=189,s=null);n<128?r[t++]=n:(n<2048?r[t++]=n>>6|192:(n<65536?r[t++]=n>>12|224:(r[t++]=n>>18|240,r[t++]=n>>12&63|128),r[t++]=n>>6&63|128),r[t++]=n&63|128)}return t}var se=Math.pow,O=(r,e,t)=>new Promise((i,n)=>{var s=l=>{try{o(t.next(l))}catch(f){n(f)}},a=l=>{try{o(t.throw(l))}catch(f){n(f)}},o=l=>l.done?i(l.value):Promise.resolve(l.value).then(s,a);o((t=t.apply(r,e)).next())}),I=Uint8Array,ne=Uint16Array,Or=Int32Array,Ft=new I([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Pt=new I([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Rr=new I([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),St=function(r,e){for(var t=new ne(31),i=0;i<31;++i)t[i]=e+=1<<r[i-1];for(var n=new Or(t[30]),i=1;i<30;++i)for(var s=t[i];s<t[i+1];++s)n[s]=s-t[i]<<5|i;return{b:t,r:n}},Ct=St(Ft,2),Mt=Ct.b,Er=Ct.r;Mt[28]=258,Er[258]=28;var Dt=St(Pt,0),Xr=Dt.b,Gi=Dt.r,Ke=new ne(32768);for(M=0;M<32768;++M)W=(M&43690)>>1|(M&21845)<<1,W=(W&52428)>>2|(W&13107)<<2,W=(W&61680)>>4|(W&3855)<<4,Ke[M]=((W&65280)>>8|(W&255)<<8)>>1;var W,M,be=function(r,e,t){for(var i=r.length,n=0,s=new ne(e);n<i;++n)r[n]&&++s[r[n]-1];var a=new ne(e);for(n=1;n<e;++n)a[n]=a[n-1]+s[n-1]<<1;var o;if(t){o=new ne(1<<e);var l=15-e;for(n=0;n<i;++n)if(r[n])for(var f=n<<4|r[n],h=e-r[n],m=a[r[n]-1]++<<h,b=m|(1<<h)-1;m<=b;++m)o[Ke[m]>>l]=f}else for(o=new ne(i),n=0;n<i;++n)r[n]&&(o[n]=Ke[a[r[n]-1]++]>>15-r[n]);return o},ge=new I(288);for(M=0;M<144;++M)ge[M]=8;var M;for(M=144;M<256;++M)ge[M]=9;var M;for(M=256;M<280;++M)ge[M]=7;var M;for(M=280;M<288;++M)ge[M]=8;var M,At=new I(32);for(M=0;M<32;++M)At[M]=5;var M,Yr=be(ge,9,1),Vr=be(At,5,1),We=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},H=function(r,e,t){var i=e/8|0;return(r[i]|r[i+1]<<8)>>(e&7)&t},Je=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},Ir=function(r){return(r+7)/8|0},Ur=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var i=new I(t-e);return i.set(r.subarray(e,t)),i},$r=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],V=function(r,e,t){var i=new Error(e||$r[r]);if(i.code=r,Error.captureStackTrace&&Error.captureStackTrace(i,V),!t)throw i;return i},et=function(r,e,t,i){var n=r.length,s=i?i.length:0;if(!n||e.f&&!e.l)return t||new I(0);var a=!t||e.i!=2,o=e.i;t||(t=new I(n*3));var l=function(ht){var dt=t.length;if(ht>dt){var mt=new I(Math.max(dt*2,ht));mt.set(t),t=mt}},f=e.f||0,h=e.p||0,m=e.b||0,b=e.l,_=e.d,v=e.m,T=e.n,c=n*8;do{if(!b){f=H(r,h,1);var u=H(r,h+1,3);if(h+=3,u)if(u==1)b=Yr,_=Vr,v=9,T=5;else if(u==2){var p=H(r,h,31)+257,w=H(r,h+10,15)+4,z=p+H(r,h+5,31)+1;h+=14;for(var k=new I(z),F=new I(19),S=0;S<w;++S)F[Rr[S]]=H(r,h+S*3,7);h+=w*3;for(var C=We(F),B=(1<<C)-1,G=be(F,C,1),S=0;S<z;){var q=G[H(r,h,B)];h+=q&15;var d=q>>4;if(d<16)k[S++]=d;else{var X=0,N=0;for(d==16?(N=3+H(r,h,3),h+=2,X=k[S-1]):d==17?(N=3+H(r,h,7),h+=3):d==18&&(N=11+H(r,h,127),h+=7);N--;)k[S++]=X}}var _e=k.subarray(0,p),j=k.subarray(p);v=We(_e),T=We(j),b=be(_e,v,1),_=be(j,T,1)}else V(1);else{var d=Ir(h)+4,y=r[d-4]|r[d-3]<<8,x=d+y;if(x>n){o&&V(0);break}a&&l(m+y),t.set(r.subarray(d,x),m),e.b=m+=y,e.p=h=x*8,e.f=f;continue}if(h>c){o&&V(0);break}}a&&l(m+131072);for(var Q=(1<<v)-1,Y=(1<<T)-1,Ve=h;;Ve=h){var X=b[Je(r,h)&Q],ee=X>>4;if(h+=X&15,h>c){o&&V(0);break}if(X||V(2),ee<256)t[m++]=ee;else if(ee==256){Ve=h,b=null;break}else{var ft=ee-254;if(ee>264){var S=ee-257,oe=Ft[S];ft=H(r,h,(1<<oe)-1)+Mt[S],h+=oe}var Ie=_[Je(r,h)&Y],Ue=Ie>>4;Ie||V(3),h+=Ie&15;var j=Xr[Ue];if(Ue>3){var oe=Pt[Ue];j+=Je(r,h)&(1<<oe)-1,h+=oe}if(h>c){o&&V(0);break}a&&l(m+131072);var $e=m+ft;if(m<j){var ut=s-j,Gt=Math.min(j,$e);for(ut+m<0&&V(3);m<Gt;++m)t[m]=i[ut+m]}for(;m<$e;m+=4)t[m]=t[m-j],t[m+1]=t[m+1-j],t[m+2]=t[m+2-j],t[m+3]=t[m+3-j];m=$e}}e.l=b,e.p=Ve,e.b=m,e.f=f,b&&(f=1,e.m=v,e.d=_,e.n=T)}while(!f);return m==t.length?t:Ur(t,0,m)},Nr=new I(0),Hr=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&V(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!r[t++]);return t+(e&2)},Zr=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},qr=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&V(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&V(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function Wr(r,e){return et(r,{i:2},e&&e.out,e&&e.dictionary)}function Jr(r,e){var t=Hr(r);return t+8>r.length&&V(6,"invalid gzip data"),et(r.subarray(t,-8),{i:2},e&&e.out||new I(Zr(r)),e&&e.dictionary)}function Kr(r,e){return et(r.subarray(qr(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Ge(r,e){return r[0]==31&&r[1]==139&&r[2]==8?Jr(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?Wr(r,e):Kr(r,e)}var Gr=typeof TextDecoder<"u"&&new TextDecoder,Qr=0;try{Gr.decode(Nr,{stream:!0}),Qr=1}catch{}var Bt=(r,e)=>r*se(2,e),me=(r,e)=>Math.floor(r/se(2,e)),Fe=(r,e)=>Bt(r.getUint16(e+1,!0),8)+r.getUint8(e),jt=(r,e)=>Bt(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),ei=(r,e,t,i,n)=>{if(r!==i.getUint8(n))return r-i.getUint8(n);let s=Fe(i,n+1);if(e!==s)return e-s;let a=Fe(i,n+4);return t!==a?t-a:0},ti=(r,e,t,i)=>{let n=Ot(r,e|128,t,i);return n?{z:e,x:t,y:i,offset:n[0],length:n[1],isDir:!0}:null},Lt=(r,e,t,i)=>{let n=Ot(r,e,t,i);return n?{z:e,x:t,y:i,offset:n[0],length:n[1],isDir:!1}:null},Ot=(r,e,t,i)=>{let n=0,s=r.byteLength/17-1;for(;n<=s;){let a=s+n>>1,o=ei(e,t,i,r,a*17);if(o>0)n=a+1;else if(o<0)s=a-1;else return[jt(r,a*17+7),r.getUint32(a*17+13,!0)]}return null},ri=(r,e)=>r.isDir&&!e.isDir?1:!r.isDir&&e.isDir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,Rt=(r,e)=>{let t=r.getUint8(e*17);return{z:t&127,x:Fe(r,e*17+1),y:Fe(r,e*17+4),offset:jt(r,e*17+7),length:r.getUint32(e*17+13,!0),isDir:t>>7===1}},Tt=r=>{let e=[],t=new DataView(r);for(let i=0;i<t.byteLength/17;i++)e.push(Rt(t,i));return ii(e)},ii=r=>{r.sort(ri);let e=new ArrayBuffer(17*r.length),t=new Uint8Array(e);for(let i=0;i<r.length;i++){let n=r[i],s=n.z;n.isDir&&(s=s|128),t[i*17]=s,t[i*17+1]=n.x&255,t[i*17+2]=n.x>>8&255,t[i*17+3]=n.x>>16&255,t[i*17+4]=n.y&255,t[i*17+5]=n.y>>8&255,t[i*17+6]=n.y>>16&255,t[i*17+7]=n.offset&255,t[i*17+8]=me(n.offset,8)&255,t[i*17+9]=me(n.offset,16)&255,t[i*17+10]=me(n.offset,24)&255,t[i*17+11]=me(n.offset,32)&255,t[i*17+12]=me(n.offset,48)&255,t[i*17+13]=n.length&255,t[i*17+14]=n.length>>8&255,t[i*17+15]=n.length>>16&255,t[i*17+16]=n.length>>24&255}return e},ni=(r,e)=>{if(r.byteLength<17)return null;let t=r.byteLength/17,i=Rt(r,t-1);if(i.isDir){let n=i.z,s=e.z-n,a=Math.trunc(e.x/(1<<s)),o=Math.trunc(e.y/(1<<s));return{z:n,x:a,y:o}}return null};function si(r){return O(this,null,function*(){let e=yield r.getBytes(0,512e3),t=new DataView(e.data),i=t.getUint32(4,!0),n=t.getUint16(8,!0),s=new TextDecoder("utf-8"),a=JSON.parse(s.decode(new DataView(e.data,10,i))),o=0;a.compression==="gzip"&&(o=2);let l=0;"minzoom"in a&&(l=+a.minzoom);let f=0;"maxzoom"in a&&(f=+a.maxzoom);let h=0,m=0,b=0,_=-180,v=-85,T=180,c=85;if(a.bounds){let d=a.bounds.split(",");_=+d[0],v=+d[1],T=+d[2],c=+d[3]}if(a.center){let d=a.center.split(",");h=+d[0],m=+d[1],b=+d[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+i,rootDirectoryLength:n*17,jsonMetadataOffset:10,jsonMetadataLength:i,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:o,tileType:1,minZoom:l,maxZoom:f,minLon:_,minLat:v,maxLon:T,maxLat:c,centerZoom:b,centerLon:h,centerLat:m,etag:e.etag}})}function ai(r,e,t,i,n,s,a){return O(this,null,function*(){let o=yield t.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(o=Tt(o));let l=Lt(new DataView(o),i,n,s);if(l){let m=(yield e.getBytes(l.offset,l.length,a)).data,b=new DataView(m);return b.getUint8(0)===31&&b.getUint8(1)===139&&(m=Ge(new Uint8Array(m))),{data:m}}let f=ni(new DataView(o),{z:i,x:n,y:s});if(f){let h=ti(new DataView(o),f.z,f.x,f.y);if(h){let m=yield t.getArrayBuffer(e,h.offset,h.length,r);r.specVersion===1&&(m=Tt(m));let b=Lt(new DataView(m),i,n,s);if(b){let v=(yield e.getBytes(b.offset,b.length,a)).data,T=new DataView(v);return T.getUint8(0)===31&&T.getUint8(1)===139&&(v=Ge(new Uint8Array(v))),{data:v}}}}})}var Et={getHeader:si,getZxy:ai};function ie(r,e){return(e>>>0)*4294967296+(r>>>0)}function oi(r,e){let t=e.buf,i=t[e.pos++],n=(i&112)>>4;if(i<128||(i=t[e.pos++],n|=(i&127)<<3,i<128)||(i=t[e.pos++],n|=(i&127)<<10,i<128)||(i=t[e.pos++],n|=(i&127)<<17,i<128)||(i=t[e.pos++],n|=(i&127)<<24,i<128)||(i=t[e.pos++],n|=(i&1)<<31,i<128))return ie(r,n);throw new Error("Expected varint not more than 10 bytes")}function pe(r){let e=r.buf,t=e[r.pos++],i=t&127;return t<128||(t=e[r.pos++],i|=(t&127)<<7,t<128)||(t=e[r.pos++],i|=(t&127)<<14,t<128)||(t=e[r.pos++],i|=(t&127)<<21,t<128)?i:(t=e[r.pos],i|=(t&15)<<28,oi(i,r))}function li(r,e,t,i){if(i===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);let n=e[0];e[0]=e[1],e[1]=n}}var ci=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function fi(r,e,t){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>se(2,r)-1||t>se(2,r)-1)throw Error("tile x/y outside zoom level bounds");let i=ci[r],n=se(2,r),s=0,a=0,o=0,l=[e,t],f=n/2;for(;f>0;)s=(l[0]&f)>0?1:0,a=(l[1]&f)>0?1:0,o+=f*f*(3*s^a),li(f,l,s,a),f=f/2;return i+o}function Xt(r,e){return O(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Ge(new Uint8Array(r));let t=new Response(r).body;if(!t)throw Error("Failed to read response stream");let i=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(i).arrayBuffer()}throw Error("Compression method not supported")})}function ui(r){return r===1?".mvt":r===2?".png":r===3?".jpg":r===4?".webp":r===5?".avif":""}var hi=127;function di(r,e){let t=0,i=r.length-1;for(;t<=i;){let n=i+t>>1,s=e-r[n].tileId;if(s>0)t=n+1;else if(s<0)i=n-1;else return r[n]}return i>=0&&(r[i].runLength===0||e-r[i].tileId<r[i].runLength)?r[i]:null}var mi=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e,this.mustReload=!1;let t="";"navigator"in globalThis&&(t=globalThis.navigator.userAgent||"");let i=t.indexOf("Windows")>-1,n=/Chrome|Chromium|Edg|OPR|Brave/.test(t);this.chromeWindowsNoCache=!1,i&&n&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,t,i){return O(this,null,function*(){let n,s;t?s=t:(n=new AbortController,s=n.signal);let a=new Headers(this.customHeaders);a.set("range",`bytes=${r}-${r+e-1}`);let o;this.mustReload?o="reload":this.chromeWindowsNoCache&&(o="no-store");let l=yield fetch(this.url,{signal:s,cache:o,headers:a});if(r===0&&l.status===416){let b=l.headers.get("Content-Range");if(!b||!b.startsWith("bytes */"))throw Error("Missing content-length on 416 response");let _=+b.substr(8);l=yield fetch(this.url,{signal:s,cache:"reload",headers:{range:`bytes=0-${_-1}`}})}let f=l.headers.get("Etag");if(f?.startsWith("W/")&&(f=null),l.status===416||i&&f&&f!==i)throw this.mustReload=!0,new Qe(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(l.status>=300)throw Error(`Bad response code: ${l.status}`);let h=l.headers.get("Content-Length");if(l.status===200&&(!h||+h>e))throw n&&n.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield l.arrayBuffer(),etag:f||void 0,cacheControl:l.headers.get("Cache-Control")||void 0,expires:l.headers.get("Expires")||void 0}})}};function Z(r,e){let t=r.getUint32(e+4,!0),i=r.getUint32(e+0,!0);return t*se(2,32)+i}function pi(r,e){let t=new DataView(r),i=t.getUint8(7);if(i>3)throw Error(`Archive is spec version ${i} but this library supports up to spec version 3`);return{specVersion:i,rootDirectoryOffset:Z(t,8),rootDirectoryLength:Z(t,16),jsonMetadataOffset:Z(t,24),jsonMetadataLength:Z(t,32),leafDirectoryOffset:Z(t,40),leafDirectoryLength:Z(t,48),tileDataOffset:Z(t,56),tileDataLength:Z(t,64),numAddressedTiles:Z(t,72),numTileEntries:Z(t,80),numTileContents:Z(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function Yt(r){let e={buf:new Uint8Array(r),pos:0},t=pe(e),i=[],n=0;for(let s=0;s<t;s++){let a=pe(e);i.push({tileId:n+a,offset:0,length:0,runLength:1}),n+=a}for(let s=0;s<t;s++)i[s].runLength=pe(e);for(let s=0;s<t;s++)i[s].length=pe(e);for(let s=0;s<t;s++){let a=pe(e);a===0&&s>0?i[s].offset=i[s-1].offset+i[s-1].length:i[s].offset=a-1}return i}function bi(r){let e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Qe=class extends Error{};function gi(r,e){return O(this,null,function*(){let t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(bi(t.data)<3)return[yield Et.getHeader(r)];let n=t.data.slice(0,hi),s=pi(n,t.etag),a=t.data.slice(s.rootDirectoryOffset,s.rootDirectoryOffset+s.rootDirectoryLength),o=`${r.getKey()}|${s.etag||""}|${s.rootDirectoryOffset}|${s.rootDirectoryLength}`,l=Yt(yield e(a,s.internalCompression));return[s,[o,l.length,l]]})}function yi(r,e,t,i,n){return O(this,null,function*(){let s=yield r.getBytes(t,i,void 0,n.etag),a=yield e(s.data,n.internalCompression),o=Yt(a);if(o.length===0)throw new Error("Empty directory is invalid");return o})}var xi=class{constructor(r=100,e=!0,t=Xt){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=r,this.counter=1,this.decompress=t}getHeader(r){return O(this,null,function*(){let e=r.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;let i=new Promise((n,s)=>{gi(r,this.decompress).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),n(a[0]),this.prune()}).catch(a=>{s(a)})});return this.cache.set(e,{lastUsed:this.counter++,data:i}),i})}getDirectory(r,e,t,i){return O(this,null,function*(){let n=`${r.getKey()}|${i.etag||""}|${e}|${t}`,s=this.cache.get(n);if(s)return s.lastUsed=this.counter++,yield s.data;let a=new Promise((o,l)=>{yi(r,this.decompress,e,t,i).then(f=>{o(f),this.prune()}).catch(f=>{l(f)})});return this.cache.set(n,{lastUsed:this.counter++,data:a}),a})}getArrayBuffer(r,e,t,i){return O(this,null,function*(){let n=`${r.getKey()}|${i.etag||""}|${e}|${t}`,s=this.cache.get(n);if(s)return s.lastUsed=this.counter++,yield s.data;let a=new Promise((o,l)=>{r.getBytes(e,t,void 0,i.etag).then(f=>{o(f.data),this.cache.has(n),this.prune()}).catch(f=>{l(f)})});return this.cache.set(n,{lastUsed:this.counter++,data:a}),a})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((t,i)=>{t.lastUsed<r&&(r=t.lastUsed,e=i)}),e&&this.cache.delete(e)}}invalidate(r){return O(this,null,function*(){let e=r.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(r.getKey());let t=new Promise((i,n)=>{this.getHeader(r).then(s=>{i(),this.invalidations.delete(e)}).catch(s=>{n(s)})});this.invalidations.set(e,t)})}},Vt=class{constructor(r,e,t){typeof r=="string"?this.source=new mi(r):this.source=r,t?this.decompress=t:this.decompress=Xt,e?this.cache=e:this.cache=new xi}getHeader(){return O(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,t,i){return O(this,null,function*(){let n=fi(r,e,t),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return Et.getZxy(s,this.source,this.cache,r,e,t,i);if(r<s.minZoom||r>s.maxZoom)return;let a=s.rootDirectoryOffset,o=s.rootDirectoryLength;for(let l=0;l<=3;l++){let f=yield this.cache.getDirectory(this.source,a,o,s),h=di(f,n);if(h){if(h.runLength>0){let m=yield this.source.getBytes(s.tileDataOffset+h.offset,h.length,i,s.etag);return{data:yield this.decompress(m.data,s.tileCompression),cacheControl:m.cacheControl,expires:m.expires}}a=s.leafDirectoryOffset+h.offset,o=h.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,t,i){return O(this,null,function*(){try{return yield this.getZxyAttempt(r,e,t,i)}catch(n){if(n instanceof Qe)return this.cache.invalidate(this.source),yield this.getZxyAttempt(r,e,t,i);throw n}})}getMetadataAttempt(){return O(this,null,function*(){let r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength,void 0,r.etag),t=yield this.decompress(e.data,r.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(t))})}getMetadata(){return O(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof Qe)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw r}})}getTileJson(r){return O(this,null,function*(){let e=yield this.getHeader(),t=yield this.getMetadata(),i=ui(e.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${r}/{z}/{x}/{y}${i}`],vector_layers:t.vector_layers,attribution:t.attribution,description:t.description,name:t.name,version:t.version,bounds:[e.minLon,e.minLat,e.maxLon,e.maxLat],center:[e.centerLon,e.centerLat,e.centerZoom],minzoom:e.minZoom,maxzoom:e.maxZoom}})}};function J(r){return`${r.x}:${r.y}:${r.z}`}var _i=(r,e,t)=>{r.pos=e;let i=r.readVarint()+r.pos,n=1,s=0,a=0,o=0,l=1/0,f=-1/0,h=1/0,m=-1/0,b=[],_=[];for(;r.pos<i;){if(s<=0){let v=r.readVarint();n=v&7,s=v>>3}if(s--,n===1||n===2)a+=r.readSVarint()*t,o+=r.readSVarint()*t,a<l&&(l=a),a>f&&(f=a),o<h&&(h=o),o>m&&(m=o),n===1&&(_.length>0&&b.push(_),_=[]),_.push(new P(a,o));else if(n===7)_&&_.push(_[0].clone());else throw new Error(`unknown command ${n}`)}return _&&b.push(_),{geom:b,bbox:{minX:l,minY:h,maxX:f,maxY:m}}};function Nt(r,e){let t=new ze(new de(r)),i=new Map;for(let[n,s]of Object.entries(t.layers)){let a=[],o=s;for(let l=0;l<o.length;l++){let f=_i(o.feature(l)._pbf,o.feature(l)._geometry,e/o.extent),h=0;for(let m of f.geom)h+=m.length;a.push({id:o.feature(l).id,geomType:o.feature(l).type,geom:f.geom,numVertices:h,bbox:f.bbox,props:o.feature(l).properties})}i.set(n,a)}return i}var ye=class{constructor(e,t){g(this,"p");g(this,"zoomaborts");g(this,"shouldCancelZooms");typeof e=="string"?this.p=new Vt(e):this.p=e,this.zoomaborts=[],this.shouldCancelZooms=t}async get(e,t){this.shouldCancelZooms&&(this.zoomaborts=this.zoomaborts.filter(a=>a.z!==e.z?(a.controller.abort(),!1):!0));let i=new AbortController;this.zoomaborts.push({z:e.z,controller:i});let n=i.signal,s=await this.p.getZxy(e.z,e.x,e.y,n);return s?Nt(s.data,t):new Map}},Ce=class{constructor(e,t){g(this,"url");g(this,"zoomaborts");g(this,"shouldCancelZooms");this.url=e,this.zoomaborts=[],this.shouldCancelZooms=t}async get(e,t){this.shouldCancelZooms&&(this.zoomaborts=this.zoomaborts.filter(a=>a.z!==e.z?(a.controller.abort(),!1):!0));let i=this.url.replace("{z}",e.z.toString()).replace("{x}",e.x.toString()).replace("{y}",e.y.toString()),n=new AbortController;this.zoomaborts.push({z:e.z,controller:n});let s=n.signal;return new Promise((a,o)=>{fetch(i,{signal:s}).then(l=>l.arrayBuffer()).then(l=>{let f=Nt(l,t);a(f)}).catch(l=>{o(l)})})}},tt=6378137,It=85.0511287798,Pe=tt*Math.PI,wi=r=>{let e=Math.PI/180,t=Math.max(Math.min(It,r[0]),-It),i=Math.sin(t*e);return new P(tt*r[1]*e,tt*Math.log((1+i)/(1-i))/2)};function Ut(r){return r*r}function Se(r,e){return Ut(r.x-e.x)+Ut(r.y-e.y)}function vi(r,e,t){let i=Se(e,t);if(i===0)return Se(r,e);let n=((r.x-e.x)*(t.x-e.x)+(r.y-e.y)*(t.y-e.y))/i;return n=Math.max(0,Math.min(1,n)),Se(r,new P(e.x+n*(t.x-e.x),e.y+n*(t.y-e.y)))}function $t(r,e){let t=!1;for(let i=0,n=e.length-1;i<e.length;n=i++){let s=e[i].x,a=e[i].y,o=e[n].x,l=e[n].y;a>r.y!=l>r.y&&r.x<(o-s)*(r.y-a)/(l-a)+s&&(t=!t)}return t}function ki(r){let e=0;for(let t=0;t<r.length;t++){let i=(t+1)%r.length;e+=r[t].x*r[i].y,e-=r[i].x*r[t].y}return e<0}function zi(r,e){let t=!1;for(let i of e)if(ki(i))$t(r,i)&&(t=!1);else{if(t)return!0;$t(r,i)&&(t=!0)}return t}function Li(r,e){let t=1/0;for(let i of e){let n=Math.sqrt(Se(r,i[0]));n<t&&(t=n)}return t}function Ti(r,e){let t=1/0;for(let i of e)for(let n=0;n<i.length-1;n++){let s=Math.sqrt(vi(r,i[n],i[n+1]));s<t&&(t=s)}return t}var Me=class{constructor(e,t){g(this,"source");g(this,"cache");g(this,"inflight");g(this,"tileSize");this.source=e,this.cache=new Map,this.inflight=new Map,this.tileSize=t}async get(e){let t=J(e);return new Promise((i,n)=>{let s=this.cache.get(t);if(s)s.used=performance.now(),i(s.data);else{let a=this.inflight.get(t);a?a.push({resolve:i,reject:n}):(this.inflight.set(t,[]),this.source.get(e,this.tileSize).then(o=>{this.cache.set(t,{used:performance.now(),data:o});let l=this.inflight.get(t);if(l)for(let f of l)f.resolve(o);if(this.inflight.delete(t),i(o),this.cache.size>=64){let f=1/0,h;this.cache.forEach((m,b)=>{m.used<f&&(f=m.used,h=b)}),h&&this.cache.delete(h)}}).catch(o=>{let l=this.inflight.get(t);if(l)for(let f of l)f.reject(o);this.inflight.delete(t),n(o)}))}})}queryFeatures(e,t,i,n){let s=wi([t,e]),a=new P((s.x+Pe)/(Pe*2),1-(s.y+Pe)/(Pe*2));a.x>1&&(a.x=a.x-Math.floor(a.x));let o=a.mult(1<<i),l=Math.floor(o.x),f=Math.floor(o.y),h=J({z:i,x:l,y:f}),m=[],b=this.cache.get(h);if(b){let _=new P((o.x-l)*this.tileSize,(o.y-f)*this.tileSize);for(let[v,T]of b.data.entries())for(let c of T)c.geomType===1?Li(_,c.geom)<n&&m.push({feature:c,layerName:v}):c.geomType===2?Ti(_,c.geom)<n&&m.push({feature:c,layerName:v}):zi(_,c.geom)&&m.push({feature:c,layerName:v})}return m}};var A=class{constructor(e){g(this,"pattern");g(this,"fill");g(this,"opacity");g(this,"stroke");g(this,"width");g(this,"perFeature");g(this,"doStroke");this.pattern=e.pattern,this.fill=new E(e.fill,"black"),this.opacity=new D(e.opacity,1),this.stroke=new E(e.stroke,"black"),this.width=new D(e.width,0),this.perFeature=(this.fill.perFeature||this.opacity.perFeature||this.stroke.perFeature||this.width.perFeature||e.perFeature)??!1,this.doStroke=!1}before(e,t){if(!this.perFeature){e.globalAlpha=this.opacity.get(t),e.fillStyle=this.fill.get(t),e.strokeStyle=this.stroke.get(t);let i=this.width.get(t);i>0&&(this.doStroke=!0),e.lineWidth=i}if(this.pattern){let i=e.createPattern(this.pattern,"repeat");i&&(e.fillStyle=i)}}draw(e,t,i,n){let s=!1;if(this.perFeature){e.globalAlpha=this.opacity.get(i,n),e.fillStyle=this.fill.get(i,n);let o=this.width.get(i,n);o&&(s=!0,e.strokeStyle=this.stroke.get(i,n),e.lineWidth=o)}let a=()=>{e.fill(),(s||this.doStroke)&&e.stroke()};e.beginPath();for(let o of t)for(let l=0;l<o.length;l++){let f=o[l];l===0?e.moveTo(f.x,f.y):e.lineTo(f.x,f.y)}a()}};function Fi(r,e){let t=0;for(;e[t+1][0]<r;)t++;return t}function Pi(r,e,t){return r*(t-e)+e}function Si(r,e,t,i){let n=i[e+1][0]-i[e][0],s=r-i[e][0];return n===0?0:t===1?s/n:(t**s-1)/(t**n-1)}function $(r,e){return t=>{if(e.length<1)return 0;if(t<=e[0][0])return e[0][1];if(t>=e[e.length-1][0])return e[e.length-1][1];let i=Fi(t,e),n=Si(t,i,r,e);return Pi(n,e[i][1],e[i+1][1])}}function nt(r){return $(1,r)}var R=class{constructor(e){g(this,"color");g(this,"width");g(this,"opacity");g(this,"dash");g(this,"dashColor");g(this,"dashWidth");g(this,"skip");g(this,"perFeature");g(this,"lineCap");g(this,"lineJoin");this.color=new E(e.color,"black"),this.width=new D(e.width),this.opacity=new D(e.opacity),this.dash=e.dash?new ve(e.dash):null,this.dashColor=new E(e.dashColor,"black"),this.dashWidth=new D(e.dashWidth,1),this.lineCap=new E(e.lineCap,"butt"),this.lineJoin=new E(e.lineJoin,"miter"),this.skip=!1,this.perFeature=!!(this.dash?.perFeature||this.color.perFeature||this.opacity.perFeature||this.width.perFeature||this.lineCap.perFeature||this.lineJoin.perFeature||e.perFeature)}before(e,t){this.perFeature||(e.strokeStyle=this.color.get(t),e.lineWidth=this.width.get(t),e.globalAlpha=this.opacity.get(t),e.lineCap=this.lineCap.get(t),e.lineJoin=this.lineJoin.get(t))}draw(e,t,i,n){if(this.skip)return;let s=()=>{this.perFeature&&(e.globalAlpha=this.opacity.get(i,n),e.lineCap=this.lineCap.get(i,n),e.lineJoin=this.lineJoin.get(i,n)),this.dash?(e.save(),this.perFeature?(e.lineWidth=this.dashWidth.get(i,n),e.strokeStyle=this.dashColor.get(i,n),e.setLineDash(this.dash.get(i,n))):e.setLineDash(this.dash.get(i)),e.stroke(),e.restore()):(e.save(),this.perFeature&&(e.lineWidth=this.width.get(i,n),e.strokeStyle=this.color.get(i,n)),e.stroke(),e.restore())};e.beginPath();for(let a of t)for(let o=0;o<a.length;o++){let l=a[o];o===0?e.moveTo(l.x,l.y):e.lineTo(l.x,l.y)}s()}};var De=class{constructor(e){g(this,"radius");g(this,"fill");g(this,"stroke");g(this,"width");g(this,"opacity");this.radius=new D(e.radius,3),this.fill=new E(e.fill,"black"),this.stroke=new E(e.stroke,"white"),this.width=new D(e.width,0),this.opacity=new D(e.opacity)}draw(e,t,i,n){e.globalAlpha=this.opacity.get(i,n);let s=this.radius.get(i,n),a=this.width.get(i,n);a>0&&(e.strokeStyle=this.stroke.get(i,n),e.lineWidth=a,e.beginPath(),e.arc(t[0][0].x,t[0][0].y,s+a/2,0,2*Math.PI),e.stroke()),e.fillStyle=this.fill.get(i,n),e.beginPath(),e.arc(t[0][0].x,t[0][0].y,s,0,2*Math.PI),e.fill()}place(e,t,i){let n=t[0],s=new P(t[0][0].x,t[0][0].y),a=this.radius.get(e.zoom,i),o={minX:s.x-a,minY:s.y-a,maxX:s.x+a,maxY:s.y+a};return[{anchor:s,bboxes:[o],draw:f=>{this.draw(f,[[new P(0,0)]],e.zoom,i)}}]}};var Ci=(r,e)=>({minX:Math.min(r.minX,e.minX),minY:Math.min(r.minY,e.minY),maxX:Math.max(r.maxX,e.maxX),maxY:Math.max(r.maxY,e.maxY)}),Ae=class{constructor(e){g(this,"list");this.list=e}place(e,t,i){let n=this.list[0];if(!n)return;let s=n.place(e,t,i);if(!s)return;let a=s[0],o=a.anchor,l=a.bboxes[0],f=[a.draw];for(let m=1;m<this.list.length;m++){if(s=this.list[m].place(e,t,i),!s)return;a=s[0],l=Ci(l,a.bboxes[0]),f.push(a.draw)}return[{anchor:o,bboxes:[l],draw:m=>{for(let b of f)b(m)}}]}},rt=class{constructor(e){g(this,"symbolizer");this.symbolizer=e}place(e,t,i){let n=t[0][0],s=this.symbolizer.place(e,[[new P(0,0)]],i);if(!s||s.length===0)return;let a=s[0],o=a.bboxes[0],l=o.maxX-o.minX,f=o.maxY-o.minY,h={minX:n.x-l/2,maxX:n.x+l/2,minY:n.y-f/2,maxY:n.y+f/2};return[{anchor:n,bboxes:[h],draw:b=>{b.translate(-l/2,f/2-o.maxY),a.draw(b,{justify:2})}}]}};var Be=class{constructor(e){g(this,"font");g(this,"text");g(this,"fill");g(this,"stroke");g(this,"width");g(this,"lineHeight");g(this,"letterSpacing");g(this,"maxLineCodeUnits");g(this,"justify");this.font=new ue(e),this.text=new fe(e),this.fill=new E(e.fill,"black"),this.stroke=new E(e.stroke,"black"),this.width=new D(e.width,0),this.lineHeight=new D(e.lineHeight,1),this.letterSpacing=new D(e.letterSpacing,0),this.maxLineCodeUnits=new D(e.maxLineChars,15),this.justify=e.justify}place(e,t,i){let n=this.text.get(e.zoom,i);if(!n)return;let s=this.font.get(e.zoom,i);e.scratch.font=s;let a=this.letterSpacing.get(e.zoom,i),o=He(n,this.maxLineCodeUnits.get(e.zoom,i)),l="",f=0;for(let d of o)d.length>f&&(f=d.length,l=d);let h=e.scratch.measureText(l),m=h.width+a*(f-1),b=h.actualBoundingBoxAscent,_=h.actualBoundingBoxDescent,v=(b+_)*this.lineHeight.get(e.zoom,i),T=new P(t[0][0].x,t[0][0].y),c={minX:T.x,minY:T.y-b,maxX:T.x+m,maxY:T.y+_+(o.length-1)*v};return[{anchor:T,bboxes:[c],draw:(d,y)=>{d.globalAlpha=1,d.font=s,d.fillStyle=this.fill.get(e.zoom,i);let x=this.width.get(e.zoom,i),p=0;for(let w of o){let z=0;if(this.justify===2||y&&y.justify===2?z=(m-d.measureText(w).width)/2:(this.justify===3||y&&y.justify===3)&&(z=m-d.measureText(w).width),x)if(d.lineWidth=x*2,d.strokeStyle=this.stroke.get(e.zoom,i),a>0){let k=z;for(let F of w)d.strokeText(F,k,p),k+=d.measureText(F).width+a}else d.strokeText(w,z,p);if(a>0){let k=z;for(let F of w)d.fillText(F,k,p),k+=d.measureText(F).width+a}else d.fillText(w,z,p);p+=v}}}]}},K=class{constructor(e){g(this,"centered");this.centered=new rt(new Be(e))}place(e,t,i){return this.centered.place(e,t,i)}},it=class{constructor(e,t){g(this,"symbolizer");g(this,"offsetX");g(this,"offsetY");g(this,"justify");g(this,"placements");g(this,"ddValues");this.symbolizer=e,this.offsetX=new D(t.offsetX,0),this.offsetY=new D(t.offsetY,0),this.justify=t.justify??void 0,this.placements=t.placements??[2,6,8,4,1,3,5,7],this.ddValues=t.ddValues??(()=>({}))}place(e,t,i){if(i.geomType!==1)return;let n=t[0][0],s=this.symbolizer.place(e,[[new P(0,0)]],i);if(!s||s.length===0)return;let a=s[0],o=a.bboxes[0],l=this.offsetX,f=this.offsetY,h=this.justify,m=this.placements,{offsetX:b,offsetY:_,justify:v,placements:T}=this.ddValues(e.zoom,i)||{};b&&(l=new D(b,0)),_&&(f=new D(_,0)),v&&(h=v),T&&(m=T);let c=l.get(e.zoom,i),u=f.get(e.zoom,i),d=(z,k)=>({minX:z.x+k.x+o.minX,minY:z.y+k.y+o.minY,maxX:z.x+k.x+o.maxX,maxY:z.y+k.y+o.maxY}),y=new P(c,u),x,p=z=>{z.translate(y.x,y.y),a.draw(z,{justify:x})},w=(z,k)=>{let F=d(z,k);if(!e.index.bboxCollides(F,e.order))return[{anchor:n,bboxes:[F],draw:p}]};for(let z of m){let k=this.computeXaxisOffset(c,o,z),F=this.computeYaxisOffset(u,o,z);return x=this.computeJustify(h,z),y=new P(k,F),w(n,y)}}computeXaxisOffset(e,t,i){let n=t.maxX,s=n/2;return[1,5].includes(i)?e-s:[8,7,6].includes(i)?e-n:e}computeYaxisOffset(e,t,i){let n=Math.abs(t.minY),s=t.maxY,a=(t.minY+t.maxY)/2;return[3,7].includes(i)?e-a:[8,2,1].includes(i)?e-s:[6,4,5].includes(i)?e+n:e}computeJustify(e,t){return e||([1,5].includes(t)?2:[2,3,4].includes(t)?1:3)}},je=class{constructor(e){g(this,"symbolizer");this.symbolizer=new it(new Be(e),e)}place(e,t,i){return this.symbolizer.place(e,t,i)}};var ae=class{constructor(e){g(this,"font");g(this,"text");g(this,"fill");g(this,"stroke");g(this,"width");g(this,"offset");g(this,"position");g(this,"maxLabelCodeUnits");g(this,"repeatDistance");this.font=new ue(e),this.text=new fe(e),this.fill=new E(e.fill,"black"),this.stroke=new E(e.stroke,"black"),this.width=new D(e.width,0),this.offset=new D(e.offset,0),this.position=e.position??1,this.maxLabelCodeUnits=new D(e.maxLabelChars,40),this.repeatDistance=new D(e.repeatDistance,250)}place(e,t,i){let n=this.text.get(e.zoom,i);if(!n||n.length>this.maxLabelCodeUnits.get(e.zoom,i))return;let s=20,a=i.bbox;if(a.maxY-a.minY<s&&a.maxX-a.minX<s)return;let o=this.font.get(e.zoom,i);e.scratch.font=o;let l=e.scratch.measureText(n),f=l.width,h=l.actualBoundingBoxAscent+l.actualBoundingBoxDescent,m=this.repeatDistance.get(e.zoom,i);e.overzoom>4&&(m*=1<<e.overzoom-4);let b=h*2,_=_t(t,f,m,b);if(_.length===0)return;let v=[];for(let T of _){let c=T.end.x-T.start.x,u=T.end.y-T.start.y,y=wt(T.start,T.end,f,b/2).map(p=>({minX:p.x-b/2,minY:p.y-b/2,maxX:p.x+b/2,maxY:p.y+b/2})),x=p=>{p.globalAlpha=1,p.rotate(Math.atan2(u,c)),c<0&&(p.scale(-1,-1),p.translate(-f,0));let w=0;this.position===3?w+=h:this.position===2&&(w+=h/2),p.translate(0,w-this.offset.get(e.zoom,i)),p.font=o;let z=this.width.get(e.zoom,i);z&&(p.lineWidth=z,p.strokeStyle=this.stroke.get(e.zoom,i),p.strokeText(n,0,0)),p.fillStyle=this.fill.get(e.zoom,i),p.fillText(n,0,0)};v.push({anchor:T.start,bboxes:y,draw:x,deduplicationKey:n,deduplicationDistance:m})}return v}};var U=(r,e)=>{let t=r[e];return typeof t=="string"?t:""},Ht=(r,e)=>{let t=r[e];return typeof t=="number"?t:0},Oe=r=>[{dataLayer:"earth",symbolizer:new A({fill:r.earth})},{dataLayer:"landuse",symbolizer:new A({fill:(e,t)=>we(r.park_a,r.park_b,Math.min(Math.max(e/12,12),0))}),filter:(e,t)=>{let i=U(t.props,"pmap:kind");return["allotments","village_green","playground"].includes(i)}},{dataLayer:"landuse",symbolizer:new A({fill:r.park_b,opacity:.7}),filter:(e,t)=>{let i=U(t.props,"pmap:kind");return["national_park","park","cemetery","protected_area","nature_reserve","forest","golf_course"].includes(i)}},{dataLayer:"landuse",symbolizer:new A({fill:r.hospital}),filter:(e,t)=>t.props["pmap:kind"]==="hospital"},{dataLayer:"landuse",symbolizer:new A({fill:r.industrial}),filter:(e,t)=>t.props["pmap:kind"]==="industrial"},{dataLayer:"landuse",symbolizer:new A({fill:r.school}),filter:(e,t)=>{let i=U(t.props,"pmap:kind");return["school","university","college"].includes(i)}},{dataLayer:"landuse",symbolizer:new A({fill:r.beach}),filter:(e,t)=>t.props["pmap:kind"]==="beach"},{dataLayer:"landuse",symbolizer:new A({fill:r.zoo}),filter:(e,t)=>t.props["pmap:kind"]==="zoo"},{dataLayer:"landuse",symbolizer:new A({fill:r.zoo}),filter:(e,t)=>{let i=U(t.props,"pmap:kind");return["military","naval_base","airfield"].includes(i)}},{dataLayer:"natural",symbolizer:new A({fill:(e,t)=>we(r.wood_a,r.wood_b,Math.min(Math.max(e/12,12),0))}),filter:(e,t)=>{let i=U(t.props,"pmap:kind");return["wood","nature_reserve","forest"].includes(i)}},{dataLayer:"natural",symbolizer:new A({fill:(e,t)=>we(r.scrub_a,r.scrub_b,Math.min(Math.max(e/12,12),0))}),filter:(e,t)=>{let i=U(t.props,"pmap:kind");return["scrub","grassland","grass"].includes(i)}},{dataLayer:"natural",symbolizer:new A({fill:r.scrub_b}),filter:(e,t)=>{let i=U(t.props,"pmap:kind");return["scrub","grassland","grass"].includes(i)}},{dataLayer:"natural",symbolizer:new A({fill:r.glacier}),filter:(e,t)=>t.props["pmap:kind"]==="glacier"},{dataLayer:"natural",symbolizer:new A({fill:r.sand}),filter:(e,t)=>t.props["pmap:kind"]==="sand"},{dataLayer:"landuse",symbolizer:new A({fill:r.aerodrome}),filter:(e,t)=>t.props["pmap:kind"]==="aerodrome"},{dataLayer:"water",symbolizer:new A({fill:r.water})},{dataLayer:"transit",symbolizer:new R({color:r.runway,width:(e,t)=>$(1.6,[[11,0],[13,4],[19,30]])(e)}),filter:(e,t)=>t.props["pmap:kind_detail"]==="runway"},{dataLayer:"transit",symbolizer:new R({color:r.runway,width:(e,t)=>$(1.6,[[14,0],[14.5,1],[16,6]])(e)}),filter:(e,t)=>t.props["pmap:kind_detail"]==="taxiway"},{dataLayer:"transit",symbolizer:new R({color:r.pier,width:(e,t)=>$(1.6,[[13,0],[13.5,0,5],[21,16]])(e)}),filter:(e,t)=>t.props["pmap:kind"]==="pier"},{dataLayer:"physical_line",minzoom:14,symbolizer:new R({color:r.water,width:(e,t)=>$(1.6,[[9,0],[9.5,1],[18,12]])(e)}),filter:(e,t)=>t.props["pmap:kind"]==="river"},{dataLayer:"physical_line",minzoom:14,symbolizer:new R({color:r.water,width:.5}),filter:(e,t)=>t.props["pmap:kind"]==="stream"},{dataLayer:"landuse",symbolizer:new A({fill:r.pedestrian}),filter:(e,t)=>t.props["pmap:kind"]==="pedestrian"},{dataLayer:"landuse",symbolizer:new A({fill:r.pier}),filter:(e,t)=>t.props["pmap:kind"]==="pier"},{dataLayer:"buildings",symbolizer:new A({fill:r.buildings,opacity:.5})},{dataLayer:"roads",symbolizer:new R({color:r.major,width:(e,t)=>$(1.6,[[14,0],[20,7]])(e)}),filter:(e,t)=>{let i=U(t.props,"pmap:kind");return["other","path"].includes(i)}},{dataLayer:"roads",symbolizer:new R({color:r.major,width:(e,t)=>$(1.6,[[13,0],[18,8]])(e)}),filter:(e,t)=>t.props["pmap:kind"]==="minor_road"},{dataLayer:"roads",symbolizer:new R({color:r.major,width:(e,t)=>$(1.6,[[7,0],[12,1.2],[15,3],[18,13]])(e)}),filter:(e,t)=>t.props["pmap:kind"]==="medium_road"},{dataLayer:"roads",symbolizer:new R({color:r.major,width:(e,t)=>$(1.6,[[6,0],[12,1.6],[15,3],[18,13]])(e)}),filter:(e,t)=>t.props["pmap:kind"]==="major_road"},{dataLayer:"roads",symbolizer:new R({color:r.major,width:(e,t)=>$(1.6,[[3,0],[6,1.1],[12,1.6],[15,5],[18,15]])(e)}),filter:(e,t)=>t.props["pmap:kind"]==="highway"},{dataLayer:"boundaries",symbolizer:new R({dash:[3,2],color:r.boundaries,width:1}),filter:(e,t)=>{let i=t.props["pmap:min_admin_level"];return typeof i=="number"&&i<=2}},{dataLayer:"transit",symbolizer:new R({dash:[.3,.75],color:r.railway,dashWidth:(e,t)=>$(1.6,[[4,0],[7,.15],[19,9]])(e),opacity:.5}),filter:(e,t)=>t.props["pmap:kind"]==="rail"},{dataLayer:"boundaries",symbolizer:new R({dash:[3,2],color:r.boundaries,width:.5}),filter:(e,t)=>{let i=t.props["pmap:min_admin_level"];return typeof i=="number"&&i>2}}],Re=r=>{let e=["name"];return[{dataLayer:"roads",symbolizer:new ae({labelProps:e,fill:r.roads_label_minor,font:"400 12px sans-serif",width:2,stroke:r.roads_label_minor_halo}),minzoom:16,filter:(t,i)=>{let n=U(i.props,"pmap:kind");return["minor_road","other","path"].includes(n)}},{dataLayer:"roads",symbolizer:new ae({labelProps:e,fill:r.roads_label_major,font:"400 12px sans-serif",width:2,stroke:r.roads_label_major_halo}),minzoom:12,filter:(t,i)=>{let n=U(i.props,"pmap:kind");return["highway","major_road","medium_road"].includes(n)}},{dataLayer:"roads",symbolizer:new ae({labelProps:e,fill:r.roads_label_major,font:"400 12px sans-serif",width:2,stroke:r.roads_label_major_halo}),minzoom:12,filter:(t,i)=>{let n=U(i.props,"pmap:kind");return["highway","major_road","medium_road"].includes(n)}},{dataLayer:"physical_point",symbolizer:new K({labelProps:e,fill:r.ocean_label,lineHeight:1.5,letterSpacing:1,font:(t,i)=>`400 ${nt([[3,10],[10,12]])(t)}px sans-serif`,textTransform:"uppercase"}),filter:(t,i)=>{let n=U(i.props,"pmap:kind");return["ocean","bay","strait","fjord"].includes(n)}},{dataLayer:"physical_point",symbolizer:new K({labelProps:e,fill:r.ocean_label,lineHeight:1.5,letterSpacing:1,font:(t,i)=>`400 ${nt([[3,0],[6,12],[10,12]])(t)}px sans-serif`}),filter:(t,i)=>{let n=U(i.props,"pmap:kind");return["sea","lake","water"].includes(n)}},{dataLayer:"places",symbolizer:new K({labelProps:(t,i)=>t<6?["name:short"]:e,fill:r.state_label,stroke:r.state_label_halo,width:1,lineHeight:1.5,font:(t,i)=>t<6?"400 16px sans-serif":"400 12px sans-serif",textTransform:"uppercase"}),filter:(t,i)=>i.props["pmap:kind"]==="region"},{dataLayer:"places",symbolizer:new K({labelProps:e,fill:r.country_label,lineHeight:1.5,font:(t,i)=>(t<6,"600 12px sans-serif"),textTransform:"uppercase"}),filter:(t,i)=>i.props["pmap:kind"]==="country"},{dataLayer:"places",minzoom:9,symbolizer:new K({labelProps:e,fill:r.city_label,lineHeight:1.5,font:(t,i)=>{if(!i)return"400 12px sans-serif";let n=i.props["pmap:min_zoom"],s=400;n&&n<=5&&(s=600);let a=12,o=i.props["pmap:population_rank"];return o&&o>9&&(a=16),`${s} ${a}px sans-serif`}}),sort:(t,i)=>{let n=Ht(t,"pmap:population_rank"),s=Ht(i,"pmap:population_rank");return n-s},filter:(t,i)=>i.props["pmap:kind"]==="locality"},{dataLayer:"places",maxzoom:8,symbolizer:new Ae([new De({radius:2,fill:r.city_circle,stroke:r.city_circle_stroke,width:1.5}),new je({labelProps:e,fill:r.city_label,stroke:r.city_label_halo,width:1,offsetX:6,offsetY:4.5,font:(t,i)=>"400 12px sans-serif"})]),filter:(t,i)=>i.props["pmap:kind"]==="locality"}]};var Mi={background:"#cccccc",earth:"#e0e0e0",park_a:"#cfddd5",park_b:"#9cd3b4",hospital:"#e4dad9",industrial:"#d1dde1",school:"#e4ded7",wood_a:"#d0ded0",wood_b:"#a0d9a0",pedestrian:"#e3e0d4",scrub_a:"#cedcd7",scrub_b:"#99d2bb",glacier:"#e7e7e7",sand:"#e2e0d7",beach:"#e8e4d0",aerodrome:"#dadbdf",runway:"#e9e9ed",water:"#80deea",pier:"#e0e0e0",zoo:"#c6dcdc",military:"#dcdcdc",tunnel_other_casing:"#e0e0e0",tunnel_minor_casing:"#e0e0e0",tunnel_link_casing:"#e0e0e0",tunnel_medium_casing:"#e0e0e0",tunnel_major_casing:"#e0e0e0",tunnel_highway_casing:"#e0e0e0",tunnel_other:"#d5d5d5",tunnel_minor:"#d5d5d5",tunnel_link:"#d5d5d5",tunnel_medium:"#d5d5d5",tunnel_major:"#d5d5d5",tunnel_highway:"#d5d5d5",transit_pier:"#e0e0e0",buildings:"#cccccc",minor_service_casing:"#e0e0e0",minor_casing:"#e0e0e0",link_casing:"#e0e0e0",medium_casing:"#e0e0e0",major_casing_late:"#e0e0e0",highway_casing_late:"#e0e0e0",other:"#ebebeb",minor_service:"#ebebeb",minor_a:"#ebebeb",minor_b:"#ffffff",link:"#ffffff",medium:"#f5f5f5",major_casing_early:"#e0e0e0",major:"#ffffff",highway_casing_early:"#e0e0e0",highway:"#ffffff",railway:"#a7b1b3",boundaries:"#adadad",waterway_label:"#ffffff",bridges_other_casing:"#e0e0e0",bridges_minor_casing:"#e0e0e0",bridges_link_casing:"#e0e0e0",bridges_medium_casing:"#e0e0e0",bridges_major_casing:"#e0e0e0",bridges_highway_casing:"#e0e0e0",bridges_other:"#ebebeb",bridges_minor:"#ffffff",bridges_link:"#ffffff",bridges_medium:"#f0eded",bridges_major:"#f5f5f5",bridges_highway:"#ffffff",roads_label_minor:"#91888b",roads_label_minor_halo:"#ffffff",roads_label_major:"#938a8d",roads_label_major_halo:"#ffffff",ocean_label:"#ffffff",peak_label:"#7e9aa0",subplace_label:"#8f8f8f",subplace_label_halo:"#e0e0e0",city_circle:"#ffffff",city_circle_stroke:"#a3a3a3",city_label:"#5c5c5c",city_label_halo:"#e0e0e0",state_label:"#b3b3b3",state_label_halo:"#e0e0e0",country_label:"#a3a3a3"},Di={background:"#34373d",earth:"#1f1f1f",park_a:"#232325",park_b:"#232325",hospital:"#252424",industrial:"#222222",school:"#262323",wood_a:"#202121",wood_b:"#202121",pedestrian:"#1e1e1e",scrub_a:"#222323",scrub_b:"#222323",glacier:"#1c1c1c",sand:"#212123",beach:"#28282a",aerodrome:"#1e1e1e",runway:"#333333",water:"#34373d",pier:"#222222",zoo:"#222323",military:"#242323",tunnel_other_casing:"#141414",tunnel_minor_casing:"#141414",tunnel_link_casing:"#141414",tunnel_medium_casing:"#141414",tunnel_major_casing:"#141414",tunnel_highway_casing:"#141414",tunnel_other:"#292929",tunnel_minor:"#292929",tunnel_link:"#292929",tunnel_medium:"#292929",tunnel_major:"#292929",tunnel_highway:"#292929",transit_pier:"#333333",buildings:"#111111",minor_service_casing:"#1f1f1f",minor_casing:"#1f1f1f",link_casing:"#1f1f1f",medium_casing:"#1f1f1f",major_casing_late:"#1f1f1f",highway_casing_late:"#1f1f1f",other:"#333333",minor_service:"#333333",minor_a:"#3d3d3d",minor_b:"#333333",link:"#3d3d3d",medium:"#3d3d3d",major_casing_early:"#1f1f1f",major:"#3d3d3d",highway_casing_early:"#1f1f1f",highway:"#474747",railway:"#000000",boundaries:"#5b6374",waterway_label:"#717784",bridges_other_casing:"#2b2b2b",bridges_minor_casing:"#1f1f1f",bridges_link_casing:"#1f1f1f",bridges_medium_casing:"#1f1f1f",bridges_major_casing:"#1f1f1f",bridges_highway_casing:"#1f1f1f",bridges_other:"#333333",bridges_minor:"#333333",bridges_link:"#3d3d3d",bridges_medium:"#3d3d3d",bridges_major:"#3d3d3d",bridges_highway:"#474747",roads_label_minor:"#525252",roads_label_minor_halo:"#1f1f1f",roads_label_major:"#666666",roads_label_major_halo:"#1f1f1f",ocean_label:"#717784",peak_label:"#898080",subplace_label:"#525252",subplace_label_halo:"#1f1f1f",city_circle:"#000000",city_circle_stroke:"#7a7a7a",city_label:"#7a7a7a",city_label_halo:"#212121",state_label:"#3d3d3d",state_label_halo:"#1f1f1f",country_label:"#5c5c5c"},Ai={background:"#ffffff",earth:"#ffffff",park_a:"#fcfcfc",park_b:"#fcfcfc",hospital:"#f8f8f8",industrial:"#fcfcfc",school:"#f8f8f8",wood_a:"#fafafa",wood_b:"#fafafa",pedestrian:"#fdfdfd",scrub_a:"#fafafa",scrub_b:"#fafafa",glacier:"#fcfcfc",sand:"#fafafa",beach:"#f6f6f6",aerodrome:"#fdfdfd",runway:"#efefef",water:"#dcdcdc",pier:"#f5f5f5",zoo:"#f7f7f7",military:"#fcfcfc",tunnel_other_casing:"#d6d6d6",tunnel_minor_casing:"#fcfcfc",tunnel_link_casing:"#fcfcfc",tunnel_medium_casing:"#fcfcfc",tunnel_major_casing:"#fcfcfc",tunnel_highway_casing:"#fcfcfc",tunnel_other:"#d6d6d6",tunnel_minor:"#d6d6d6",tunnel_link:"#d6d6d6",tunnel_medium:"#d6d6d6",tunnel_major:"#d6d6d6",tunnel_highway:"#d6d6d6",transit_pier:"#efefef",buildings:"#efefef",minor_service_casing:"#ffffff",minor_casing:"#ffffff",link_casing:"#ffffff",medium_casing:"#ffffff",major_casing_late:"#ffffff",highway_casing_late:"#ffffff",other:"#f5f5f5",minor_service:"#f5f5f5",minor_a:"#ebebeb",minor_b:"#f5f5f5",link:"#ebebeb",medium:"#ebebeb",major_casing_early:"#ffffff",major:"#ebebeb",highway_casing_early:"#ffffff",highway:"#ebebeb",railway:"#d6d6d6",boundaries:"#adadad",waterway_label:"#adadad",bridges_other_casing:"#ffffff",bridges_minor_casing:"#ffffff",bridges_link_casing:"#ffffff",bridges_medium_casing:"#ffffff",bridges_major_casing:"#ffffff",bridges_highway_casing:"#ffffff",bridges_other:"#f5f5f5",bridges_minor:"#f5f5f5",bridges_link:"#ebebeb",bridges_medium:"#ebebeb",bridges_major:"#ebebeb",bridges_highway:"#ebebeb",roads_label_minor:"#adadad",roads_label_minor_halo:"#ffffff",roads_label_major:"#999999",roads_label_major_halo:"#ffffff",ocean_label:"#adadad",peak_label:"#adadad",subplace_label:"#8f8f8f",subplace_label_halo:"#ffffff",city_circle:"#ffffff",city_circle_stroke:"#adadad",city_label:"#5c5c5c",city_label_halo:"#ffffff",state_label:"#b3b3b3",state_label_halo:"#ffffff",country_label:"#b8b8b8"},Bi={background:"#a3a3a3",earth:"#cccccc",park_a:"#c2c2c2",park_b:"#c2c2c2",hospital:"#d0d0d0",industrial:"#c6c6c6",school:"#d0d0d0",wood_a:"#c2c2c2",wood_b:"#c2c2c2",pedestrian:"#c4c4c4",scrub_a:"#c2c2c2",scrub_b:"#c2c2c2",glacier:"#d2d2d2",sand:"#d2d2d2",beach:"#d2d2d2",aerodrome:"#c9c9c9",runway:"#f5f5f5",water:"#a3a3a3",pier:"#b8b8b8",zoo:"#c7c7c7",military:"#bfbfbf",tunnel_other_casing:"#b8b8b8",tunnel_minor_casing:"#b8b8b8",tunnel_link_casing:"#b8b8b8",tunnel_medium_casing:"#b8b8b8",tunnel_major_casing:"#b8b8b8",tunnel_highway_casing:"#b8b8b8",tunnel_other:"#d6d6d6",tunnel_minor:"#d6d6d6",tunnel_link:"#d6d6d6",tunnel_medium:"#d6d6d6",tunnel_major:"#d6d6d6",tunnel_highway:"#d6d6d6",transit_pier:"#b8b8b8",buildings:"#e0e0e0",minor_service_casing:"#cccccc",minor_casing:"#cccccc",link_casing:"#cccccc",medium_casing:"#cccccc",major_casing_late:"#cccccc",highway_casing_late:"#cccccc",other:"#e0e0e0",minor_service:"#e0e0e0",minor_a:"#ebebeb",minor_b:"#e0e0e0",link:"#ebebeb",medium:"#ebebeb",major_casing_early:"#cccccc",major:"#ebebeb",highway_casing_early:"#cccccc",highway:"#ebebeb",railway:"#f5f5f5",boundaries:"#5c5c5c",waterway_label:"#7a7a7a",bridges_other_casing:"#cccccc",bridges_minor_casing:"#cccccc",bridges_link_casing:"#cccccc",bridges_medium_casing:"#cccccc",bridges_major_casing:"#cccccc",bridges_highway_casing:"#cccccc",bridges_other:"#e0e0e0",bridges_minor:"#e0e0e0",bridges_link:"#ebebeb",bridges_medium:"#ebebeb",bridges_major:"#ebebeb",bridges_highway:"#ebebeb",roads_label_minor:"#999999",roads_label_minor_halo:"#e0e0e0",roads_label_major:"#8f8f8f",roads_label_major_halo:"#ebebeb",ocean_label:"#7a7a7a",peak_label:"#5c5c5c",subplace_label:"#7a7a7a",subplace_label_halo:"#cccccc",city_circle:"#c2c2c2",city_circle_stroke:"#7a7a7a",city_label:"#474747",city_label_halo:"#cccccc",state_label:"#999999",state_label_halo:"#cccccc",country_label:"#858585"},ji={background:"#2b2b2b",earth:"#141414",park_a:"#181818",park_b:"#181818",hospital:"#1d1d1d",industrial:"#101010",school:"#111111",wood_a:"#1a1a1a",wood_b:"#1a1a1a",pedestrian:"#191919",scrub_a:"#1c1c1c",scrub_b:"#1c1c1c",glacier:"#191919",sand:"#161616",beach:"#1f1f1f",aerodrome:"#191919",runway:"#323232",water:"#333333",pier:"#0a0a0a",zoo:"#191919",military:"#121212",tunnel_other_casing:"#101010",tunnel_minor_casing:"#101010",tunnel_link_casing:"#101010",tunnel_medium_casing:"#101010",tunnel_major_casing:"#101010",tunnel_highway_casing:"#101010",tunnel_other:"#292929",tunnel_minor:"#292929",tunnel_link:"#292929",tunnel_medium:"#292929",tunnel_major:"#292929",tunnel_highway:"#292929",transit_pier:"#0a0a0a",buildings:"#0a0a0a",minor_service_casing:"#141414",minor_casing:"#141414",link_casing:"#141414",medium_casing:"#141414",major_casing_late:"#141414",highway_casing_late:"#141414",other:"#1f1f1f",minor_service:"#1f1f1f",minor_a:"#292929",minor_b:"#1f1f1f",link:"#1f1f1f",medium:"#292929",major_casing_early:"#141414",major:"#292929",highway_casing_early:"#141414",highway:"#292929",railway:"#292929",boundaries:"#707070",waterway_label:"#707070",bridges_other_casing:"#141414",bridges_minor_casing:"#141414",bridges_link_casing:"#141414",bridges_medium_casing:"#141414",bridges_major_casing:"#141414",bridges_highway_casing:"#141414",bridges_other:"#1f1f1f",bridges_minor:"#1f1f1f",bridges_link:"#292929",bridges_medium:"#292929",bridges_major:"#292929",bridges_highway:"#292929",roads_label_minor:"#525252",roads_label_minor_halo:"#141414",roads_label_major:"#5c5c5c",roads_label_major_halo:"#141414",ocean_label:"#707070",peak_label:"#707070",subplace_label:"#5c5c5c",subplace_label_halo:"#141414",city_circle:"#000000",city_circle_stroke:"#666666",city_label:"#999999",city_label_halo:"#141414",state_label:"#3d3d3d",state_label_halo:"#141414",country_label:"#707070"},Ee={light:Mi,dark:Di,white:Ai,grayscale:Bi,black:ji};var Wt=er(Zt(),1);var Ye=(r,e,t)=>{let i=[];for(let n of r){let s=[];for(let a of n)s.push(a.clone().mult(e).add(t));i.push(s)}return i},Xe=(r,e)=>{let t=1<<e;return r<0?t+r:r>=t?r%t:r},ot=class{constructor(e,t,i){g(this,"levelDiff");g(this,"tileCache");g(this,"maxDataLevel");this.tileCache=e,this.maxDataLevel=t,this.levelDiff=i}dataTilesForBounds(e,t){let i=2**e/2**Math.ceil(e),n=[],s=1,a=this.tileCache.tileSize;if(e<this.levelDiff)s=1/(1<<this.levelDiff-e)*i,n.push({dataTile:{z:0,x:0,y:0},origin:new P(0,0),scale:s,dim:a*s});else if(e<=this.levelDiff+this.maxDataLevel){let o=1<<this.levelDiff,l=256*i,f=Math.ceil(e)-this.levelDiff,h=Math.floor(t.minX/o/l),m=Math.floor(t.minY/o/l),b=Math.floor(t.maxX/o/l),_=Math.floor(t.maxY/o/l);for(let v=h;v<=b;v++)for(let T=m;T<=_;T++){let c=new P(v*o*l,T*o*l);n.push({dataTile:{z:f,x:Xe(v,f),y:Xe(T,f)},origin:c,scale:i,dim:a*i})}}else{let o=1<<this.levelDiff;s=(1<<Math.ceil(e)-this.maxDataLevel-this.levelDiff)*i;let l=Math.floor(t.minX/o/256/s),f=Math.floor(t.minY/o/256/s),h=Math.floor(t.maxX/o/256/s),m=Math.floor(t.maxY/o/256/s);for(let b=l;b<=h;b++)for(let _=f;_<=m;_++){let v=new P(b*o*256*s,_*o*256*s);n.push({dataTile:{z:this.maxDataLevel,x:Xe(b,this.maxDataLevel),y:Xe(_,this.maxDataLevel)},origin:v,scale:s,dim:a*s})}}return n}dataTileForDisplayTile(e){let t,i=1,n=this.tileCache.tileSize,s;if(e.z<this.levelDiff)t={z:0,x:0,y:0},i=1/(1<<this.levelDiff-e.z),s=new P(0,0),n=n*i;else if(e.z<=this.levelDiff+this.maxDataLevel){let a=1<<this.levelDiff;t={z:e.z-this.levelDiff,x:Math.floor(e.x/a),y:Math.floor(e.y/a)},s=new P(t.x*a*256,t.y*a*256)}else{i=1<<e.z-this.maxDataLevel-this.levelDiff;let a=1<<this.levelDiff;t={z:this.maxDataLevel,x:Math.floor(e.x/a/i),y:Math.floor(e.y/a/i)},s=new P(t.x*a*i*256,t.y*a*i*256),n=n*i}return{dataTile:t,scale:i,origin:s,dim:n}}async getBbox(e,t){let i=this.dataTilesForBounds(e,t);return(await Promise.all(i.map(s=>this.tileCache.get(s.dataTile)))).map((s,a)=>{let o=i[a];return{data:s,z:e,dataTile:o.dataTile,scale:o.scale,dim:o.dim,origin:o.origin}})}async getDisplayTile(e){let t=this.dataTileForDisplayTile(e);return{data:await this.tileCache.get(t.dataTile),z:e.z,dataTile:t.dataTile,scale:t.scale,origin:t.origin,dim:t.dim}}queryFeatures(e,t,i,n){let s=Math.round(i),a=Math.min(s-this.levelDiff,this.maxDataLevel),o=n/(1<<s-a);return this.tileCache.queryFeatures(e,t,a,o)}},qt=r=>{let e=i=>{let n=i.levelDiff===void 0?1:i.levelDiff,s=i.maxDataZoom||15,a;if(typeof i.url=="string")new URL(i.url,"http://example.com").pathname.endsWith(".pmtiles")?a=new ye(i.url,!0):a=new Ce(i.url,!0);else if(i.url)a=new ye(i.url,!0);else throw new Error(`Invalid source ${i.url}`);let o=new Me(a,256*1<<n);return new ot(o,s,n)},t=new Map;if(r.sources)for(let i in r.sources)t.set(i,e(r.sources[i]));else t.set("",e(r));return t};var Oi=(r,e,t)=>{let n=e/256,s=Math.floor(t.minX/256),a=Math.floor(t.minY/256),o=Math.floor(t.maxX/256),l=Math.floor(t.maxY/256),f=Math.log2(n),h=[];for(let m=s;m<=o;m++){let b=m%(1<<r);for(let _=a;_<=l;_++)h.push({display:J({z:r,x:b,y:_}),key:J({z:r-f,x:Math.floor(b/n),y:Math.floor(_/n)})})}return h},lt=class{constructor(e,t){g(this,"tree");g(this,"current");g(this,"dim");g(this,"maxLabeledTiles");this.tree=new Wt.default,this.current=new Map,this.dim=e,this.maxLabeledTiles=t}hasPrefix(e){for(let t of this.current.keys())if(t.startsWith(e))return!0;return!1}has(e){return this.current.has(e)}size(){return this.current.size}keys(){return this.current.keys()}searchBbox(e,t){let i=new Set;for(let n of this.tree.search(e))n.indexedLabel.order<=t&&i.add(n.indexedLabel);return i}searchLabel(e,t){let i=new Set;for(let n of e.bboxes)for(let s of this.tree.search(n))s.indexedLabel.order<=t&&i.add(s.indexedLabel);return i}bboxCollides(e,t){for(let i of this.tree.search(e))if(i.indexedLabel.order<=t)return!0;return!1}labelCollides(e,t){for(let i of e.bboxes)for(let n of this.tree.search(i))if(n.indexedLabel.order<=t)return!0;return!1}deduplicationCollides(e){if(!e.deduplicationKey||!e.deduplicationDistance)return!1;let t=e.deduplicationDistance,i={minX:e.anchor.x-t,minY:e.anchor.y-t,maxX:e.anchor.x+t,maxY:e.anchor.y+t};for(let n of this.tree.search(i))if(n.indexedLabel.deduplicationKey===e.deduplicationKey&&n.indexedLabel.anchor.dist(e.anchor)<t)return!0;return!1}makeEntry(e){this.current.get(e)&&console.log("consistency error 1");let t=new Set;this.current.set(e,t)}insert(e,t,i){let n={anchor:e.anchor,bboxes:e.bboxes,draw:e.draw,order:t,tileKey:i,deduplicationKey:e.deduplicationKey,deduplicationDistance:e.deduplicationDistance},s=this.current.get(i);if(!s){let l=new Set;this.current.set(i,l),s=l}s.add(n);let a=!1,o=!1;for(let l of e.bboxes)this.tree.insert({minX:l.minX,minY:l.minY,maxX:l.maxX,maxY:l.maxY,indexedLabel:n}),l.minX<0&&(a=!0),l.maxX>this.dim&&(o=!0);if(a||o){let l=a?this.dim:-this.dim,f=[];for(let b of e.bboxes)f.push({minX:b.minX+l,minY:b.minY,maxX:b.maxX+l,maxY:b.maxY});let h={anchor:new P(e.anchor.x+l,e.anchor.y),bboxes:f,draw:e.draw,order:t,tileKey:i},m=this.current.get(i);m&&m.add(h);for(let b of f)this.tree.insert({minX:b.minX,minY:b.minY,maxX:b.maxX,maxY:b.maxY,indexedLabel:h})}}pruneOrNoop(e){let t=e.split(":"),i,n=0,s=0;for(let a of this.current.keys()){let o=a.split(":");if(o[3]===t[3]){s++;let l=Math.sqrt((+o[0]-+t[0])**2+(+o[1]-+t[1])**2);l>n&&(n=l,i=a)}i&&s>this.maxLabeledTiles&&this.pruneKey(i)}}pruneKey(e){let t=this.current.get(e);if(!t)return;let i=[];for(let n of this.tree.all())t.has(n.indexedLabel)&&i.push(n);for(let n of i)this.tree.remove(n);this.current.delete(e)}removeLabel(e){let t=[];for(let n of this.tree.all())e===n.indexedLabel&&t.push(n);for(let n of t)this.tree.remove(n);let i=this.current.get(e.tileKey);i&&i.delete(e)}},ct=class{constructor(e,t,i,n,s){g(this,"index");g(this,"z");g(this,"scratch");g(this,"labelRules");g(this,"callback");this.index=new lt(256*1<<e,n),this.z=e,this.scratch=t,this.labelRules=i,this.callback=s}layout(e){let t=performance.now(),i=new Set;for(let[s,a]of e)for(let o of a){let l=`${J(o.dataTile)}:${s}`;this.index.has(l)||(this.index.makeEntry(l),i.add(l))}let n=new Set;for(let[s,a]of this.labelRules.entries()){if(a.visible===!1||a.minzoom&&this.z<a.minzoom||a.maxzoom&&this.z>a.maxzoom)continue;let o=a.dataSource||"",l=e.get(o);if(l)for(let f of l){let h=`${J(f.dataTile)}:${o}`;if(!i.has(h))continue;let m=f.data.get(a.dataLayer);if(m===void 0)continue;let b=m;a.sort&&b.sort((v,T)=>a.sort?a.sort(v.props,T.props):0);let _={index:this.index,zoom:this.z,scratch:this.scratch,order:s,overzoom:this.z-f.dataTile.z};for(let v of b){if(a.filter&&!a.filter(this.z,v))continue;let T=Ye(v.geom,f.scale,f.origin),c=a.symbolizer.place(_,T,v);if(c)for(let u of c){let d=!1;if(!(u.deduplicationKey&&this.index.deduplicationCollides(u))){if(this.index.labelCollides(u,1/0)){if(!this.index.labelCollides(u,s)){let y=this.index.searchLabel(u,1/0);for(let x of y){this.index.removeLabel(x);for(let p of x.bboxes)this.findInvalidatedTiles(n,f.dim,p,h)}this.index.insert(u,s,h),d=!0}}else this.index.insert(u,s,h),d=!0;if(d)for(let y of u.bboxes)(y.maxX>f.origin.x+f.dim||y.minX<f.origin.x||y.minY<f.origin.y||y.maxY>f.origin.y+f.dim)&&this.findInvalidatedTiles(n,f.dim,y,h)}}}}}for(let s of i)this.index.pruneOrNoop(s);return n.size>0&&this.callback&&this.callback(n),performance.now()-t}findInvalidatedTiles(e,t,i,n){let s=Oi(this.z,t,i);for(let a of s)a.key!==n&&this.index.hasPrefix(a.key)&&e.add(a.display)}add(e){let t=!0;for(let[n,s]of e)for(let a of s)this.index.has(`${J(a.dataTile)}:${n}`)||(t=!1);return t?0:this.layout(e)}},xe=class{constructor(e,t,i,n){g(this,"labelers");g(this,"scratch");g(this,"labelRules");g(this,"maxLabeledTiles");g(this,"callback");this.labelers=new Map,this.scratch=e,this.labelRules=t,this.maxLabeledTiles=i,this.callback=n}add(e,t){let i=this.labelers.get(e);return i||(i=new ct(e,this.scratch,this.labelRules,this.maxLabeledTiles,this.callback),this.labelers.set(e,i)),i.add(t)}getIndex(e){let t=this.labelers.get(e);if(t)return t.index}};function Jt(r,e,t,i,n,s,a,o,l){let f=performance.now();r.save(),r.miterLimit=2;for(let h of n){if(h.minzoom&&e<h.minzoom||h.maxzoom&&e>h.maxzoom)continue;let m=t.get(h.dataSource||"");if(m)for(let b of m){let _=b.data.get(h.dataLayer);if(_===void 0)continue;h.symbolizer.before&&h.symbolizer.before(r,b.z);let v=b.origin,T=b.dim,c=b.scale;if(r.save(),o){r.beginPath();let u=Math.max(v.x-a.x,s.minX-a.x),d=Math.max(v.y-a.y,s.minY-a.y),y=Math.min(v.x-a.x+T,s.maxX-a.x),x=Math.min(v.y-a.y+T,s.maxY-a.y);r.rect(u,d,y-u,x-d),r.clip()}r.translate(v.x-a.x,v.y-a.y);for(let u of _){let d=u.geom,y=u.bbox;y.maxX*c+v.x<s.minX||y.minX*c+v.x>s.maxX||y.minY*c+v.y>s.maxY||y.maxY*c+v.y<s.minY||h.filter&&!h.filter(b.z,u)||(c!==1&&(d=Ye(d,c,new P(0,0))),h.symbolizer.draw(r,d,b.z,u))}r.restore()}}if(o&&(r.beginPath(),r.rect(s.minX-a.x,s.minY-a.y,s.maxX-s.minX,s.maxY-s.minY),r.clip()),i){let h=i.searchBbox(s,1/0);for(let m of h)if(r.save(),r.translate(m.anchor.x-a.x,m.anchor.y-a.y),m.draw(r),r.restore(),l){r.lineWidth=.5,r.strokeStyle=l,r.fillStyle=l,r.globalAlpha=1,r.fillRect(m.anchor.x-a.x-2,m.anchor.y-a.y-2,4,4);for(let b of m.bboxes)r.strokeRect(b.minX-a.x,b.minY-a.y,b.maxX-b.minX,b.maxY-b.minY)}}return r.restore(),performance.now()-f}var Ri=r=>new Promise(e=>{setTimeout(()=>{e()},r)}),Ei=r=>r.then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e})),Kt=(r={})=>{class e extends L.GridLayer{constructor(n={}){n.noWrap&&!n.bounds&&(n.bounds=[[-90,-180],[90,180]]),n.attribution==null&&(n.attribution='<a href="https://protomaps.com">Protomaps</a> \xA9 <a href="https://openstreetmap.org/copyright">OpenStreetMap</a>');super(n);g(this,"paintRules");g(this,"labelRules");g(this,"backgroundColor");if(n.theme){let a=Ee[n.theme];this.paintRules=Oe(a),this.labelRules=Re(a),this.backgroundColor=a.background}else this.paintRules=n.paintRules||[],this.labelRules=n.labelRules||[],this.backgroundColor=n.backgroundColor;this.lastRequestedZ=void 0,this.tasks=n.tasks||[],this.views=qt(n),this.debug=n.debug;let s=document.createElement("canvas").getContext("2d");this.scratch=s,this.onTilesInvalidated=a=>{for(let o of a)this.rerenderTile(o)},this.labelers=new xe(this.scratch,this.labelRules,16,this.onTilesInvalidated),this.tileSize=256*window.devicePixelRatio,this.tileDelay=n.tileDelay||3,this.lang=n.lang}async renderTile(n,s,a,o=()=>{}){this.lastRequestedZ=n.z;let l=[];for(let[k,F]of this.views){let S=F.getDisplayTile(n);l.push({key:k,promise:S})}let f=await Promise.all(l.map(k=>k.promise.then(F=>({status:"fulfilled",value:F,key:k.key}),F=>({status:"rejected",reason:F,key:k.key})))),h=new Map;for(let k of f)k.status==="fulfilled"?h.set(k.key,[k.value]):k.reason.name==="AbortError"||console.error(k.reason);if(s.key!==a||this.lastRequestedZ!==n.z||(await Promise.all(this.tasks.map(Ei)),s.key!==a)||this.lastRequestedZ!==n.z)return;let m=this.labelers.add(n.z,h);if(s.key!==a||this.lastRequestedZ!==n.z)return;let b=this.labelers.getIndex(n.z);if(!this._map)return;let _=this._map.getCenter().wrap(),v=this._getTiledPixelBounds(_),c=this._pxBoundsToTileRange(v).getCenter(),u=n.distanceTo(c)*this.tileDelay;if(await Ri(u),s.key!==a||this.lastRequestedZ!==n.z)return;let d=16,y={minX:256*n.x-d,minY:256*n.y-d,maxX:256*(n.x+1)+d,maxY:256*(n.y+1)+d},x=new P(256*n.x,256*n.y);s.width=this.tileSize,s.height=this.tileSize;let p=s.getContext("2d");if(!p){console.error("Failed to get Canvas context");return}p.setTransform(this.tileSize/256,0,0,this.tileSize/256,0,0),p.clearRect(0,0,256,256),this.backgroundColor&&(p.save(),p.fillStyle=this.backgroundColor,p.fillRect(0,0,256,256),p.restore());let w=0,z=this.paintRules;if(w=Jt(p,n.z,h,this.xray?null:b,z,y,x,!1,this.debug),this.debug){p.save(),p.fillStyle=this.debug,p.font="600 12px sans-serif",p.fillText(`${n.z} ${n.x} ${n.y}`,4,14),p.font="12px sans-serif";let k=28;for(let[F,S]of h){let C=S[0].dataTile;p.fillText(`${F+(F?" ":"")+C.z} ${C.x} ${C.y}`,4,k),k+=14}p.font="600 10px sans-serif",w>8&&(p.fillText(`${w.toFixed()} ms paint`,4,k),k+=14),m>8&&p.fillText(`${m.toFixed()} ms layout`,4,k),p.strokeStyle=this.debug,p.lineWidth=.5,p.beginPath(),p.moveTo(0,0),p.lineTo(0,256),p.stroke(),p.lineWidth=.5,p.beginPath(),p.moveTo(0,0),p.lineTo(256,0),p.stroke(),p.restore()}o()}rerenderTile(n){for(let s in this._tiles){let a=this._wrapCoords(this._keyToTileCoords(s));n===this._tileCoordsToKey(a)&&this.renderTile(a,this._tiles[s].el,n)}}queryTileFeaturesDebug(n,s,a=16){let o=new Map;for(let[l,f]of this.views)o.set(l,f.queryFeatures(n,s,this._map.getZoom(),a));return o}clearLayout(){this.labelers=new xe(this.scratch,this.labelRules,16,this.onTilesInvalidated)}rerenderTiles(){for(let n in this._tiles){let s=this._wrapCoords(this._keyToTileCoords(n)),a=this._tileCoordsToKey(s);this.renderTile(s,this._tiles[n].el,a)}}createTile(n,s){let a=L.DomUtil.create("canvas","leaflet-tile");a.lang=this.lang;let o=this._tileCoordsToKey(n);return a.key=o,this.renderTile(n,a,o,()=>{s(void 0,a)}),a}_removeTile(n){let s=this._tiles[n];s&&(s.el.removed=!0,s.el.key=void 0,L.DomUtil.removeClass(s.el,"leaflet-tile-loaded"),s.el.width=s.el.height=0,L.DomUtil.remove(s.el),delete this._tiles[n],this.fire("tileunload",{tile:s.el,coords:this._keyToTileCoords(n)}))}}return new e(r)};function Xi(r,e){let t=Ee[e];t&&(r.options.theme=e,r.paintRules=Oe(t),r.labelRules=Re(t),r.backgroundColor=t.background,r.clearLayout(),r.rerenderTiles())}async function Yi(){let r=await pt(),e={url:r.service.options.url,attribution:r.service.options.attribution};bt({layerFunction:Kt,layerOptions:e,options:r,setLayerStyle:Xi})}Yi();
//# sourceMappingURL=Protomaps-Leaflet.js.map
